import{_ as Lt,j as vt,b as jt,p as Yt,r as bt,C as Qt,c as Jt,u as te,a as ee}from"./index-BnRyMSB7.js";var se={976:(at,Z,V)=>{V.d(Z,{AnnotationLayer:()=>ut,FreeTextAnnotationElement:()=>z,InkAnnotationElement:()=>et,StampAnnotationElement:()=>dt});var w=V(292),B=V(419),I=V(792);function G(st){return Math.floor(Math.max(0,Math.min(1,st))*255).toString(16).padStart(2,"0")}function P(st){return Math.max(0,Math.min(255,255*st))}class T{static CMYK_G([m,h,e,n]){return["G",1-Math.min(1,.3*m+.59*e+.11*h+n)]}static G_CMYK([m]){return["CMYK",0,0,0,1-m]}static G_RGB([m]){return["RGB",m,m,m]}static G_rgb([m]){return m=P(m),[m,m,m]}static G_HTML([m]){const h=G(m);return`#${h}${h}${h}`}static RGB_G([m,h,e]){return["G",.3*m+.59*h+.11*e]}static RGB_rgb(m){return m.map(P)}static RGB_HTML(m){return`#${m.map(G).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([m,h,e,n]){return["RGB",1-Math.min(1,m+n),1-Math.min(1,e+n),1-Math.min(1,h+n)]}static CMYK_rgb([m,h,e,n]){return[P(1-Math.min(1,m+n)),P(1-Math.min(1,e+n)),P(1-Math.min(1,h+n))]}static CMYK_HTML(m){const h=this.CMYK_RGB(m).slice(1);return this.RGB_HTML(h)}static RGB_CMYK([m,h,e]){const n=1-m,f=1-h,o=1-e,a=Math.min(n,f,o);return["CMYK",n,f,o,a]}}var x=V(284);const v=1e3,r=9,d=new WeakSet;function l(st){return{width:st[2]-st[0],height:st[3]-st[1]}}class b{static create(m){switch(m.data.annotationType){case w.AnnotationType.LINK:return new g(m);case w.AnnotationType.TEXT:return new t(m);case w.AnnotationType.WIDGET:switch(m.data.fieldType){case"Tx":return new c(m);case"Btn":return m.data.radioButton?new S(m):m.data.checkBox?new y(m):new L(m);case"Ch":return new M(m);case"Sig":return new p(m)}return new i(m);case w.AnnotationType.POPUP:return new O(m);case w.AnnotationType.FREETEXT:return new z(m);case w.AnnotationType.LINE:return new q(m);case w.AnnotationType.SQUARE:return new nt(m);case w.AnnotationType.CIRCLE:return new j(m);case w.AnnotationType.POLYLINE:return new H(m);case w.AnnotationType.CARET:return new Y(m);case w.AnnotationType.INK:return new et(m);case w.AnnotationType.POLYGON:return new U(m);case w.AnnotationType.HIGHLIGHT:return new tt(m);case w.AnnotationType.UNDERLINE:return new ot(m);case w.AnnotationType.SQUIGGLY:return new ct(m);case w.AnnotationType.STRIKEOUT:return new pt(m);case w.AnnotationType.STAMP:return new dt(m);case w.AnnotationType.FILEATTACHMENT:return new ht(m);default:return new s(m)}}}class s{#t=null;#e=!1;constructor(m,{isRenderable:h=!1,ignoreBorder:e=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=h,this.data=m.data,this.layer=m.layer,this.linkService=m.linkService,this.downloadManager=m.downloadManager,this.imageResourcesPath=m.imageResourcesPath,this.renderForms=m.renderForms,this.svgFactory=m.svgFactory,this.annotationStorage=m.annotationStorage,this.enableScripting=m.enableScripting,this.hasJSActions=m.hasJSActions,this._fieldObjects=m.fieldObjects,this.parent=m.parent,h&&(this.container=this._createContainer(e)),n&&this._createQuadrilaterals()}static _hasPopupData({titleObj:m,contentsObj:h,richText:e}){return!!(m?.str||h?.str||e?.str)}get hasPopupData(){return s._hasPopupData(this.data)}updateEdited(m){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};const{rect:h}=m;h&&this.#s(h)}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#t=null)}#s(m){const{container:{style:h},data:{rect:e,rotation:n},parent:{viewport:{rawDims:{pageWidth:f,pageHeight:o,pageX:a,pageY:u}}}}=this;e?.splice(0,4,...m);const{width:A,height:E}=l(m);h.left=`${100*(m[0]-a)/f}%`,h.top=`${100*(o-m[3]+u)/o}%`,n===0?(h.width=`${100*A/f}%`,h.height=`${100*E/o}%`):this.setRotation(n)}_createContainer(m){const{data:h,parent:{page:e,viewport:n}}=this,f=document.createElement("section");f.setAttribute("data-annotation-id",h.id),this instanceof i||(f.tabIndex=v);const{style:o}=f;if(o.zIndex=this.parent.zIndex++,h.popupRef&&f.setAttribute("aria-haspopup","dialog"),h.alternativeText&&(f.title=h.alternativeText),h.noRotate&&f.classList.add("norotate"),!h.rect||this instanceof O){const{rotation:F}=h;return!h.hasOwnCanvas&&F!==0&&this.setRotation(F,f),f}const{width:a,height:u}=l(h.rect);if(!m&&h.borderStyle.width>0){o.borderWidth=`${h.borderStyle.width}px`;const F=h.borderStyle.horizontalCornerRadius,C=h.borderStyle.verticalCornerRadius;if(F>0||C>0){const K=`calc(${F}px * var(--scale-factor)) / calc(${C}px * var(--scale-factor))`;o.borderRadius=K}else if(this instanceof S){const K=`calc(${a}px * var(--scale-factor)) / calc(${u}px * var(--scale-factor))`;o.borderRadius=K}switch(h.borderStyle.style){case w.AnnotationBorderStyleType.SOLID:o.borderStyle="solid";break;case w.AnnotationBorderStyleType.DASHED:o.borderStyle="dashed";break;case w.AnnotationBorderStyleType.BEVELED:(0,w.warn)("Unimplemented border style: beveled");break;case w.AnnotationBorderStyleType.INSET:(0,w.warn)("Unimplemented border style: inset");break;case w.AnnotationBorderStyleType.UNDERLINE:o.borderBottomStyle="solid";break}const $=h.borderColor||null;$?(this.#e=!0,o.borderColor=w.Util.makeHexColor($[0]|0,$[1]|0,$[2]|0)):o.borderWidth=0}const A=w.Util.normalizeRect([h.rect[0],e.view[3]-h.rect[1]+e.view[1],h.rect[2],e.view[3]-h.rect[3]+e.view[1]]),{pageWidth:E,pageHeight:R,pageX:k,pageY:D}=n.rawDims;o.left=`${100*(A[0]-k)/E}%`,o.top=`${100*(A[1]-D)/R}%`;const{rotation:N}=h;return h.hasOwnCanvas||N===0?(o.width=`${100*a/E}%`,o.height=`${100*u/R}%`):this.setRotation(N,f),f}setRotation(m,h=this.container){if(!this.data.rect)return;const{pageWidth:e,pageHeight:n}=this.parent.viewport.rawDims,{width:f,height:o}=l(this.data.rect);let a,u;m%180===0?(a=100*f/e,u=100*o/n):(a=100*o/e,u=100*f/n),h.style.width=`${a}%`,h.style.height=`${u}%`,h.setAttribute("data-main-rotation",(360-m)%360)}get _commonActions(){const m=(h,e,n)=>{const f=n.detail[h],o=f[0],a=f.slice(1);n.target.style[e]=T[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[e]:T[`${o}_rgb`](a)})};return(0,w.shadow)(this,"_commonActions",{display:h=>{const{display:e}=h.detail,n=e%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:e===1||e===2})},print:h=>{this.annotationStorage.setValue(this.data.id,{noPrint:!h.detail.print})},hidden:h=>{const{hidden:e}=h.detail;this.container.style.visibility=e?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:e,noView:e})},focus:h=>{setTimeout(()=>h.target.focus({preventScroll:!1}),0)},userName:h=>{h.target.title=h.detail.userName},readonly:h=>{h.target.disabled=h.detail.readonly},required:h=>{this._setRequired(h.target,h.detail.required)},bgColor:h=>{m("bgColor","backgroundColor",h)},fillColor:h=>{m("fillColor","backgroundColor",h)},fgColor:h=>{m("fgColor","color",h)},textColor:h=>{m("textColor","color",h)},borderColor:h=>{m("borderColor","borderColor",h)},strokeColor:h=>{m("strokeColor","borderColor",h)},rotation:h=>{const e=h.detail.rotation;this.setRotation(e),this.annotationStorage.setValue(this.data.id,{rotation:e})}})}_dispatchEventFromSandbox(m,h){const e=this._commonActions;for(const n of Object.keys(h.detail))(m[n]||e[n])?.(h)}_setDefaultPropertiesFromJS(m){if(!this.enableScripting)return;const h=this.annotationStorage.getRawValue(this.data.id);if(!h)return;const e=this._commonActions;for(const[n,f]of Object.entries(h)){const o=e[n];if(o){const a={detail:{[n]:f},target:m};o(a),delete h[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:m}=this.data;if(!m)return;const[h,e,n,f]=this.data.rect;if(m.length===1){const[,{x:F,y:C},{x:$,y:K}]=m[0];if(n===F&&f===C&&h===$&&e===K)return}const{style:o}=this.container;let a;if(this.#e){const{borderColor:F,borderWidth:C}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${F}" stroke-width="${C}">`],this.container.classList.add("hasBorder")}const u=n-h,A=f-e,{svgFactory:E}=this,R=E.createElement("svg");R.classList.add("quadrilateralsContainer"),R.setAttribute("width",0),R.setAttribute("height",0);const k=E.createElement("defs");R.append(k);const D=E.createElement("clipPath"),N=`clippath_${this.data.id}`;D.setAttribute("id",N),D.setAttribute("clipPathUnits","objectBoundingBox"),k.append(D);for(const[,{x:F,y:C},{x:$,y:K}]of m){const X=E.createElement("rect"),W=($-h)/u,rt=(f-C)/A,J=(F-$)/u,Q=(C-K)/A;X.setAttribute("x",W),X.setAttribute("y",rt),X.setAttribute("width",J),X.setAttribute("height",Q),D.append(X),a?.push(`<rect vector-effect="non-scaling-stroke" x="${W}" y="${rt}" width="${J}" height="${Q}"/>`)}this.#e&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(R),this.container.style.clipPath=`url(#${N})`}_createPopup(){const{container:m,data:h}=this;m.setAttribute("aria-haspopup","dialog");const e=new O({data:{color:h.color,titleObj:h.titleObj,modificationDate:h.modificationDate,contentsObj:h.contentsObj,richText:h.richText,parentRect:h.rect,borderStyle:0,id:`popup_${h.id}`,rotation:h.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){(0,w.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(m,h=null){const e=[];if(this._fieldObjects){const n=this._fieldObjects[m];if(n)for(const{page:f,id:o,exportValues:a}of n){if(f===-1||o===h)continue;const u=typeof a=="string"?a:null,A=document.querySelector(`[data-element-id="${o}"]`);if(A&&!d.has(A)){(0,w.warn)(`_getElementsByName - element not allowed: ${o}`);continue}e.push({id:o,exportValue:u,domElement:A})}return e}for(const n of document.getElementsByName(m)){const{exportValue:f}=n,o=n.getAttribute("data-element-id");o!==h&&d.has(n)&&e.push({id:o,exportValue:f,domElement:n})}return e}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const m=this.getElementsToTriggerPopup();if(Array.isArray(m))for(const h of m)h.classList.add("highlightArea");else m.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:m,data:{id:h}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:m,editId:h})})}}class g extends s{constructor(m,h=null){super(m,{isRenderable:!0,ignoreBorder:!!h?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=m.data.isTooltipOnly}render(){const{data:m,linkService:h}=this,e=document.createElement("a");e.setAttribute("data-element-id",m.id);let n=!1;return m.url?(h.addLinkAttributes(e,m.url,m.newWindow),n=!0):m.action?(this._bindNamedAction(e,m.action),n=!0):m.attachment?(this.#e(e,m.attachment,m.attachmentDest),n=!0):m.setOCGState?(this.#s(e,m.setOCGState),n=!0):m.dest?(this._bindLink(e,m.dest),n=!0):(m.actions&&(m.actions.Action||m.actions["Mouse Up"]||m.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(e,m),n=!0),m.resetForm?(this._bindResetFormAction(e,m.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(e,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(e),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(m,h){m.href=this.linkService.getDestinationHash(h),m.onclick=()=>(h&&this.linkService.goToDestination(h),!1),(h||h==="")&&this.#t()}_bindNamedAction(m,h){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.linkService.executeNamedAction(h),!1),this.#t()}#e(m,h,e=null){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.downloadManager?.openOrDownloadData(h.content,h.filename,e),!1),this.#t()}#s(m,h){m.href=this.linkService.getAnchorUrl(""),m.onclick=()=>(this.linkService.executeSetOCGState(h),!1),this.#t()}_bindJSAction(m,h){m.href=this.linkService.getAnchorUrl("");const e=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(h.actions)){const f=e.get(n);f&&(m[f]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h.id,name:n}}),!1))}m.onclick||(m.onclick=()=>!1),this.#t()}_bindResetFormAction(m,h){const e=m.onclick;if(e||(m.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,w.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),e||(m.onclick=()=>!1);return}m.onclick=()=>{e?.();const{fields:n,refs:f,include:o}=h,a=[];if(n.length!==0||f.length!==0){const E=new Set(f);for(const R of n){const k=this._fieldObjects[R]||[];for(const{id:D}of k)E.add(D)}for(const R of Object.values(this._fieldObjects))for(const k of R)E.has(k.id)===o&&a.push(k)}else for(const E of Object.values(this._fieldObjects))a.push(...E);const u=this.annotationStorage,A=[];for(const E of a){const{id:R}=E;switch(A.push(R),E.type){case"text":{const D=E.defaultValue||"";u.setValue(R,{value:D});break}case"checkbox":case"radiobutton":{const D=E.defaultValue===E.exportValues;u.setValue(R,{value:D});break}case"combobox":case"listbox":{const D=E.defaultValue||"";u.setValue(R,{value:D});break}default:continue}const k=document.querySelector(`[data-element-id="${R}"]`);if(k){if(!d.has(k)){(0,w.warn)(`_bindResetFormAction - element not allowed: ${R}`);continue}}else continue;k.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:A,name:"ResetForm"}}),!1}}}class t extends s{constructor(m){super(m,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const m=document.createElement("img");return m.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",m.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),m.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(m),this.container}}class i extends s{render(){return this.container}showElementAndHideCanvas(m){this.data.hasOwnCanvas&&(m.previousSibling?.nodeName==="CANVAS"&&(m.previousSibling.hidden=!0),m.hidden=!1)}_getKeyModifier(m){return w.FeatureTest.platform.isMac?m.metaKey:m.ctrlKey}_setEventListener(m,h,e,n,f){e.includes("mouse")?m.addEventListener(e,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:f(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):m.addEventListener(e,o=>{if(e==="blur"){if(!h.focused||!o.relatedTarget)return;h.focused=!1}else if(e==="focus"){if(h.focused)return;h.focused=!0}f&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:f(o)}})})}_setEventListeners(m,h,e,n){for(const[f,o]of e)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(h||={focused:!1}),this._setEventListener(m,h,f,o,n),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(m,h,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(m,h,"focus","Focus",null))}_setBackgroundColor(m){const h=this.data.backgroundColor||null;m.style.backgroundColor=h===null?"transparent":w.Util.makeHexColor(h[0],h[1],h[2])}_setTextStyle(m){const h=["left","center","right"],{fontColor:e}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||r,f=m.style;let o;const a=2,u=A=>Math.round(10*A)/10;if(this.data.multiLine){const A=Math.abs(this.data.rect[3]-this.data.rect[1]-a),E=Math.round(A/(w.LINE_FACTOR*n))||1,R=A/E;o=Math.min(n,u(R/w.LINE_FACTOR))}else{const A=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(n,u(A/w.LINE_FACTOR))}f.fontSize=`calc(${o}px * var(--scale-factor))`,f.color=w.Util.makeHexColor(e[0],e[1],e[2]),this.data.textAlignment!==null&&(f.textAlign=h[this.data.textAlignment])}_setRequired(m,h){h?m.setAttribute("required",!0):m.removeAttribute("required"),m.setAttribute("aria-required",h)}}class c extends i{constructor(m){const h=m.renderForms||m.data.hasOwnCanvas||!m.data.hasAppearance&&!!m.data.fieldValue;super(m,{isRenderable:h})}setPropertyOnSiblings(m,h,e,n){const f=this.annotationStorage;for(const o of this._getElementsByName(m.name,m.id))o.domElement&&(o.domElement[h]=e),f.setValue(o.id,{[n]:e})}render(){const m=this.annotationStorage,h=this.data.id;this.container.classList.add("textWidgetAnnotation");let e=null;if(this.renderForms){const n=m.getValue(h,{value:this.data.fieldValue});let f=n.value||"";const o=m.getValue(h,{charLimit:this.data.maxLen}).charLimit;o&&f.length>o&&(f=f.slice(0,o));let a=n.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const u={userValue:f,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(e=document.createElement("textarea"),e.textContent=a??f,this.data.doNotScroll&&(e.style.overflowY="hidden")):(e=document.createElement("input"),e.type="text",e.setAttribute("value",a??f),this.data.doNotScroll&&(e.style.overflowX="hidden")),this.data.hasOwnCanvas&&(e.hidden=!0),d.add(e),e.setAttribute("data-element-id",h),e.disabled=this.data.readOnly,e.name=this.data.fieldName,e.tabIndex=v,this._setRequired(e,this.data.required),o&&(e.maxLength=o),e.addEventListener("input",E=>{m.setValue(h,{value:E.target.value}),this.setPropertyOnSiblings(e,"value",E.target.value,"value"),u.formattedValue=null}),e.addEventListener("resetform",E=>{const R=this.data.defaultFieldValue??"";e.value=u.userValue=R,u.formattedValue=null});let A=E=>{const{formattedValue:R}=u;R!=null&&(E.target.value=R),E.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){e.addEventListener("focus",R=>{if(u.focused)return;const{target:k}=R;u.userValue&&(k.value=u.userValue),u.lastCommittedValue=k.value,u.commitKey=1,this.data.actions?.Focus||(u.focused=!0)}),e.addEventListener("updatefromsandbox",R=>{this.showElementAndHideCanvas(R.target);const k={value(D){u.userValue=D.detail.value??"",m.setValue(h,{value:u.userValue.toString()}),D.target.value=u.userValue},formattedValue(D){const{formattedValue:N}=D.detail;u.formattedValue=N,N!=null&&D.target!==document.activeElement&&(D.target.value=N),m.setValue(h,{formattedValue:N})},selRange(D){D.target.setSelectionRange(...D.detail.selRange)},charLimit:D=>{const{charLimit:N}=D.detail,{target:F}=D;if(N===0){F.removeAttribute("maxLength");return}F.setAttribute("maxLength",N);let C=u.userValue;!C||C.length<=N||(C=C.slice(0,N),F.value=u.userValue=C,m.setValue(h,{value:C}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:F.selectionStart,selEnd:F.selectionEnd}}))}};this._dispatchEventFromSandbox(k,R)}),e.addEventListener("keydown",R=>{u.commitKey=1;let k=-1;if(R.key==="Escape"?k=0:R.key==="Enter"&&!this.data.multiLine?k=2:R.key==="Tab"&&(u.commitKey=3),k===-1)return;const{value:D}=R.target;u.lastCommittedValue!==D&&(u.lastCommittedValue=D,u.userValue=D,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:D,willCommit:!0,commitKey:k,selStart:R.target.selectionStart,selEnd:R.target.selectionEnd}}))});const E=A;A=null,e.addEventListener("blur",R=>{if(!u.focused||!R.relatedTarget)return;this.data.actions?.Blur||(u.focused=!1);const{value:k}=R.target;u.userValue=k,u.lastCommittedValue!==k&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:k,willCommit:!0,commitKey:u.commitKey,selStart:R.target.selectionStart,selEnd:R.target.selectionEnd}}),E(R)}),this.data.actions?.Keystroke&&e.addEventListener("beforeinput",R=>{u.lastCommittedValue=null;const{data:k,target:D}=R,{value:N,selectionStart:F,selectionEnd:C}=D;let $=F,K=C;switch(R.inputType){case"deleteWordBackward":{const X=N.substring(0,F).match(/\w*[^\w]*$/);X&&($-=X[0].length);break}case"deleteWordForward":{const X=N.substring(F).match(/^[^\w]*\w*/);X&&(K+=X[0].length);break}case"deleteContentBackward":F===C&&($-=1);break;case"deleteContentForward":F===C&&(K+=1);break}R.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:N,change:k||"",willCommit:!1,selStart:$,selEnd:K}})}),this._setEventListeners(e,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],R=>R.target.value)}if(A&&e.addEventListener("blur",A),this.data.comb){const R=(this.data.rect[2]-this.data.rect[0])/o;e.classList.add("comb"),e.style.letterSpacing=`calc(${R}px * var(--scale-factor) - 1ch)`}}else e=document.createElement("div"),e.textContent=this.data.fieldValue,e.style.verticalAlign="middle",e.style.display="table-cell",this.data.hasOwnCanvas&&(e.hidden=!0);return this._setTextStyle(e),this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class p extends i{constructor(m){super(m,{isRenderable:!!m.data.hasOwnCanvas})}}class y extends i{constructor(m){super(m,{isRenderable:m.renderForms})}render(){const m=this.annotationStorage,h=this.data,e=h.id;let n=m.getValue(e,{value:h.exportValue===h.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",m.setValue(e,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const f=document.createElement("input");return d.add(f),f.setAttribute("data-element-id",e),f.disabled=h.readOnly,this._setRequired(f,this.data.required),f.type="checkbox",f.name=h.fieldName,n&&f.setAttribute("checked",!0),f.setAttribute("exportValue",h.exportValue),f.tabIndex=v,f.addEventListener("change",o=>{const{name:a,checked:u}=o.target;for(const A of this._getElementsByName(a,e)){const E=u&&A.exportValue===h.exportValue;A.domElement&&(A.domElement.checked=E),m.setValue(A.id,{value:E})}m.setValue(e,{value:u})}),f.addEventListener("resetform",o=>{const a=h.defaultFieldValue||"Off";o.target.checked=a===h.exportValue}),this.enableScripting&&this.hasJSActions&&(f.addEventListener("updatefromsandbox",o=>{const a={value(u){u.target.checked=u.detail.value!=="Off",m.setValue(e,{value:u.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(f,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(f),this._setDefaultPropertiesFromJS(f),this.container.append(f),this.container}}class S extends i{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const m=this.annotationStorage,h=this.data,e=h.id;let n=m.getValue(e,{value:h.fieldValue===h.buttonValue}).value;if(typeof n=="string"&&(n=n!==h.buttonValue,m.setValue(e,{value:n})),n)for(const o of this._getElementsByName(h.fieldName,e))m.setValue(o.id,{value:!1});const f=document.createElement("input");if(d.add(f),f.setAttribute("data-element-id",e),f.disabled=h.readOnly,this._setRequired(f,this.data.required),f.type="radio",f.name=h.fieldName,n&&f.setAttribute("checked",!0),f.tabIndex=v,f.addEventListener("change",o=>{const{name:a,checked:u}=o.target;for(const A of this._getElementsByName(a,e))m.setValue(A.id,{value:!1});m.setValue(e,{value:u})}),f.addEventListener("resetform",o=>{const a=h.defaultFieldValue;o.target.checked=a!=null&&a===h.buttonValue}),this.enableScripting&&this.hasJSActions){const o=h.buttonValue;f.addEventListener("updatefromsandbox",a=>{const u={value:A=>{const E=o===A.detail.value;for(const R of this._getElementsByName(A.target.name)){const k=E&&R.id===e;R.domElement&&(R.domElement.checked=k),m.setValue(R.id,{value:k})}}};this._dispatchEventFromSandbox(u,a)}),this._setEventListeners(f,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(f),this._setDefaultPropertiesFromJS(f),this.container.append(f),this.container}}class L extends g{constructor(m){super(m,{ignoreBorder:m.data.hasAppearance})}render(){const m=super.render();m.classList.add("buttonWidgetAnnotation","pushButton");const h=m.lastChild;return this.enableScripting&&this.hasJSActions&&h&&(this._setDefaultPropertiesFromJS(h),h.addEventListener("updatefromsandbox",e=>{this._dispatchEventFromSandbox({},e)})),m}}class M extends i{constructor(m){super(m,{isRenderable:m.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const m=this.annotationStorage,h=this.data.id,e=m.getValue(h,{value:this.data.fieldValue}),n=document.createElement("select");d.add(n),n.setAttribute("data-element-id",h),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=v;let f=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",E=>{const R=this.data.defaultFieldValue;for(const k of n.options)k.selected=k.value===R});for(const E of this.data.options){const R=document.createElement("option");R.textContent=E.displayValue,R.value=E.exportValue,e.value.includes(E.exportValue)&&(R.setAttribute("selected",!0),f=!1),n.append(R)}let o=null;if(f){const E=document.createElement("option");E.value=" ",E.setAttribute("hidden",!0),E.setAttribute("selected",!0),n.prepend(E),o=()=>{E.remove(),n.removeEventListener("input",o),o=null},n.addEventListener("input",o)}const a=E=>{const R=E?"value":"textContent",{options:k,multiple:D}=n;return D?Array.prototype.filter.call(k,N=>N.selected).map(N=>N[R]):k.selectedIndex===-1?null:k[k.selectedIndex][R]};let u=a(!1);const A=E=>{const R=E.target.options;return Array.prototype.map.call(R,k=>({displayValue:k.textContent,exportValue:k.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",E=>{const R={value(k){o?.();const D=k.detail.value,N=new Set(Array.isArray(D)?D:[D]);for(const F of n.options)F.selected=N.has(F.value);m.setValue(h,{value:a(!0)}),u=a(!1)},multipleSelection(k){n.multiple=!0},remove(k){const D=n.options,N=k.detail.remove;D[N].selected=!1,n.remove(N),D.length>0&&Array.prototype.findIndex.call(D,C=>C.selected)===-1&&(D[0].selected=!0),m.setValue(h,{value:a(!0),items:A(k)}),u=a(!1)},clear(k){for(;n.length!==0;)n.remove(0);m.setValue(h,{value:null,items:[]}),u=a(!1)},insert(k){const{index:D,displayValue:N,exportValue:F}=k.detail.insert,C=n.children[D],$=document.createElement("option");$.textContent=N,$.value=F,C?C.before($):n.append($),m.setValue(h,{value:a(!0),items:A(k)}),u=a(!1)},items(k){const{items:D}=k.detail;for(;n.length!==0;)n.remove(0);for(const N of D){const{displayValue:F,exportValue:C}=N,$=document.createElement("option");$.textContent=F,$.value=C,n.append($)}n.options.length>0&&(n.options[0].selected=!0),m.setValue(h,{value:a(!0),items:A(k)}),u=a(!1)},indices(k){const D=new Set(k.detail.indices);for(const N of k.target.options)N.selected=D.has(N.index);m.setValue(h,{value:a(!0)}),u=a(!1)},editable(k){k.target.disabled=!k.detail.editable}};this._dispatchEventFromSandbox(R,E)}),n.addEventListener("input",E=>{const R=a(!0),k=a(!1);m.setValue(h,{value:R}),E.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:u,change:k,changeEx:R,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],E=>E.target.value)):n.addEventListener("input",function(E){m.setValue(h,{value:a(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class O extends s{constructor(m){const{data:h,elements:e}=m;super(m,{isRenderable:s._hasPopupData(h)}),this.elements=e}render(){this.container.classList.add("popupAnnotation");const m=new _({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),h=[];for(const e of this.elements)e.popup=m,h.push(e.data.id),e.addHighlightArea();return this.container.setAttribute("aria-controls",h.map(e=>`${w.AnnotationPrefix}${e}`).join(",")),this.container}}class _{#t=this.#m.bind(this);#e=this.#C.bind(this);#s=this.#w.bind(this);#n=this.#v.bind(this);#r=null;#i=null;#a=null;#l=null;#h=null;#d=null;#u=null;#c=!1;#o=null;#p=null;#g=null;#f=null;#A=!1;constructor({container:m,color:h,elements:e,titleObj:n,modificationDate:f,contentsObj:o,richText:a,parent:u,rect:A,parentRect:E,open:R}){this.#i=m,this.#f=n,this.#a=o,this.#g=a,this.#d=u,this.#r=h,this.#p=A,this.#u=E,this.#h=e,this.#l=B.PDFDateString.toDateObject(f),this.trigger=e.flatMap(k=>k.getElementsToTriggerPopup());for(const k of this.trigger)k.addEventListener("click",this.#n),k.addEventListener("mouseenter",this.#s),k.addEventListener("mouseleave",this.#e),k.classList.add("popupTriggerArea");for(const k of e)k.container?.addEventListener("keydown",this.#t);this.#i.hidden=!0,R&&this.#v()}render(){if(this.#o)return;const{page:{view:m},viewport:{rawDims:{pageWidth:h,pageHeight:e,pageX:n,pageY:f}}}=this.#d,o=this.#o=document.createElement("div");if(o.className="popup",this.#r){const X=o.style.outlineColor=w.Util.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?o.style.backgroundColor=`color-mix(in srgb, ${X} 30%, white)`:o.style.backgroundColor=w.Util.makeHexColor(...this.#r.map(rt=>Math.floor(.7*(255-rt)+rt)))}const a=document.createElement("span");a.className="header";const u=document.createElement("h1");if(a.append(u),{dir:u.dir,str:u.textContent}=this.#f,o.append(a),this.#l){const X=document.createElement("span");X.classList.add("popupDate"),X.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),X.setAttribute("data-l10n-args",JSON.stringify({date:this.#l.toLocaleDateString(),time:this.#l.toLocaleTimeString()})),a.append(X)}const A=this.#a,E=this.#g;if(E?.str&&(!A?.str||A.str===E.str))x.XfaLayer.render({xfaHtml:E.html,intent:"richText",div:o}),o.lastChild.classList.add("richText","popupContent");else{const X=this._formatContents(A);o.append(X)}let R=!!this.#u,k=R?this.#u:this.#p;for(const X of this.#h)if(!k||w.Util.intersect(X.data.rect,k)!==null){k=X.data.rect,R=!0;break}const D=w.Util.normalizeRect([k[0],m[3]-k[1]+m[1],k[2],m[3]-k[3]+m[1]]),F=R?k[2]-k[0]+5:0,C=D[0]+F,$=D[1],{style:K}=this.#i;K.left=`${100*(C-n)/h}%`,K.top=`${100*($-f)/e}%`,this.#i.append(o)}_formatContents({str:m,dir:h}){const e=document.createElement("p");e.classList.add("popupContent"),e.dir=h;const n=m.split(/(?:\r\n?|\n)/);for(let f=0,o=n.length;f<o;++f){const a=n[f];e.append(document.createTextNode(a)),f<o-1&&e.append(document.createElement("br"))}return e}#m(m){m.altKey||m.shiftKey||m.ctrlKey||m.metaKey||(m.key==="Enter"||m.key==="Escape"&&this.#c)&&this.#v()}#v(){this.#c=!this.#c,this.#c?(this.#w(),this.#i.addEventListener("click",this.#n),this.#i.addEventListener("keydown",this.#t)):(this.#C(),this.#i.removeEventListener("click",this.#n),this.#i.removeEventListener("keydown",this.#t))}#w(){this.#o||this.render(),this.isVisible?this.#c&&this.#i.classList.add("focused"):(this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#C(){this.#i.classList.remove("focused"),!(this.#c||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#A=this.isVisible,this.#A&&(this.#i.hidden=!0)}maybeShow(){this.#A&&(this.#A=!1,this.#i.hidden=!1)}get isVisible(){return this.#i.hidden===!1}}class z extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.textContent=m.data.textContent,this.textPosition=m.data.textPosition,this.annotationEditorType=w.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const m=document.createElement("div");m.classList.add("annotationTextContent"),m.setAttribute("role","comment");for(const h of this.textContent){const e=document.createElement("span");e.textContent=h,m.append(e)}this.container.append(m)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class q extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0),f=this.#t=this.svgFactory.createElement("svg:line");return f.setAttribute("x1",m.rect[2]-m.lineCoordinates[0]),f.setAttribute("y1",m.rect[3]-m.lineCoordinates[1]),f.setAttribute("x2",m.rect[2]-m.lineCoordinates[2]),f.setAttribute("y2",m.rect[3]-m.lineCoordinates[3]),f.setAttribute("stroke-width",m.borderStyle.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),n.append(f),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class nt extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0),f=m.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",f/2),o.setAttribute("y",f/2),o.setAttribute("width",h-f),o.setAttribute("height",e-f),o.setAttribute("stroke-width",f||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class j extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0),f=m.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",h/2),o.setAttribute("cy",e/2),o.setAttribute("rx",h/2-f/2),o.setAttribute("ry",e/2-f/2),o.setAttribute("stroke-width",f||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class H extends s{#t=null;constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0);let f=[];for(const a of m.vertices){const u=a.x-m.rect[0],A=m.rect[3]-a.y;f.push(u+","+A)}f=f.join(" ");const o=this.#t=this.svgFactory.createElement(this.svgElementName);return o.setAttribute("points",f),o.setAttribute("stroke-width",m.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!m.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class U extends H{constructor(m){super(m),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Y extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class et extends s{#t=[];constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=w.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const m=this.data,{width:h,height:e}=l(m.rect),n=this.svgFactory.create(h,e,!0);for(const f of m.inkLists){let o=[];for(const u of f){const A=u.x-m.rect[0],E=m.rect[3]-u.y;o.push(`${A},${E}`)}o=o.join(" ");const a=this.svgFactory.createElement(this.svgElementName);this.#t.push(a),a.setAttribute("points",o),a.setAttribute("stroke-width",m.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),!m.popupRef&&this.hasPopupData&&this._createPopup(),n.append(a)}return this.container.append(n),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class tt extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class ot extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ct extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class pt extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class dt extends s{constructor(m){super(m,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class ht extends s{#t=null;constructor(m){super(m,{isRenderable:!0});const{filename:h,content:e}=this.data.file;this.filename=(0,B.getFilenameFromUrl)(h,!0),this.content=e,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:h,content:e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:m,data:h}=this;let e;h.hasAppearance||h.fillAlpha===0?e=document.createElement("div"):(e=document.createElement("img"),e.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(h.name)?"paperclip":"pushpin"}.svg`,h.fillAlpha&&h.fillAlpha<1&&(e.style=`filter: opacity(${Math.round(h.fillAlpha*100)}%);`)),e.addEventListener("dblclick",this.#e.bind(this)),this.#t=e;const{isMac:n}=w.FeatureTest.platform;return m.addEventListener("keydown",f=>{f.key==="Enter"&&(n?f.metaKey:f.ctrlKey)&&this.#e()}),!h.popupRef&&this.hasPopupData?this._createPopup():e.classList.add("popupTriggerArea"),m.append(e),m}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class ut{#t=null;#e=null;#s=new Map;constructor({div:m,accessibilityManager:h,annotationCanvasMap:e,annotationEditorUIManager:n,page:f,viewport:o}){this.div=m,this.#t=h,this.#e=e,this.page=f,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=n}#n(m,h){const e=m.firstChild||m;e.id=`${w.AnnotationPrefix}${h}`,this.div.append(m),this.#t?.moveElementInDOM(this.div,m,e,!1)}async render(m){const{annotations:h}=m,e=this.div;(0,B.setLayerDimensions)(e,this.viewport);const n=new Map,f={data:null,layer:e,linkService:m.linkService,downloadManager:m.downloadManager,imageResourcesPath:m.imageResourcesPath||"",renderForms:m.renderForms!==!1,svgFactory:new B.DOMSVGFactory,annotationStorage:m.annotationStorage||new I.AnnotationStorage,enableScripting:m.enableScripting===!0,hasJSActions:m.hasJSActions,fieldObjects:m.fieldObjects,parent:this,elements:null};for(const o of h){if(o.noHTML)continue;const a=o.annotationType===w.AnnotationType.POPUP;if(a){const E=n.get(o.id);if(!E)continue;f.elements=E}else{const{width:E,height:R}=l(o.rect);if(E<=0||R<=0)continue}f.data=o;const u=b.create(f);if(!u.isRenderable)continue;if(!a&&o.popupRef){const E=n.get(o.popupRef);E?E.push(u):n.set(o.popupRef,[u])}const A=u.render();o.hidden&&(A.style.visibility="hidden"),this.#n(A,o.id),u.annotationEditorType>0&&(this.#s.set(u.data.id,u),this._annotationEditorUIManager?.renderAnnotationElement(u))}this.#r()}update({viewport:m}){const h=this.div;this.viewport=m,(0,B.setLayerDimensions)(h,{rotation:m.rotation}),this.#r(),h.hidden=!1}#r(){if(!this.#e)return;const m=this.div;for(const[h,e]of this.#e){const n=m.querySelector(`[data-annotation-id="${h}"]`);if(!n)continue;e.className="annotationContent";const{firstChild:f}=n;f?f.nodeName==="CANVAS"?f.replaceWith(e):f.classList.contains("annotationContent")?f.after(e):f.before(e):n.append(e)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(m){return this.#s.get(m)}}},792:(at,Z,V)=>{V.d(Z,{AnnotationStorage:()=>P,PrintAnnotationStorage:()=>T,SerializableEmpty:()=>G});var w=V(292),B=V(310),I=V(651);const G=Object.freeze({map:null,hash:"",transfer:void 0});class P{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(v,r){const d=this.#e.get(v);return d===void 0?r:Object.assign(r,d)}getRawValue(v){return this.#e.get(v)}remove(v){if(this.#e.delete(v),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const r of this.#e.values())if(r instanceof B.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(v,r){const d=this.#e.get(v);let l=!1;if(d!==void 0)for(const[b,s]of Object.entries(r))d[b]!==s&&(l=!0,d[b]=s);else l=!0,this.#e.set(v,r);l&&this.#s(),r instanceof B.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(r.constructor._type)}has(v){return this.#e.has(v)}getAll(){return this.#e.size>0?(0,w.objectFromMap)(this.#e):null}setAll(v){for(const[r,d]of Object.entries(v))this.setValue(r,d)}get size(){return this.#e.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new T(this)}get serializable(){if(this.#e.size===0)return G;const v=new Map,r=new I.MurmurHash3_64,d=[],l=Object.create(null);let b=!1;for(const[s,g]of this.#e){const t=g instanceof B.AnnotationEditor?g.serialize(!1,l):g;t&&(v.set(s,t),r.update(`${s}:${JSON.stringify(t)}`),b||=!!t.bitmap)}if(b)for(const s of v.values())s.bitmap&&d.push(s.bitmap);return v.size>0?{map:v,hash:r.hexdigest(),transfer:d}:G}get editorStats(){let v=null;const r=new Map;for(const d of this.#e.values()){if(!(d instanceof B.AnnotationEditor))continue;const l=d.telemetryFinalData;if(!l)continue;const{type:b}=l;r.has(b)||r.set(b,Object.getPrototypeOf(d).constructor),v||=Object.create(null);const s=v[b]||=new Map;for(const[g,t]of Object.entries(l)){if(g==="type")continue;let i=s.get(g);i||(i=new Map,s.set(g,i));const c=i.get(t)??0;i.set(t,c+1)}}for(const[d,l]of r)v[d]=l.computeTelemetryFinalData(v[d]);return v}}class T extends P{#t;constructor(v){super();const{map:r,hash:d,transfer:l}=v.serializable,b=structuredClone(r,l?{transfer:l}:null);this.#t={map:b,hash:d,transfer:l}}get print(){(0,w.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}},831:(at,Z,V)=>{V.a(at,async(w,B)=>{try{let nt=function(o){if(typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o}),typeof o!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!o.url&&!o.data&&!o.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const a=new et,{docId:u}=a,A=o.url?H(o.url):null,E=o.data?U(o.data):null,R=o.httpHeaders||null,k=o.withCredentials===!0,D=o.password??null,N=o.range instanceof tt?o.range:null,F=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:S;let C=o.worker instanceof ht?o.worker:null;const $=o.verbosity,K=typeof o.docBaseUrl=="string"&&!(0,P.isDataScheme)(o.docBaseUrl)?o.docBaseUrl:null,X=typeof o.cMapUrl=="string"?o.cMapUrl:null,W=o.cMapPacked!==!1,rt=o.CMapReaderFactory||_,J=typeof o.standardFontDataUrl=="string"?o.standardFontDataUrl:null,Q=o.StandardFontDataFactory||q,it=o.stopAtErrors!==!0,lt=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,gt=o.isEvalSupported!==!1,At=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!I.isNodeJS,yt=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,mt=typeof o.disableFontFace=="boolean"?o.disableFontFace:I.isNodeJS,kt=o.fontExtraProperties===!0,xt=o.enableXfa===!0,Rt=o.ownerDocument||globalThis.document,wt=o.disableRange===!0,Tt=o.disableStream===!0,Ft=o.disableAutoFetch===!0,It=o.pdfBug===!0,_t=N?N.length:o.length??NaN,Ut=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!I.isNodeJS&&!mt,Nt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:rt===P.DOMCMapReaderFactory&&Q===P.DOMStandardFontDataFactory&&X&&J&&(0,P.isValidFetchUrl)(X,document.baseURI)&&(0,P.isValidFetchUrl)(J,document.baseURI),Ct=o.canvasFactory||new O({ownerDocument:Rt}),Et=o.filterFactory||new z({docId:u,ownerDocument:Rt}),Gt=null;(0,I.setVerbosityLevel)($);const Ot={canvasFactory:Ct,filterFactory:Et};if(Nt||(Ot.cMapReaderFactory=new rt({baseUrl:X,isCompressed:W}),Ot.standardFontDataFactory=new Q({baseUrl:J})),!C){const Ht={verbosity:$,port:d.GlobalWorkerOptions.workerPort};C=Ht.port?ht.fromPort(Ht):new ht(Ht),a._worker=C}const Dt={docId:u,apiVersion:"4.2.67",data:E,password:D,disableAutoFetch:Ft,rangeChunkSize:F,length:_t,docBaseUrl:K,enableXfa:xt,evaluatorOptions:{maxImageSize:lt,disableFontFace:mt,ignoreErrors:it,isEvalSupported:gt,isOffscreenCanvasSupported:At,canvasMaxAreaInBytes:yt,fontExtraProperties:kt,useSystemFonts:Ut,cMapUrl:Nt?X:null,standardFontDataUrl:Nt?J:null}},St={ignoreErrors:it,disableFontFace:mt,fontExtraProperties:kt,enableXfa:xt,ownerDocument:Rt,disableAutoFetch:Ft,pdfBug:It,styleElement:Gt};return C.promise.then(function(){if(a.destroyed)throw new Error("Loading aborted");const Ht=j(C,Dt),Zt=new Promise(function($t){let Bt;N?Bt=new g.PDFDataTransportStream(N,{disableRange:wt,disableStream:Tt}):E||(Bt=(Pt=>I.isNodeJS?function(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype}()&&(0,P.isValidFetchUrl)(Pt.url)?new t.PDFFetchStream(Pt):new c.PDFNodeStream(Pt):(0,P.isValidFetchUrl)(Pt.url)?new t.PDFFetchStream(Pt):new i.PDFNetworkStream(Pt))({url:A,length:_t,httpHeaders:R,withCredentials:k,rangeChunkSize:F,disableRange:wt,disableStream:Tt})),$t(Bt)});return Promise.all([Ht,Zt]).then(function([$t,Bt]){if(a.destroyed)throw new Error("Loading aborted");const Xt=new l.MessageHandler(u,$t,C.port),Pt=new ut(Xt,a,Bt,St,Ot);a._transport=Pt,Xt.send("Ready",null)})}).catch(a._capability.reject),a},H=function(o){if(o instanceof URL)return o.href;try{return new URL(o,window.location).href}catch{if(I.isNodeJS&&typeof o=="string")return o}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")},U=function(o){if(I.isNodeJS&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return(0,I.stringToBytes)(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")},Y=function(o){return typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0};V.d(Z,{PDFDataRangeTransport:()=>tt,PDFWorker:()=>ht,build:()=>f,getDocument:()=>nt,version:()=>n});var I=V(292),G=V(792),P=V(419),T=V(10),x=V(573),v=V(923),r=V(814),d=V(164),l=V(178),b=V(62),s=V(626),g=V(585),t=V(94),i=V(457),c=V(786),p=V(50),y=w([x,c]);[x,c]=y.then?(await y)():y;const S=65536,L=100,M=5e3,O=I.isNodeJS?x.NodeCanvasFactory:P.DOMCanvasFactory,_=I.isNodeJS?x.NodeCMapReaderFactory:P.DOMCMapReaderFactory,z=I.isNodeJS?x.NodeFilterFactory:P.DOMFilterFactory,q=I.isNodeJS?x.NodeStandardFontDataFactory:P.DOMStandardFontDataFactory;async function j(o,a){if(o.destroyed)throw new Error("Worker was destroyed");const u=await o.messageHandler.sendWithPromise("GetDocRequest",a,a.data?[a.data.buffer]:null);if(o.destroyed)throw new Error("Worker was destroyed");return u}class et{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${et.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(a){throw this._worker?.port&&delete this._worker._pendingDestroy,a}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class tt{constructor(a,u,A=!1,E=null){this.length=a,this.initialData=u,this.progressiveDone=A,this.contentDispositionFilename=E,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(a){this._rangeListeners.push(a)}addProgressListener(a){this._progressListeners.push(a)}addProgressiveReadListener(a){this._progressiveReadListeners.push(a)}addProgressiveDoneListener(a){this._progressiveDoneListeners.push(a)}onDataRange(a,u){for(const A of this._rangeListeners)A(a,u)}onDataProgress(a,u){this._readyCapability.promise.then(()=>{for(const A of this._progressListeners)A(a,u)})}onDataProgressiveRead(a){this._readyCapability.promise.then(()=>{for(const u of this._progressiveReadListeners)u(a)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const a of this._progressiveDoneListeners)a()})}transportReady(){this._readyCapability.resolve()}requestDataRange(a,u){(0,I.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class ot{constructor(a,u){this._pdfInfo=a,this._transport=u}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,I.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(a){return this._transport.getPage(a)}getPageIndex(a){return this._transport.getPageIndex(a)}getDestinations(){return this._transport.getDestinations()}getDestination(a){return this._transport.getDestination(a)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:a="display"}={}){const{renderingIntent:u}=this._transport.getRenderingIntent(a);return this._transport.getOptionalContentConfig(u)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(a=!1){return this._transport.startCleanup(a||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(a){return this._transport.cachedPageNumber(a)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class ct{#t=null;#e=!1;constructor(a,u,A,E=!1){this._pageIndex=a,this._pageInfo=u,this._transport=A,this._stats=E?new P.StatTimer:null,this._pdfBug=E,this.commonObjs=A.commonObjs,this.objs=new m,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:a,rotation:u=this.rotate,offsetX:A=0,offsetY:E=0,dontFlip:R=!1}={}){return new P.PageViewport({viewBox:this.view,scale:a,rotation:u,offsetX:A,offsetY:E,dontFlip:R})}getAnnotations({intent:a="display"}={}){const{renderingIntent:u}=this._transport.getRenderingIntent(a);return this._transport.getAnnotations(this._pageIndex,u)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,I.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:a,viewport:u,intent:A="display",annotationMode:E=I.AnnotationMode.ENABLE,transform:R=null,background:k=null,optionalContentConfigPromise:D=null,annotationCanvasMap:N=null,pageColors:F=null,printAnnotationStorage:C=null}){this._stats?.time("Overall");const $=this._transport.getRenderingIntent(A,E,C),{renderingIntent:K,cacheKey:X}=$;this.#e=!1,this.#n(),D||=this._transport.getOptionalContentConfig(K);let W=this._intentStates.get(X);W||(W=Object.create(null),this._intentStates.set(X,W)),W.streamReaderCancelTimeout&&(clearTimeout(W.streamReaderCancelTimeout),W.streamReaderCancelTimeout=null);const rt=!!(K&I.RenderingIntentFlag.PRINT);W.displayReadyCapability||(W.displayReadyCapability=Promise.withResolvers(),W.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList($));const J=lt=>{W.renderTasks.delete(Q),(this._maybeCleanupAfterRender||rt)&&(this.#e=!0),this.#s(!rt),lt?(Q.capability.reject(lt),this._abortOperatorList({intentState:W,reason:lt instanceof Error?lt:new Error(lt)})):Q.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},Q=new e({callback:J,params:{canvasContext:a,viewport:u,transform:R,background:k},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:N,operatorList:W.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!rt,pdfBug:this._pdfBug,pageColors:F});(W.renderTasks||=new Set).add(Q);const it=Q.task;return Promise.all([W.displayReadyCapability.promise,D]).then(([lt,gt])=>{if(this.destroyed){J();return}if(this._stats?.time("Rendering"),!(gt.renderingIntent&K))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");Q.initializeGraphics({transparency:lt,optionalContentConfig:gt}),Q.operatorListChanged()}).catch(J),it}getOperatorList({intent:a="display",annotationMode:u=I.AnnotationMode.ENABLE,printAnnotationStorage:A=null}={}){function E(){k.operatorList.lastChunk&&(k.opListReadCapability.resolve(k.operatorList),k.renderTasks.delete(D))}const R=this._transport.getRenderingIntent(a,u,A,!0);let k=this._intentStates.get(R.cacheKey);k||(k=Object.create(null),this._intentStates.set(R.cacheKey,k));let D;return k.opListReadCapability||(D=Object.create(null),D.operatorListChanged=E,k.opListReadCapability=Promise.withResolvers(),(k.renderTasks||=new Set).add(D),k.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(R)),k.opListReadCapability.promise}streamTextContent({includeMarkedContent:a=!1,disableNormalization:u=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:a===!0,disableNormalization:u===!0},{highWaterMark:100,size(E){return E.items.length}})}getTextContent(a={}){if(this._transport._htmlForXfa)return this.getXfa().then(A=>p.XfaText.textContent(A));const u=this.streamTextContent(a);return new Promise(function(A,E){function R(){k.read().then(function({value:N,done:F}){if(F){A(D);return}Object.assign(D.styles,N.styles),D.items.push(...N.items),R()},E)}const k=u.getReader(),D={items:[],styles:Object.create(null)};R()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const a=[];for(const u of this._intentStates.values())if(this._abortOperatorList({intentState:u,reason:new Error("Page was destroyed."),force:!0}),!u.opListReadCapability)for(const A of u.renderTasks)a.push(A.completed),A.cancel();return this.objs.clear(),this.#e=!1,this.#n(),Promise.all(a)}cleanup(a=!1){this.#e=!0;const u=this.#s(!1);return a&&u&&(this._stats&&=new P.StatTimer),u}#s(a=!1){if(this.#n(),!this.#e||this.destroyed)return!1;if(a)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},M),!1;for(const{renderTasks:u,operatorList:A}of this._intentStates.values())if(u.size>0||!A.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#n(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(a,u){const A=this._intentStates.get(u);A&&(this._stats?.timeEnd("Page Request"),A.displayReadyCapability?.resolve(a))}_renderPageChunk(a,u){for(let A=0,E=a.length;A<E;A++)u.operatorList.fnArray.push(a.fnArray[A]),u.operatorList.argsArray.push(a.argsArray[A]);u.operatorList.lastChunk=a.lastChunk,u.operatorList.separateAnnots=a.separateAnnots;for(const A of u.renderTasks)A.operatorListChanged();a.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:a,cacheKey:u,annotationStorageSerializable:A}){const{map:E,transfer:R}=A,D=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:a,cacheKey:u,annotationStorage:E},R).getReader(),N=this._intentStates.get(u);N.streamReader=D;const F=()=>{D.read().then(({value:C,done:$})=>{if($){N.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(C,N),F())},C=>{if(N.streamReader=null,!this._transport.destroyed){if(N.operatorList){N.operatorList.lastChunk=!0;for(const $ of N.renderTasks)$.operatorListChanged();this.#s(!0)}if(N.displayReadyCapability)N.displayReadyCapability.reject(C);else if(N.opListReadCapability)N.opListReadCapability.reject(C);else throw C}})};F()}_abortOperatorList({intentState:a,reason:u,force:A=!1}){if(a.streamReader){if(a.streamReaderCancelTimeout&&(clearTimeout(a.streamReaderCancelTimeout),a.streamReaderCancelTimeout=null),!A){if(a.renderTasks.size>0)return;if(u instanceof P.RenderingCancelledException){let E=L;u.extraDelay>0&&u.extraDelay<1e3&&(E+=u.extraDelay),a.streamReaderCancelTimeout=setTimeout(()=>{a.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:a,reason:u,force:!0})},E);return}}if(a.streamReader.cancel(new I.AbortException(u.message)).catch(()=>{}),a.streamReader=null,!this._transport.destroyed){for(const[E,R]of this._intentStates)if(R===a){this._intentStates.delete(E);break}this.cleanup()}}}get stats(){return this._stats}}class pt{#t=new Set;#e=Promise.resolve();postMessage(a,u){const A={data:structuredClone(a,u?{transfer:u}:null)};this.#e.then(()=>{for(const E of this.#t)E.call(this,A)})}addEventListener(a,u){this.#t.add(u)}removeEventListener(a,u){this.#t.delete(u)}terminate(){this.#t.clear()}}const dt={isWorkerDisabled:!1,fakeWorkerId:0};I.isNodeJS&&(dt.isWorkerDisabled=!0,d.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),dt.isSameOrigin=function(o,a){let u;try{if(u=new URL(o),!u.origin||u.origin==="null")return!1}catch{return!1}const A=new URL(a,u);return u.origin===A.origin},dt.createCDNWrapper=function(o){const a=`await import("${o}");`;return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))};class ht{static#t;constructor({name:a=null,port:u=null,verbosity:A=(0,I.getVerbosityLevel)()}={}){if(this.name=a,this.destroyed=!1,this.verbosity=A,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,u){if(ht.#t?.has(u))throw new Error("Cannot use more than one PDFWorker per port.");(ht.#t||=new WeakMap).set(u,this),this._initializeFromPort(u);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(a){this._port=a,this._messageHandler=new l.MessageHandler("main","worker",a),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!dt.isWorkerDisabled&&!ht.#e){let{workerSrc:a}=ht;try{dt.isSameOrigin(window.location.href,a)||(a=dt.createCDNWrapper(new URL(a,window.location).href));const u=new Worker(a,{type:"module"}),A=new l.MessageHandler("main","worker",u),E=()=>{u.removeEventListener("error",R),A.destroy(),u.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},R=()=>{this._webWorker||E()};u.addEventListener("error",R),A.on("test",D=>{if(u.removeEventListener("error",R),this.destroyed){E();return}D?(this._messageHandler=A,this._port=u,this._webWorker=u,this._readyCapability.resolve(),A.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),A.destroy(),u.terminate())}),A.on("ready",D=>{if(u.removeEventListener("error",R),this.destroyed){E();return}try{k()}catch{this._setupFakeWorker()}});const k=()=>{const D=new Uint8Array;A.send("test",D,[D.buffer])};k();return}catch{(0,I.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){dt.isWorkerDisabled||((0,I.warn)("Setting up fake worker."),dt.isWorkerDisabled=!0),ht._setupFakeWorkerGlobal.then(a=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const u=new pt;this._port=u;const A=`fake${dt.fakeWorkerId++}`,E=new l.MessageHandler(A+"_worker",A,u);a.setup(E,u);const R=new l.MessageHandler(A,A+"_worker",u);this._messageHandler=R,this._readyCapability.resolve(),R.send("configure",{verbosity:this.verbosity})}).catch(a=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${a.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),ht.#t?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(a){if(!a?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const u=this.#t?.get(a.port);if(u){if(u._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return u}return new ht(a)}static get workerSrc(){if(d.GlobalWorkerOptions.workerSrc)return d.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#e(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const a=async()=>this.#e?this.#e:(await Lt(()=>import(this.workerSrc),[])).WorkerMessageHandler;return(0,I.shadow)(this,"_setupFakeWorkerGlobal",a())}}class ut{#t=new Map;#e=new Map;#s=new Map;#n=new Map;#r=null;constructor(a,u,A,E,R){this.messageHandler=a,this.loadingTask=u,this.commonObjs=new m,this.fontLoader=new T.FontLoader({ownerDocument:E.ownerDocument,styleElement:E.styleElement}),this._params=E,this.canvasFactory=R.canvasFactory,this.filterFactory=R.filterFactory,this.cMapReaderFactory=R.cMapReaderFactory,this.standardFontDataFactory=R.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=A,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#i(a,u=null){const A=this.#t.get(a);if(A)return A;const E=this.messageHandler.sendWithPromise(a,u);return this.#t.set(a,E),E}get annotationStorage(){return(0,I.shadow)(this,"annotationStorage",new G.AnnotationStorage)}getRenderingIntent(a,u=I.AnnotationMode.ENABLE,A=null,E=!1){let R=I.RenderingIntentFlag.DISPLAY,k=G.SerializableEmpty;switch(a){case"any":R=I.RenderingIntentFlag.ANY;break;case"display":break;case"print":R=I.RenderingIntentFlag.PRINT;break;default:(0,I.warn)(`getRenderingIntent - invalid intent: ${a}`)}switch(u){case I.AnnotationMode.DISABLE:R+=I.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case I.AnnotationMode.ENABLE:break;case I.AnnotationMode.ENABLE_FORMS:R+=I.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case I.AnnotationMode.ENABLE_STORAGE:R+=I.RenderingIntentFlag.ANNOTATIONS_STORAGE,k=(R&I.RenderingIntentFlag.PRINT&&A instanceof G.PrintAnnotationStorage?A:this.annotationStorage).serializable;break;default:(0,I.warn)(`getRenderingIntent - invalid annotationMode: ${u}`)}return E&&(R+=I.RenderingIntentFlag.OPLIST),{renderingIntent:R,cacheKey:`${R}_${k.hash}`,annotationStorageSerializable:k}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const a=[];for(const A of this.#e.values())a.push(A._destroy());this.#e.clear(),this.#s.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const u=this.messageHandler.sendWithPromise("Terminate",null);return a.push(u),Promise.all(a).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),(0,r.cleanupTextLayer)(),this._networkStream?.cancelAllRequests(new I.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:a,loadingTask:u}=this;a.on("GetReader",(A,E)=>{(0,I.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=R=>{this._lastProgress={loaded:R.loaded,total:R.total}},E.onPull=()=>{this._fullReader.read().then(function({value:R,done:k}){if(k){E.close();return}(0,I.assert)(R instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),E.enqueue(new Uint8Array(R),1,[R])}).catch(R=>{E.error(R)})},E.onCancel=R=>{this._fullReader.cancel(R),E.ready.catch(k=>{if(!this.destroyed)throw k})}}),a.on("ReaderHeadersReady",A=>{const E=Promise.withResolvers(),R=this._fullReader;return R.headersReady.then(()=>{(!R.isStreamingSupported||!R.isRangeSupported)&&(this._lastProgress&&u.onProgress?.(this._lastProgress),R.onProgress=k=>{u.onProgress?.({loaded:k.loaded,total:k.total})}),E.resolve({isStreamingSupported:R.isStreamingSupported,isRangeSupported:R.isRangeSupported,contentLength:R.contentLength})},E.reject),E.promise}),a.on("GetRangeReader",(A,E)=>{(0,I.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const R=this._networkStream.getRangeReader(A.begin,A.end);if(!R){E.close();return}E.onPull=()=>{R.read().then(function({value:k,done:D}){if(D){E.close();return}(0,I.assert)(k instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),E.enqueue(new Uint8Array(k),1,[k])}).catch(k=>{E.error(k)})},E.onCancel=k=>{R.cancel(k),E.ready.catch(D=>{if(!this.destroyed)throw D})}}),a.on("GetDoc",({pdfInfo:A})=>{this._numPages=A.numPages,this._htmlForXfa=A.htmlForXfa,delete A.htmlForXfa,u._capability.resolve(new ot(A,this))}),a.on("DocException",function(A){let E;switch(A.name){case"PasswordException":E=new I.PasswordException(A.message,A.code);break;case"InvalidPDFException":E=new I.InvalidPDFException(A.message);break;case"MissingPDFException":E=new I.MissingPDFException(A.message);break;case"UnexpectedResponseException":E=new I.UnexpectedResponseException(A.message,A.status);break;case"UnknownErrorException":E=new I.UnknownErrorException(A.message,A.details);break;default:(0,I.unreachable)("DocException - expected a valid Error.")}u._capability.reject(E)}),a.on("PasswordRequest",A=>{if(this.#r=Promise.withResolvers(),u.onPassword){const E=R=>{R instanceof Error?this.#r.reject(R):this.#r.resolve({password:R})};try{u.onPassword(E,A.code)}catch(R){this.#r.reject(R)}}else this.#r.reject(new I.PasswordException(A.message,A.code));return this.#r.promise}),a.on("DataLoaded",A=>{u.onProgress?.({loaded:A.length,total:A.length}),this.downloadInfoCapability.resolve(A)}),a.on("StartRenderPage",A=>{if(this.destroyed)return;this.#e.get(A.pageIndex)._startRenderPage(A.transparency,A.cacheKey)}),a.on("commonobj",([A,E,R])=>{if(this.destroyed||this.commonObjs.has(A))return null;switch(E){case"Font":const k=this._params;if("error"in R){const C=R.error;(0,I.warn)(`Error during font loading: ${C}`),this.commonObjs.resolve(A,C);break}const D=k.pdfBug&&globalThis.FontInspector?.enabled?(C,$)=>globalThis.FontInspector.fontAdded(C,$):null,N=new T.FontFaceObject(R,{disableFontFace:k.disableFontFace,ignoreErrors:k.ignoreErrors,inspectFont:D});this.fontLoader.bind(N).catch(()=>a.sendWithPromise("FontFallback",{id:A})).finally(()=>{!k.fontExtraProperties&&N.data&&(N.data=null),this.commonObjs.resolve(A,N)});break;case"CopyLocalImage":const{imageRef:F}=R;(0,I.assert)(F,"The imageRef must be defined.");for(const C of this.#e.values())for(const[,$]of C.objs)if($.ref===F)return $.dataLen?(this.commonObjs.resolve(A,structuredClone($)),$.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(A,R);break;default:throw new Error(`Got unknown common object type ${E}`)}return null}),a.on("obj",([A,E,R,k])=>{if(this.destroyed)return;const D=this.#e.get(E);if(!D.objs.has(A)){if(D._intentStates.size===0){k?.bitmap?.close();return}switch(R){case"Image":D.objs.resolve(A,k),k?.dataLen>I.MAX_IMAGE_SIZE_TO_CACHE&&(D._maybeCleanupAfterRender=!0);break;case"Pattern":D.objs.resolve(A,k);break;default:throw new Error(`Got unknown object type ${R}`)}}}),a.on("DocProgress",A=>{this.destroyed||u.onProgress?.({loaded:A.loaded,total:A.total})}),a.on("FetchBuiltInCMap",A=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(A):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),a.on("FetchStandardFontData",A=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(A):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,I.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:a,transfer:u}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:this._fullReader?.filename??null},u).finally(()=>{this.annotationStorage.resetModified()})}getPage(a){if(!Number.isInteger(a)||a<=0||a>this._numPages)return Promise.reject(new Error("Invalid page request."));const u=a-1,A=this.#s.get(u);if(A)return A;const E=this.messageHandler.sendWithPromise("GetPage",{pageIndex:u}).then(R=>{if(this.destroyed)throw new Error("Transport destroyed");R.refStr&&this.#n.set(R.refStr,a);const k=new ct(u,R,this,this._params.pdfBug);return this.#e.set(u,k),k});return this.#s.set(u,E),E}getPageIndex(a){return Y(a)?this.messageHandler.sendWithPromise("GetPageIndex",{num:a.num,gen:a.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(a,u){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:a,intent:u})}getFieldObjects(){return this.#i("GetFieldObjects")}hasJSActions(){return this.#i("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(a){return typeof a!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:a})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#i("GetDocJSActions")}getPageJSActions(a){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:a})}getStructTree(a){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:a})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(a){return this.#i("GetOptionalContentConfig").then(u=>new s.OptionalContentConfig(u,a))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const a="GetMetadata",u=this.#t.get(a);if(u)return u;const A=this.messageHandler.sendWithPromise(a,null).then(E=>({info:E[0],metadata:E[1]?new b.Metadata(E[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(a,A),A}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(a=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const u of this.#e.values())if(!u.cleanup())throw new Error(`startCleanup: Page ${u.pageNumber} is currently rendering.`);this.commonObjs.clear(),a||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),(0,r.cleanupTextLayer)()}}cachedPageNumber(a){if(!Y(a))return null;const u=a.gen===0?`${a.num}R`:`${a.num}R${a.gen}`;return this.#n.get(u)??null}get loadingParams(){const{disableAutoFetch:a,enableXfa:u}=this._params;return(0,I.shadow)(this,"loadingParams",{disableAutoFetch:a,enableXfa:u})}}const st=Symbol("INITIAL_DATA");class m{#t=Object.create(null);#e(a){return this.#t[a]||={...Promise.withResolvers(),data:st}}get(a,u=null){if(u){const E=this.#e(a);return E.promise.then(()=>u(E.data)),null}const A=this.#t[a];if(!A||A.data===st)throw new Error(`Requesting object that isn't resolved yet ${a}.`);return A.data}has(a){const u=this.#t[a];return!!u&&u.data!==st}resolve(a,u=null){const A=this.#e(a);A.data=u,A.resolve()}clear(){for(const a in this.#t){const{data:u}=this.#t[a];u?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const a in this.#t){const{data:u}=this.#t[a];u!==st&&(yield[a,u])}}}class h{#t=null;constructor(a){this.#t=a,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(a=0){this.#t.cancel(null,a)}get separateAnnots(){const{separateAnnots:a}=this.#t.operatorList;if(!a)return!1;const{annotationCanvasMap:u}=this.#t;return a.form||a.canvas&&u?.size>0}}class e{static#t=new WeakSet;constructor({callback:a,params:u,objs:A,commonObjs:E,annotationCanvasMap:R,operatorList:k,pageIndex:D,canvasFactory:N,filterFactory:F,useRequestAnimationFrame:C=!1,pdfBug:$=!1,pageColors:K=null}){this.callback=a,this.params=u,this.objs=A,this.commonObjs=E,this.annotationCanvasMap=R,this.operatorListIdx=null,this.operatorList=k,this._pageIndex=D,this.canvasFactory=N,this.filterFactory=F,this._pdfBug=$,this.pageColors=K,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=C===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new h(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=u.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:a=!1,optionalContentConfig:u}){if(this.cancelled)return;if(this._canvas){if(e.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");e.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:A,viewport:E,transform:R,background:k}=this.params;this.gfx=new v.CanvasGraphics(A,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:u},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:R,viewport:E,transparency:a,background:k}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(a=null,u=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),e.#t.delete(this._canvas),this.callback(a||new P.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,u))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),e.#t.delete(this._canvas),this.callback())))}}const n="4.2.67",f="49b388101";B()}catch(S){B(S)}})},583:(at,Z,V)=>{V.d(Z,{BaseCMapReaderFactory:()=>G,BaseCanvasFactory:()=>I,BaseFilterFactory:()=>B,BaseSVGFactory:()=>T,BaseStandardFontDataFactory:()=>P});var w=V(292);class B{constructor(){this.constructor===B&&(0,w.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(v){return"none"}addHCMFilter(v,r){return"none"}addHighlightHCMFilter(v,r,d,l,b){return"none"}destroy(v=!1){}}class I{constructor(){this.constructor===I&&(0,w.unreachable)("Cannot initialize BaseCanvasFactory.")}create(v,r){if(v<=0||r<=0)throw new Error("Invalid canvas size");const d=this._createCanvas(v,r);return{canvas:d,context:d.getContext("2d")}}reset(v,r,d){if(!v.canvas)throw new Error("Canvas is not specified");if(r<=0||d<=0)throw new Error("Invalid canvas size");v.canvas.width=r,v.canvas.height=d}destroy(v){if(!v.canvas)throw new Error("Canvas is not specified");v.canvas.width=0,v.canvas.height=0,v.canvas=null,v.context=null}_createCanvas(v,r){(0,w.unreachable)("Abstract method `_createCanvas` called.")}}class G{constructor({baseUrl:v=null,isCompressed:r=!0}){this.constructor===G&&(0,w.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=v,this.isCompressed=r}async fetch({name:v}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!v)throw new Error("CMap name must be specified.");const r=this.baseUrl+v+(this.isCompressed?".bcmap":""),d=this.isCompressed?w.CMapCompressionType.BINARY:w.CMapCompressionType.NONE;return this._fetchData(r,d).catch(l=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${r}`)})}_fetchData(v,r){(0,w.unreachable)("Abstract method `_fetchData` called.")}}class P{constructor({baseUrl:v=null}){this.constructor===P&&(0,w.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=v}async fetch({filename:v}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!v)throw new Error("Font filename must be specified.");const r=`${this.baseUrl}${v}`;return this._fetchData(r).catch(d=>{throw new Error(`Unable to load font data at: ${r}`)})}_fetchData(v){(0,w.unreachable)("Abstract method `_fetchData` called.")}}class T{constructor(){this.constructor===T&&(0,w.unreachable)("Cannot initialize BaseSVGFactory.")}create(v,r,d=!1){if(v<=0||r<=0)throw new Error("Invalid SVG dimensions");const l=this._createSVG("svg:svg");return l.setAttribute("version","1.1"),d||(l.setAttribute("width",`${v}px`),l.setAttribute("height",`${r}px`)),l.setAttribute("preserveAspectRatio","none"),l.setAttribute("viewBox",`0 0 ${v} ${r}`),l}createElement(v){if(typeof v!="string")throw new Error("Invalid SVG element type");return this._createSVG(v)}_createSVG(v){(0,w.unreachable)("Abstract method `_createSVG` called.")}}},923:(at,Z,V)=>{V.d(Z,{CanvasGraphics:()=>m});var w=V(292),B=V(419);const I={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function G(h,e){if(!e)return;const n=e[2]-e[0],f=e[3]-e[1],o=new Path2D;o.rect(e[0],e[1],n,f),h.clip(o)}class P{constructor(){this.constructor===P&&(0,w.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,w.unreachable)("Abstract method `getPattern` called.")}}class T extends P{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let n;this._type==="axial"?n=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(n=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const f of this._colorStops)n.addColorStop(f[0],f[1]);return n}getPattern(e,n,f,o){let a;if(o===I.STROKE||o===I.FILL){const u=n.current.getClippedPathBoundingBox(o,(0,B.getCurrentTransform)(e))||[0,0,0,0],A=Math.ceil(u[2]-u[0])||1,E=Math.ceil(u[3]-u[1])||1,R=n.cachedCanvases.getCanvas("pattern",A,E,!0),k=R.context;k.clearRect(0,0,k.canvas.width,k.canvas.height),k.beginPath(),k.rect(0,0,k.canvas.width,k.canvas.height),k.translate(-u[0],-u[1]),f=w.Util.transform(f,[1,0,0,1,u[0],u[1]]),k.transform(...n.baseTransform),this.matrix&&k.transform(...this.matrix),G(k,this._bbox),k.fillStyle=this._createGradient(k),k.fill(),a=e.createPattern(R.canvas,"no-repeat");const D=new DOMMatrix(f);a.setTransform(D)}else G(e,this._bbox),a=this._createGradient(e);return a}}function x(h,e,n,f,o,a,u,A){const E=e.coords,R=e.colors,k=h.data,D=h.width*4;let N;E[n+1]>E[f+1]&&(N=n,n=f,f=N,N=a,a=u,u=N),E[f+1]>E[o+1]&&(N=f,f=o,o=N,N=u,u=A,A=N),E[n+1]>E[f+1]&&(N=n,n=f,f=N,N=a,a=u,u=N);const F=(E[n]+e.offsetX)*e.scaleX,C=(E[n+1]+e.offsetY)*e.scaleY,$=(E[f]+e.offsetX)*e.scaleX,K=(E[f+1]+e.offsetY)*e.scaleY,X=(E[o]+e.offsetX)*e.scaleX,W=(E[o+1]+e.offsetY)*e.scaleY;if(C>=W)return;const rt=R[a],J=R[a+1],Q=R[a+2],it=R[u],lt=R[u+1],gt=R[u+2],At=R[A],yt=R[A+1],mt=R[A+2],kt=Math.round(C),xt=Math.round(W);let Rt,wt,Tt,Ft,It,_t,Ut,Nt;for(let Ct=kt;Ct<=xt;Ct++){if(Ct<K){const St=Ct<C?0:(C-Ct)/(C-K);Rt=F-(F-$)*St,wt=rt-(rt-it)*St,Tt=J-(J-lt)*St,Ft=Q-(Q-gt)*St}else{let St;Ct>W?St=1:K===W?St=0:St=(K-Ct)/(K-W),Rt=$-($-X)*St,wt=it-(it-At)*St,Tt=lt-(lt-yt)*St,Ft=gt-(gt-mt)*St}let Et;Ct<C?Et=0:Ct>W?Et=1:Et=(C-Ct)/(C-W),It=F-(F-X)*Et,_t=rt-(rt-At)*Et,Ut=J-(J-yt)*Et,Nt=Q-(Q-mt)*Et;const Gt=Math.round(Math.min(Rt,It)),Ot=Math.round(Math.max(Rt,It));let Dt=D*Ct+Gt*4;for(let St=Gt;St<=Ot;St++)Et=(Rt-St)/(Rt-It),Et<0?Et=0:Et>1&&(Et=1),k[Dt++]=wt-(wt-_t)*Et|0,k[Dt++]=Tt-(Tt-Ut)*Et|0,k[Dt++]=Ft-(Ft-Nt)*Et|0,k[Dt++]=255}}function v(h,e,n){const f=e.coords,o=e.colors;let a,u;switch(e.type){case"lattice":const A=e.verticesPerRow,E=Math.floor(f.length/A)-1,R=A-1;for(a=0;a<E;a++){let k=a*A;for(let D=0;D<R;D++,k++)x(h,n,f[k],f[k+1],f[k+A],o[k],o[k+1],o[k+A]),x(h,n,f[k+A+1],f[k+1],f[k+A],o[k+A+1],o[k+1],o[k+A])}break;case"triangles":for(a=0,u=f.length;a<u;a+=3)x(h,n,f[a],f[a+1],f[a+2],o[a],o[a+1],o[a+2]);break;default:throw new Error("illegal figure")}}class r extends P{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,n,f){const A=Math.floor(this._bounds[0]),E=Math.floor(this._bounds[1]),R=Math.ceil(this._bounds[2])-A,k=Math.ceil(this._bounds[3])-E,D=Math.min(Math.ceil(Math.abs(R*e[0]*1.1)),3e3),N=Math.min(Math.ceil(Math.abs(k*e[1]*1.1)),3e3),F=R/D,C=k/N,$={coords:this._coords,colors:this._colors,offsetX:-A,offsetY:-E,scaleX:1/F,scaleY:1/C},K=D+2*2,X=N+2*2,W=f.getCanvas("mesh",K,X,!1),rt=W.context,J=rt.createImageData(D,N);if(n){const it=J.data;for(let lt=0,gt=it.length;lt<gt;lt+=4)it[lt]=n[0],it[lt+1]=n[1],it[lt+2]=n[2],it[lt+3]=255}for(const it of this._figures)v(J,it,$);return rt.putImageData(J,2,2),{canvas:W.canvas,offsetX:A-2*F,offsetY:E-2*C,scaleX:F,scaleY:C}}getPattern(e,n,f,o){G(e,this._bbox);let a;if(o===I.SHADING)a=w.Util.singularValueDecompose2dScale((0,B.getCurrentTransform)(e));else if(a=w.Util.singularValueDecompose2dScale(n.baseTransform),this.matrix){const A=w.Util.singularValueDecompose2dScale(this.matrix);a=[a[0]*A[0],a[1]*A[1]]}const u=this._createMeshCanvas(a,o===I.SHADING?null:this._background,n.cachedCanvases);return o!==I.SHADING&&(e.setTransform(...n.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(u.offsetX,u.offsetY),e.scale(u.scaleX,u.scaleY),e.createPattern(u.canvas,"no-repeat")}}class d extends P{getPattern(){return"hotpink"}}function l(h){switch(h[0]){case"RadialAxial":return new T(h);case"Mesh":return new r(h);case"Dummy":return new d}throw new Error(`Unknown IR type: ${h[0]}`)}const b={COLORED:1,UNCOLORED:2};class s{static MAX_PATTERN_SIZE=3e3;constructor(e,n,f,o,a){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=n,this.ctx=f,this.canvasGraphicsFactory=o,this.baseTransform=a}createPatternCanvas(e){const n=this.operatorList,f=this.bbox,o=this.xstep,a=this.ystep,u=this.paintType,A=this.tilingType,E=this.color,R=this.canvasGraphicsFactory;(0,w.info)("TilingType: "+A);const k=f[0],D=f[1],N=f[2],F=f[3],C=w.Util.singularValueDecompose2dScale(this.matrix),$=w.Util.singularValueDecompose2dScale(this.baseTransform),K=[C[0]*$[0],C[1]*$[1]],X=this.getSizeAndScale(o,this.ctx.canvas.width,K[0]),W=this.getSizeAndScale(a,this.ctx.canvas.height,K[1]),rt=e.cachedCanvases.getCanvas("pattern",X.size,W.size,!0),J=rt.context,Q=R.createCanvasGraphics(J);Q.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(Q,u,E);let it=k,lt=D,gt=N,At=F;return k<0&&(it=0,gt+=Math.abs(k)),D<0&&(lt=0,At+=Math.abs(D)),J.translate(-(X.scale*it),-(W.scale*lt)),Q.transform(X.scale,0,0,W.scale,0,0),J.save(),this.clipBbox(Q,it,lt,gt,At),Q.baseTransform=(0,B.getCurrentTransform)(Q.ctx),Q.executeOperatorList(n),Q.endDrawing(),{canvas:rt.canvas,scaleX:X.scale,scaleY:W.scale,offsetX:it,offsetY:lt}}getSizeAndScale(e,n,f){e=Math.abs(e);const o=Math.max(s.MAX_PATTERN_SIZE,n);let a=Math.ceil(e*f);return a>=o?a=o:f=a/e,{scale:f,size:a}}clipBbox(e,n,f,o,a){const u=o-n,A=a-f;e.ctx.rect(n,f,u,A),e.current.updateRectMinMax((0,B.getCurrentTransform)(e.ctx),[n,f,o,a]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,n,f){const o=e.ctx,a=e.current;switch(n){case b.COLORED:const u=this.ctx;o.fillStyle=u.fillStyle,o.strokeStyle=u.strokeStyle,a.fillColor=u.fillStyle,a.strokeColor=u.strokeStyle;break;case b.UNCOLORED:const A=w.Util.makeHexColor(f[0],f[1],f[2]);o.fillStyle=A,o.strokeStyle=A,a.fillColor=A,a.strokeColor=A;break;default:throw new w.FormatError(`Unsupported paint type: ${n}`)}}getPattern(e,n,f,o){let a=f;o!==I.SHADING&&(a=w.Util.transform(a,n.baseTransform),this.matrix&&(a=w.Util.transform(a,this.matrix)));const u=this.createPatternCanvas(n);let A=new DOMMatrix(a);A=A.translate(u.offsetX,u.offsetY),A=A.scale(1/u.scaleX,1/u.scaleY);const E=e.createPattern(u.canvas,"repeat");return E.setTransform(A),E}}function g({src:h,srcPos:e=0,dest:n,width:f,height:o,nonBlackColor:a=4294967295,inverseDecode:u=!1}){const A=w.FeatureTest.isLittleEndian?4278190080:255,[E,R]=u?[a,A]:[A,a],k=f>>3,D=f&7,N=h.length;n=new Uint32Array(n.buffer);let F=0;for(let C=0;C<o;C++){for(const K=e+k;e<K;e++){const X=e<N?h[e]:255;n[F++]=X&128?R:E,n[F++]=X&64?R:E,n[F++]=X&32?R:E,n[F++]=X&16?R:E,n[F++]=X&8?R:E,n[F++]=X&4?R:E,n[F++]=X&2?R:E,n[F++]=X&1?R:E}if(D===0)continue;const $=e<N?h[e++]:255;for(let K=0;K<D;K++)n[F++]=$&1<<7-K?R:E}return{srcPos:e,destPos:F}}const t=16,i=100,c=4096,p=15,y=10,S=1e3,L=16;function M(h,e){if(h._removeMirroring)throw new Error("Context is already forwarding operations.");h.__originalSave=h.save,h.__originalRestore=h.restore,h.__originalRotate=h.rotate,h.__originalScale=h.scale,h.__originalTranslate=h.translate,h.__originalTransform=h.transform,h.__originalSetTransform=h.setTransform,h.__originalResetTransform=h.resetTransform,h.__originalClip=h.clip,h.__originalMoveTo=h.moveTo,h.__originalLineTo=h.lineTo,h.__originalBezierCurveTo=h.bezierCurveTo,h.__originalRect=h.rect,h.__originalClosePath=h.closePath,h.__originalBeginPath=h.beginPath,h._removeMirroring=()=>{h.save=h.__originalSave,h.restore=h.__originalRestore,h.rotate=h.__originalRotate,h.scale=h.__originalScale,h.translate=h.__originalTranslate,h.transform=h.__originalTransform,h.setTransform=h.__originalSetTransform,h.resetTransform=h.__originalResetTransform,h.clip=h.__originalClip,h.moveTo=h.__originalMoveTo,h.lineTo=h.__originalLineTo,h.bezierCurveTo=h.__originalBezierCurveTo,h.rect=h.__originalRect,h.closePath=h.__originalClosePath,h.beginPath=h.__originalBeginPath,delete h._removeMirroring},h.save=function(){e.save(),this.__originalSave()},h.restore=function(){e.restore(),this.__originalRestore()},h.translate=function(f,o){e.translate(f,o),this.__originalTranslate(f,o)},h.scale=function(f,o){e.scale(f,o),this.__originalScale(f,o)},h.transform=function(f,o,a,u,A,E){e.transform(f,o,a,u,A,E),this.__originalTransform(f,o,a,u,A,E)},h.setTransform=function(f,o,a,u,A,E){e.setTransform(f,o,a,u,A,E),this.__originalSetTransform(f,o,a,u,A,E)},h.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},h.rotate=function(f){e.rotate(f),this.__originalRotate(f)},h.clip=function(f){e.clip(f),this.__originalClip(f)},h.moveTo=function(n,f){e.moveTo(n,f),this.__originalMoveTo(n,f)},h.lineTo=function(n,f){e.lineTo(n,f),this.__originalLineTo(n,f)},h.bezierCurveTo=function(n,f,o,a,u,A){e.bezierCurveTo(n,f,o,a,u,A),this.__originalBezierCurveTo(n,f,o,a,u,A)},h.rect=function(n,f,o,a){e.rect(n,f,o,a),this.__originalRect(n,f,o,a)},h.closePath=function(){e.closePath(),this.__originalClosePath()},h.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class O{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,n,f){let o;return this.cache[e]!==void 0?(o=this.cache[e],this.canvasFactory.reset(o,n,f)):(o=this.canvasFactory.create(n,f),this.cache[e]=o),o}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const n=this.cache[e];this.canvasFactory.destroy(n),delete this.cache[e]}}}function _(h,e,n,f,o,a,u,A,E,R){const[k,D,N,F,C,$]=(0,B.getCurrentTransform)(h);if(D===0&&N===0){const W=u*k+C,rt=Math.round(W),J=A*F+$,Q=Math.round(J),it=(u+E)*k+C,lt=Math.abs(Math.round(it)-rt)||1,gt=(A+R)*F+$,At=Math.abs(Math.round(gt)-Q)||1;return h.setTransform(Math.sign(k),0,0,Math.sign(F),rt,Q),h.drawImage(e,n,f,o,a,0,0,lt,At),h.setTransform(k,D,N,F,C,$),[lt,At]}if(k===0&&F===0){const W=A*N+C,rt=Math.round(W),J=u*D+$,Q=Math.round(J),it=(A+R)*N+C,lt=Math.abs(Math.round(it)-rt)||1,gt=(u+E)*D+$,At=Math.abs(Math.round(gt)-Q)||1;return h.setTransform(0,Math.sign(D),Math.sign(N),0,rt,Q),h.drawImage(e,n,f,o,a,0,0,At,lt),h.setTransform(k,D,N,F,C,$),[At,lt]}h.drawImage(e,n,f,o,a,u,A,E,R);const K=Math.hypot(k,D),X=Math.hypot(N,F);return[K*E,X*R]}function z(h){const{width:e,height:n}=h;if(e>S||n>S)return null;const f=1e3,o=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),a=e+1;let u=new Uint8Array(a*(n+1)),A,E,R;const k=e+7&-8;let D=new Uint8Array(k*n),N=0;for(const X of h.data){let W=128;for(;W>0;)D[N++]=X&W?0:255,W>>=1}let F=0;for(N=0,D[N]!==0&&(u[0]=1,++F),E=1;E<e;E++)D[N]!==D[N+1]&&(u[E]=D[N]?2:1,++F),N++;for(D[N]!==0&&(u[E]=2,++F),A=1;A<n;A++){N=A*k,R=A*a,D[N-k]!==D[N]&&(u[R]=D[N]?1:8,++F);let X=(D[N]?4:0)+(D[N-k]?8:0);for(E=1;E<e;E++)X=(X>>2)+(D[N+1]?4:0)+(D[N-k+1]?8:0),o[X]&&(u[R+E]=o[X],++F),N++;if(D[N-k]!==D[N]&&(u[R+E]=D[N]?2:4,++F),F>f)return null}for(N=k*(n-1),R=A*a,D[N]!==0&&(u[R]=8,++F),E=1;E<e;E++)D[N]!==D[N+1]&&(u[R+E]=D[N]?4:8,++F),N++;if(D[N]!==0&&(u[R+E]=4,++F),F>f)return null;const C=new Int32Array([0,a,-1,0,-a,0,0,0,1]),$=new Path2D;for(A=0;F&&A<=n;A++){let X=A*a;const W=X+e;for(;X<W&&!u[X];)X++;if(X===W)continue;$.moveTo(X%a,A);const rt=X;let J=u[X];do{const Q=C[J];do X+=Q;while(!u[X]);const it=u[X];it!==5&&it!==10?(J=it,u[X]=0):(J=it&51*J>>4,u[X]&=J>>2|J<<2),$.lineTo(X%a,X/a|0),u[X]||--F}while(rt!==X);--A}return D=null,u=null,function(X){X.save(),X.scale(1/e,-1/n),X.translate(0,-n),X.fill($),X.beginPath(),X.restore()}}class q{constructor(e,n){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=w.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=w.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=w.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,n])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,n){this.x=e,this.y=n}updatePathMinMax(e,n,f){[n,f]=w.Util.applyTransform([n,f],e),this.minX=Math.min(this.minX,n),this.minY=Math.min(this.minY,f),this.maxX=Math.max(this.maxX,n),this.maxY=Math.max(this.maxY,f)}updateRectMinMax(e,n){const f=w.Util.applyTransform(n,e),o=w.Util.applyTransform(n.slice(2),e),a=w.Util.applyTransform([n[0],n[3]],e),u=w.Util.applyTransform([n[2],n[1]],e);this.minX=Math.min(this.minX,f[0],o[0],a[0],u[0]),this.minY=Math.min(this.minY,f[1],o[1],a[1],u[1]),this.maxX=Math.max(this.maxX,f[0],o[0],a[0],u[0]),this.maxY=Math.max(this.maxY,f[1],o[1],a[1],u[1])}updateScalingPathMinMax(e,n){w.Util.scaleMinMax(e,n),this.minX=Math.min(this.minX,n[0]),this.minY=Math.min(this.minY,n[1]),this.maxX=Math.max(this.maxX,n[2]),this.maxY=Math.max(this.maxY,n[3])}updateCurvePathMinMax(e,n,f,o,a,u,A,E,R,k){const D=w.Util.bezierBoundingBox(n,f,o,a,u,A,E,R,k);k||this.updateRectMinMax(e,D)}getPathBoundingBox(e=I.FILL,n=null){const f=[this.minX,this.minY,this.maxX,this.maxY];if(e===I.STROKE){n||(0,w.unreachable)("Stroke bounding box must include transform.");const o=w.Util.singularValueDecompose2dScale(n),a=o[0]*this.lineWidth/2,u=o[1]*this.lineWidth/2;f[0]-=a,f[1]-=u,f[2]+=a,f[3]+=u}return f}updateClipFromPath(){const e=w.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=I.FILL,n=null){return w.Util.intersect(this.clipBox,this.getPathBoundingBox(e,n))}}function nt(h,e){if(typeof ImageData<"u"&&e instanceof ImageData){h.putImageData(e,0,0);return}const n=e.height,f=e.width,o=n%L,a=(n-o)/L,u=o===0?a:a+1,A=h.createImageData(f,L);let E=0,R;const k=e.data,D=A.data;let N,F,C,$;if(e.kind===w.ImageKind.GRAYSCALE_1BPP){const K=k.byteLength,X=new Uint32Array(D.buffer,0,D.byteLength>>2),W=X.length,rt=f+7>>3,J=4294967295,Q=w.FeatureTest.isLittleEndian?4278190080:255;for(N=0;N<u;N++){for(C=N<a?L:o,R=0,F=0;F<C;F++){const it=K-E;let lt=0;const gt=it>rt?f:it*8-7,At=gt&-8;let yt=0,mt=0;for(;lt<At;lt+=8)mt=k[E++],X[R++]=mt&128?J:Q,X[R++]=mt&64?J:Q,X[R++]=mt&32?J:Q,X[R++]=mt&16?J:Q,X[R++]=mt&8?J:Q,X[R++]=mt&4?J:Q,X[R++]=mt&2?J:Q,X[R++]=mt&1?J:Q;for(;lt<gt;lt++)yt===0&&(mt=k[E++],yt=128),X[R++]=mt&yt?J:Q,yt>>=1}for(;R<W;)X[R++]=0;h.putImageData(A,0,N*L)}}else if(e.kind===w.ImageKind.RGBA_32BPP){for(F=0,$=f*L*4,N=0;N<a;N++)D.set(k.subarray(E,E+$)),E+=$,h.putImageData(A,0,F),F+=L;N<u&&($=f*o*4,D.set(k.subarray(E,E+$)),h.putImageData(A,0,F))}else if(e.kind===w.ImageKind.RGB_24BPP)for(C=L,$=f*C,N=0;N<u;N++){for(N>=a&&(C=o,$=f*C),R=0,F=$;F--;)D[R++]=k[E++],D[R++]=k[E++],D[R++]=k[E++],D[R++]=255;h.putImageData(A,0,N*L)}else throw new Error(`bad image kind: ${e.kind}`)}function j(h,e){if(e.bitmap){h.drawImage(e.bitmap,0,0);return}const n=e.height,f=e.width,o=n%L,a=(n-o)/L,u=o===0?a:a+1,A=h.createImageData(f,L);let E=0;const R=e.data,k=A.data;for(let D=0;D<u;D++){const N=D<a?L:o;({srcPos:E}=g({src:R,srcPos:E,dest:k,width:f,height:N,nonBlackColor:0})),h.putImageData(A,0,D*L)}}function H(h,e){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const f of n)h[f]!==void 0&&(e[f]=h[f]);h.setLineDash!==void 0&&(e.setLineDash(h.getLineDash()),e.lineDashOffset=h.lineDashOffset)}function U(h){if(h.strokeStyle=h.fillStyle="#000000",h.fillRule="nonzero",h.globalAlpha=1,h.lineWidth=1,h.lineCap="butt",h.lineJoin="miter",h.miterLimit=10,h.globalCompositeOperation="source-over",h.font="10px sans-serif",h.setLineDash!==void 0&&(h.setLineDash([]),h.lineDashOffset=0),!w.isNodeJS){const{filter:e}=h;e!=="none"&&e!==""&&(h.filter="none")}}function Y(h,e,n,f){const o=h.length;for(let a=3;a<o;a+=4){const u=h[a];if(u===0)h[a-3]=e,h[a-2]=n,h[a-1]=f;else if(u<255){const A=255-u;h[a-3]=h[a-3]*u+e*A>>8,h[a-2]=h[a-2]*u+n*A>>8,h[a-1]=h[a-1]*u+f*A>>8}}}function et(h,e,n){const f=h.length,o=1/255;for(let a=3;a<f;a+=4){const u=n?n[h[a]]:h[a];e[a]=e[a]*u*o|0}}function tt(h,e,n){const f=h.length;for(let o=3;o<f;o+=4){const a=h[o-3]*77+h[o-2]*152+h[o-1]*28;e[o]=n?e[o]*n[a>>8]>>8:e[o]*a>>16}}function ot(h,e,n,f,o,a,u,A,E,R,k){const D=!!a,N=D?a[0]:0,F=D?a[1]:0,C=D?a[2]:0,$=o==="Luminosity"?tt:et,X=Math.min(f,Math.ceil(1048576/n));for(let W=0;W<f;W+=X){const rt=Math.min(X,f-W),J=h.getImageData(A-R,W+(E-k),n,rt),Q=e.getImageData(A,W+E,n,rt);D&&Y(J.data,N,F,C),$(J.data,Q.data,u),e.putImageData(Q,A,W+E)}}function ct(h,e,n,f){const o=f[0],a=f[1],u=f[2]-o,A=f[3]-a;u===0||A===0||(ot(e.context,n,u,A,e.subtype,e.backdrop,e.transferMap,o,a,e.offsetX,e.offsetY),h.save(),h.globalAlpha=1,h.globalCompositeOperation="source-over",h.setTransform(1,0,0,1,0,0),h.drawImage(n.canvas,0,0),h.restore())}function pt(h,e){if(e)return!0;const n=w.Util.singularValueDecompose2dScale(h);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const f=Math.fround((globalThis.devicePixelRatio||1)*B.PixelsPerInch.PDF_TO_CSS_UNITS);return n[0]<=f&&n[1]<=f}const dt=["butt","round","square"],ht=["miter","round","bevel"],ut={},st={};class m{constructor(e,n,f,o,a,{optionalContentConfig:u,markedContentStack:A=null},E,R){this.ctx=e,this.current=new q(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=n,this.objs=f,this.canvasFactory=o,this.filterFactory=a,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=A||[],this.optionalContentConfig=u,this.cachedCanvases=new O(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=E,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=R,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,n=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):n}beginDrawing({transform:e,viewport:n,transparency:f=!1,background:o=null}){const a=this.ctx.canvas.width,u=this.ctx.canvas.height,A=this.ctx.fillStyle;if(this.ctx.fillStyle=o||"#ffffff",this.ctx.fillRect(0,0,a,u),this.ctx.fillStyle=A,f){const E=this.cachedCanvases.getCanvas("transparent",a,u);this.compositeCtx=this.ctx,this.transparentCanvas=E.canvas,this.ctx=E.context,this.ctx.save(),this.ctx.transform(...(0,B.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),U(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=(0,B.getCurrentTransform)(this.ctx)}executeOperatorList(e,n,f,o){const a=e.argsArray,u=e.fnArray;let A=n||0;const E=a.length;if(E===A)return A;const R=E-A>y&&typeof f=="function",k=R?Date.now()+p:0;let D=0;const N=this.commonObjs,F=this.objs;let C;for(;;){if(o!==void 0&&A===o.nextBreakPoint)return o.breakIt(A,f),A;if(C=u[A],C!==w.OPS.dependency)this[C].apply(this,a[A]);else for(const $ of a[A]){const K=$.startsWith("g_")?N:F;if(!K.has($))return K.get($,f),A}if(A++,A===E)return A;if(R&&++D>y){if(Date.now()>k)return f(),A;D=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const n of e.values())typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&(n.width=n.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const n=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=n}}}_scaleImage(e,n){const f=e.width,o=e.height;let a=Math.max(Math.hypot(n[0],n[1]),1),u=Math.max(Math.hypot(n[2],n[3]),1),A=f,E=o,R="prescale1",k,D;for(;a>2&&A>1||u>2&&E>1;){let N=A,F=E;a>2&&A>1&&(N=A>=16384?Math.floor(A/2)-1||1:Math.ceil(A/2),a/=A/N),u>2&&E>1&&(F=E>=16384?Math.floor(E/2)-1||1:Math.ceil(E)/2,u/=E/F),k=this.cachedCanvases.getCanvas(R,N,F),D=k.context,D.clearRect(0,0,N,F),D.drawImage(e,0,0,A,E,0,0,N,F),e=k.canvas,A=N,E=F,R=R==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:A,paintHeight:E}}_createMaskCanvas(e){const n=this.ctx,{width:f,height:o}=e,a=this.current.fillColor,u=this.current.patternFill,A=(0,B.getCurrentTransform)(n);let E,R,k,D;if((e.bitmap||e.data)&&e.count>1){const gt=e.bitmap||e.data.buffer;R=JSON.stringify(u?A:[A.slice(0,4),a]),E=this._cachedBitmapsMap.get(gt),E||(E=new Map,this._cachedBitmapsMap.set(gt,E));const At=E.get(R);if(At&&!u){const yt=Math.round(Math.min(A[0],A[2])+A[4]),mt=Math.round(Math.min(A[1],A[3])+A[5]);return{canvas:At,offsetX:yt,offsetY:mt}}k=At}k||(D=this.cachedCanvases.getCanvas("maskCanvas",f,o),j(D.context,e));let N=w.Util.transform(A,[1/f,0,0,-1/o,0,0]);N=w.Util.transform(N,[1,0,0,1,0,-o]);const[F,C,$,K]=w.Util.getAxialAlignedBoundingBox([0,0,f,o],N),X=Math.round($-F)||1,W=Math.round(K-C)||1,rt=this.cachedCanvases.getCanvas("fillCanvas",X,W),J=rt.context,Q=F,it=C;J.translate(-Q,-it),J.transform(...N),k||(k=this._scaleImage(D.canvas,(0,B.getCurrentTransformInverse)(J)),k=k.img,E&&u&&E.set(R,k)),J.imageSmoothingEnabled=pt((0,B.getCurrentTransform)(J),e.interpolate),_(J,k,0,0,k.width,k.height,0,0,f,o),J.globalCompositeOperation="source-in";const lt=w.Util.transform((0,B.getCurrentTransformInverse)(J),[1,0,0,1,-Q,-it]);return J.fillStyle=u?a.getPattern(n,this,lt,I.FILL):a,J.fillRect(0,0,f,o),E&&!u&&(this.cachedCanvases.delete("fillCanvas"),E.set(R,rt.canvas)),{canvas:rt.canvas,offsetX:Math.round(Q),offsetY:Math.round(it)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=dt[e]}setLineJoin(e){this.ctx.lineJoin=ht[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,n){const f=this.ctx;f.setLineDash!==void 0&&(f.setLineDash(e),f.lineDashOffset=n)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[n,f]of e)switch(n){case"LW":this.setLineWidth(f);break;case"LC":this.setLineCap(f);break;case"LJ":this.setLineJoin(f);break;case"ML":this.setMiterLimit(f);break;case"D":this.setDash(f[0],f[1]);break;case"RI":this.setRenderingIntent(f);break;case"FL":this.setFlatness(f);break;case"Font":this.setFont(f[0],f[1]);break;case"CA":this.current.strokeAlpha=f;break;case"ca":this.current.fillAlpha=f,this.ctx.globalAlpha=f;break;case"BM":this.ctx.globalCompositeOperation=f;break;case"SMask":this.current.activeSMask=f?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(f);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,n=this.ctx.canvas.height,f="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(f,e,n);this.suspendedCtx=this.ctx,this.ctx=o.context;const a=this.ctx;a.setTransform(...(0,B.getCurrentTransform)(this.suspendedCtx)),H(this.suspendedCtx,a),M(a,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),H(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const n=this.current.activeSMask,f=this.suspendedCtx;ct(f,n,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(H(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),H(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,n,f,o,a,u){this.ctx.transform(e,n,f,o,a,u),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,n,f){const o=this.ctx,a=this.current;let u=a.x,A=a.y,E,R;const k=(0,B.getCurrentTransform)(o),D=k[0]===0&&k[3]===0||k[1]===0&&k[2]===0,N=D?f.slice(0):null;for(let F=0,C=0,$=e.length;F<$;F++)switch(e[F]|0){case w.OPS.rectangle:u=n[C++],A=n[C++];const K=n[C++],X=n[C++],W=u+K,rt=A+X;o.moveTo(u,A),K===0||X===0?o.lineTo(W,rt):(o.lineTo(W,A),o.lineTo(W,rt),o.lineTo(u,rt)),D||a.updateRectMinMax(k,[u,A,W,rt]),o.closePath();break;case w.OPS.moveTo:u=n[C++],A=n[C++],o.moveTo(u,A),D||a.updatePathMinMax(k,u,A);break;case w.OPS.lineTo:u=n[C++],A=n[C++],o.lineTo(u,A),D||a.updatePathMinMax(k,u,A);break;case w.OPS.curveTo:E=u,R=A,u=n[C+4],A=n[C+5],o.bezierCurveTo(n[C],n[C+1],n[C+2],n[C+3],u,A),a.updateCurvePathMinMax(k,E,R,n[C],n[C+1],n[C+2],n[C+3],u,A,N),C+=6;break;case w.OPS.curveTo2:E=u,R=A,o.bezierCurveTo(u,A,n[C],n[C+1],n[C+2],n[C+3]),a.updateCurvePathMinMax(k,E,R,u,A,n[C],n[C+1],n[C+2],n[C+3],N),u=n[C+2],A=n[C+3],C+=4;break;case w.OPS.curveTo3:E=u,R=A,u=n[C+2],A=n[C+3],o.bezierCurveTo(n[C],n[C+1],u,A,u,A),a.updateCurvePathMinMax(k,E,R,n[C],n[C+1],u,A,u,A,N),C+=4;break;case w.OPS.closePath:o.closePath();break}D&&a.updateScalingPathMinMax(k,N),a.setCurrentPoint(u,A)}closePath(){this.ctx.closePath()}stroke(e=!0){const n=this.ctx,f=this.current.strokeColor;n.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof f=="object"&&f?.getPattern?(n.save(),n.strokeStyle=f.getPattern(n,this,(0,B.getCurrentTransformInverse)(n),I.STROKE),this.rescaleAndStroke(!1),n.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),n.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const n=this.ctx,f=this.current.fillColor,o=this.current.patternFill;let a=!1;o&&(n.save(),n.fillStyle=f.getPattern(n,this,(0,B.getCurrentTransformInverse)(n),I.FILL),a=!0);const u=this.current.getClippedPathBoundingBox();this.contentVisible&&u!==null&&(this.pendingEOFill?(n.fill("evenodd"),this.pendingEOFill=!1):n.fill()),a&&n.restore(),e&&this.consumePath(u)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ut}eoClip(){this.pendingClip=st}beginText(){this.current.textMatrix=w.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,n=this.ctx;if(e===void 0){n.beginPath();return}n.save(),n.beginPath();for(const f of e)n.setTransform(...f.transform),n.translate(f.x,f.y),f.addToPath(n,f.fontSize);n.restore(),n.clip(),n.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,n){const f=this.commonObjs.get(e),o=this.current;if(!f)throw new Error(`Can't find font for ${e}`);if(o.fontMatrix=f.fontMatrix||w.FONT_IDENTITY_MATRIX,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&(0,w.warn)("Invalid font matrix for font "+e),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=f,this.current.fontSize=n,f.isType3Font)return;const a=f.loadedName||"sans-serif",u=f.systemFontInfo?.css||`"${a}", ${f.fallbackName}`;let A="normal";f.black?A="900":f.bold&&(A="bold");const E=f.italic?"italic":"normal";let R=n;n<t?R=t:n>i&&(R=i),this.current.fontSizeScale=n/R,this.ctx.font=`${E} ${A} ${R}px ${u}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,n){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,n){this.setLeading(-n),this.moveText(e,n)}setTextMatrix(e,n,f,o,a,u){this.current.textMatrix=[e,n,f,o,a,u],this.current.textMatrixScale=Math.hypot(e,n),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,n,f,o){const a=this.ctx,u=this.current,A=u.font,E=u.textRenderingMode,R=u.fontSize/u.fontSizeScale,k=E&w.TextRenderingMode.FILL_STROKE_MASK,D=!!(E&w.TextRenderingMode.ADD_TO_PATH_FLAG),N=u.patternFill&&!A.missingFile;let F;(A.disableFontFace||D||N)&&(F=A.getPathGenerator(this.commonObjs,e)),A.disableFontFace||N?(a.save(),a.translate(n,f),a.beginPath(),F(a,R),o&&a.setTransform(...o),(k===w.TextRenderingMode.FILL||k===w.TextRenderingMode.FILL_STROKE)&&a.fill(),(k===w.TextRenderingMode.STROKE||k===w.TextRenderingMode.FILL_STROKE)&&a.stroke(),a.restore()):((k===w.TextRenderingMode.FILL||k===w.TextRenderingMode.FILL_STROKE)&&a.fillText(e,n,f),(k===w.TextRenderingMode.STROKE||k===w.TextRenderingMode.FILL_STROKE)&&a.strokeText(e,n,f)),D&&(this.pendingTextPaths||=[]).push({transform:(0,B.getCurrentTransform)(a),x:n,y:f,fontSize:R,addToPath:F})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const n=e.getImageData(0,0,10,10).data;let f=!1;for(let o=3;o<n.length;o+=4)if(n[o]>0&&n[o]<255){f=!0;break}return(0,w.shadow)(this,"isFontSubpixelAAEnabled",f)}showText(e){const n=this.current,f=n.font;if(f.isType3Font)return this.showType3Text(e);const o=n.fontSize;if(o===0)return;const a=this.ctx,u=n.fontSizeScale,A=n.charSpacing,E=n.wordSpacing,R=n.fontDirection,k=n.textHScale*R,D=e.length,N=f.vertical,F=N?1:-1,C=f.defaultVMetrics,$=o*n.fontMatrix[0],K=n.textRenderingMode===w.TextRenderingMode.FILL&&!f.disableFontFace&&!n.patternFill;a.save(),a.transform(...n.textMatrix),a.translate(n.x,n.y+n.textRise),R>0?a.scale(k,-1):a.scale(k,1);let X;if(n.patternFill){a.save();const it=n.fillColor.getPattern(a,this,(0,B.getCurrentTransformInverse)(a),I.FILL);X=(0,B.getCurrentTransform)(a),a.restore(),a.fillStyle=it}let W=n.lineWidth;const rt=n.textMatrixScale;if(rt===0||W===0){const it=n.textRenderingMode&w.TextRenderingMode.FILL_STROKE_MASK;(it===w.TextRenderingMode.STROKE||it===w.TextRenderingMode.FILL_STROKE)&&(W=this.getSinglePixelWidth())}else W/=rt;if(u!==1&&(a.scale(u,u),W/=u),a.lineWidth=W,f.isInvalidPDFjsFont){const it=[];let lt=0;for(const gt of e)it.push(gt.unicode),lt+=gt.width;a.fillText(it.join(""),0,0),n.x+=lt*$*k,a.restore(),this.compose();return}let J=0,Q;for(Q=0;Q<D;++Q){const it=e[Q];if(typeof it=="number"){J+=F*it*o/1e3;continue}let lt=!1;const gt=(it.isSpace?E:0)+A,At=it.fontChar,yt=it.accent;let mt,kt,xt=it.width;if(N){const wt=it.vmetric||C,Tt=-(it.vmetric?wt[1]:xt*.5)*$,Ft=wt[2]*$;xt=wt?-wt[0]:xt,mt=Tt/u,kt=(J+Ft)/u}else mt=J/u,kt=0;if(f.remeasure&&xt>0){const wt=a.measureText(At).width*1e3/o*u;if(xt<wt&&this.isFontSubpixelAAEnabled){const Tt=xt/wt;lt=!0,a.save(),a.scale(Tt,1),mt/=Tt}else xt!==wt&&(mt+=(xt-wt)/2e3*o/u)}if(this.contentVisible&&(it.isInFont||f.missingFile)){if(K&&!yt)a.fillText(At,mt,kt);else if(this.paintChar(At,mt,kt,X),yt){const wt=mt+o*yt.offset.x/u,Tt=kt-o*yt.offset.y/u;this.paintChar(yt.fontChar,wt,Tt,X)}}const Rt=N?xt*$-gt*R:xt*$+gt*R;J+=Rt,lt&&a.restore()}N?n.y-=J:n.x+=J*k,a.restore(),this.compose()}showType3Text(e){const n=this.ctx,f=this.current,o=f.font,a=f.fontSize,u=f.fontDirection,A=o.vertical?1:-1,E=f.charSpacing,R=f.wordSpacing,k=f.textHScale*u,D=f.fontMatrix||w.FONT_IDENTITY_MATRIX,N=e.length,F=f.textRenderingMode===w.TextRenderingMode.INVISIBLE;let C,$,K,X;if(!(F||a===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),n.transform(...f.textMatrix),n.translate(f.x,f.y),n.scale(k,u),C=0;C<N;++C){if($=e[C],typeof $=="number"){X=A*$*a/1e3,this.ctx.translate(X,0),f.x+=X*k;continue}const W=($.isSpace?R:0)+E,rt=o.charProcOperatorList[$.operatorListId];if(!rt){(0,w.warn)(`Type3 character "${$.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=$,this.save(),n.scale(a,a),n.transform(...D),this.executeOperatorList(rt),this.restore()),K=w.Util.applyTransform([$.width,0],D)[0]*a+W,n.translate(K,0),f.x+=K*k}n.restore(),this.processingType3=null}}setCharWidth(e,n){}setCharWidthAndBounds(e,n,f,o,a,u){this.ctx.rect(f,o,a-f,u-o),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let n;if(e[0]==="TilingPattern"){const f=e[1],o=this.baseTransform||(0,B.getCurrentTransform)(this.ctx),a={createCanvasGraphics:u=>new m(u,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};n=new s(e,f,this.ctx,a,o)}else n=this._getPattern(e[1],e[2]);return n}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,n,f){const o=w.Util.makeHexColor(e,n,f);this.ctx.strokeStyle=o,this.current.strokeColor=o}setFillRGBColor(e,n,f){const o=w.Util.makeHexColor(e,n,f);this.ctx.fillStyle=o,this.current.fillColor=o,this.current.patternFill=!1}_getPattern(e,n=null){let f;return this.cachedPatterns.has(e)?f=this.cachedPatterns.get(e):(f=l(this.getObject(e)),this.cachedPatterns.set(e,f)),n&&(f.matrix=n),f}shadingFill(e){if(!this.contentVisible)return;const n=this.ctx;this.save();const f=this._getPattern(e);n.fillStyle=f.getPattern(n,this,(0,B.getCurrentTransformInverse)(n),I.SHADING);const o=(0,B.getCurrentTransformInverse)(n);if(o){const{width:a,height:u}=n.canvas,[A,E,R,k]=w.Util.getAxialAlignedBoundingBox([0,0,a,u],o);this.ctx.fillRect(A,E,R-A,k-E)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,w.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,w.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,n){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&e.length===6&&this.transform(...e),this.baseTransform=(0,B.getCurrentTransform)(this.ctx),n)){const f=n[2]-n[0],o=n[3]-n[1];this.ctx.rect(n[0],n[1],f,o),this.current.updateRectMinMax((0,B.getCurrentTransform)(this.ctx),n),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;e.isolated||(0,w.info)("TODO: Support non-isolated groups."),e.knockout&&(0,w.warn)("Knockout groups not supported.");const f=(0,B.getCurrentTransform)(n);if(e.matrix&&n.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let o=w.Util.getAxialAlignedBoundingBox(e.bbox,(0,B.getCurrentTransform)(n));const a=[0,0,n.canvas.width,n.canvas.height];o=w.Util.intersect(o,a)||[0,0,0,0];const u=Math.floor(o[0]),A=Math.floor(o[1]);let E=Math.max(Math.ceil(o[2])-u,1),R=Math.max(Math.ceil(o[3])-A,1),k=1,D=1;E>c&&(k=E/c,E=c),R>c&&(D=R/c,R=c),this.current.startNewPathAndClipBox([0,0,E,R]);let N="groupAt"+this.groupLevel;e.smask&&(N+="_smask_"+this.smaskCounter++%2);const F=this.cachedCanvases.getCanvas(N,E,R),C=F.context;C.scale(1/k,1/D),C.translate(-u,-A),C.transform(...f),e.smask?this.smaskStack.push({canvas:F.canvas,context:C,offsetX:u,offsetY:A,scaleX:k,scaleY:D,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(n.setTransform(1,0,0,1,0,0),n.translate(u,A),n.scale(k,D),n.save()),H(n,C),this.ctx=C,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,f=this.groupStack.pop();if(this.ctx=f,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const o=(0,B.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...o);const a=w.Util.getAxialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o);this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(e,n,f,o,a){if(this.#t(),U(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(n)&&n.length===4){const u=n[2]-n[0],A=n[3]-n[1];if(a&&this.annotationCanvasMap){f=f.slice(),f[4]-=n[0],f[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=u,n[3]=A;const[E,R]=w.Util.singularValueDecompose2dScale((0,B.getCurrentTransform)(this.ctx)),{viewportScale:k}=this,D=Math.ceil(u*this.outputScaleX*k),N=Math.ceil(A*this.outputScaleY*k);this.annotationCanvas=this.canvasFactory.create(D,N);const{canvas:F,context:C}=this.annotationCanvas;this.annotationCanvasMap.set(e,F),this.annotationCanvas.savedCtx=this.ctx,this.ctx=C,this.ctx.save(),this.ctx.setTransform(E,0,0,-R,0,A*R),U(this.ctx)}else U(this.ctx),this.ctx.rect(n[0],n[1],u,A),this.ctx.clip(),this.endPath()}this.current=new q(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...f),this.transform(...o)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const n=e.count;e=this.getObject(e.data,e),e.count=n;const f=this.ctx,o=this.processingType3;if(o&&(o.compiled===void 0&&(o.compiled=z(e)),o.compiled)){o.compiled(f);return}const a=this._createMaskCanvas(e),u=a.canvas;f.save(),f.setTransform(1,0,0,1,0,0),f.drawImage(u,a.offsetX,a.offsetY),f.restore(),this.compose()}paintImageMaskXObjectRepeat(e,n,f=0,o=0,a,u){if(!this.contentVisible)return;e=this.getObject(e.data,e);const A=this.ctx;A.save();const E=(0,B.getCurrentTransform)(A);A.transform(n,f,o,a,0,0);const R=this._createMaskCanvas(e);A.setTransform(1,0,0,1,R.offsetX-E[4],R.offsetY-E[5]);for(let k=0,D=u.length;k<D;k+=2){const N=w.Util.transform(E,[n,f,o,a,u[k],u[k+1]]),[F,C]=w.Util.applyTransform([0,0],N);A.drawImage(R.canvas,F,C)}A.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const n=this.ctx,f=this.current.fillColor,o=this.current.patternFill;for(const a of e){const{data:u,width:A,height:E,transform:R}=a,k=this.cachedCanvases.getCanvas("maskCanvas",A,E),D=k.context;D.save();const N=this.getObject(u,a);j(D,N),D.globalCompositeOperation="source-in",D.fillStyle=o?f.getPattern(D,this,(0,B.getCurrentTransformInverse)(n),I.FILL):f,D.fillRect(0,0,A,E),D.restore(),n.save(),n.transform(...R),n.scale(1,-1),_(n,k.canvas,0,0,A,E,0,-1,1,1),n.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){(0,w.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(n)}paintImageXObjectRepeat(e,n,f,o){if(!this.contentVisible)return;const a=this.getObject(e);if(!a){(0,w.warn)("Dependent image isn't ready yet");return}const u=a.width,A=a.height,E=[];for(let R=0,k=o.length;R<k;R+=2)E.push({transform:[n,0,0,f,o[R],o[R+1]],x:0,y:0,w:u,h:A});this.paintInlineImageXObjectGroup(a,E)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:n,width:f,height:o}=e,a=this.cachedCanvases.getCanvas("inlineImage",f,o),u=a.context;return u.filter=this.current.transferMaps,u.drawImage(n,0,0),u.filter="none",a.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const n=e.width,f=e.height,o=this.ctx;if(this.save(),!w.isNodeJS){const{filter:A}=o;A!=="none"&&A!==""&&(o.filter="none")}o.scale(1/n,-1/f);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const E=this.cachedCanvases.getCanvas("inlineImage",n,f).context;nt(E,e),a=this.applyTransferMapsToCanvas(E)}const u=this._scaleImage(a,(0,B.getCurrentTransformInverse)(o));o.imageSmoothingEnabled=pt((0,B.getCurrentTransform)(o),e.interpolate),_(o,u.img,0,0,u.paintWidth,u.paintHeight,0,-f,n,f),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,n){if(!this.contentVisible)return;const f=this.ctx;let o;if(e.bitmap)o=e.bitmap;else{const a=e.width,u=e.height,E=this.cachedCanvases.getCanvas("inlineImage",a,u).context;nt(E,e),o=this.applyTransferMapsToCanvas(E)}for(const a of n)f.save(),f.transform(...a.transform),f.scale(1,-1),_(f,o,a.x,a.y,a.w,a.h,0,-1,1,1),f.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,n){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,n){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const f=this.ctx;this.pendingClip&&(n||(this.pendingClip===st?f.clip("evenodd"):f.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),f.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=(0,B.getCurrentTransform)(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const n=Math.abs(e[0]*e[3]-e[2]*e[1]),f=Math.hypot(e[0],e[2]),o=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(f,o)/n}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:n,b:f,c:o,d:a}=this.ctx.getTransform();let u,A;if(f===0&&o===0){const E=Math.abs(n),R=Math.abs(a);if(E===R)if(e===0)u=A=1/E;else{const k=E*e;u=A=k<1?1/k:1}else if(e===0)u=1/E,A=1/R;else{const k=E*e,D=R*e;u=k<1?1/k:1,A=D<1?1/D:1}}else{const E=Math.abs(n*a-f*o),R=Math.hypot(n,f),k=Math.hypot(o,a);if(e===0)u=k/E,A=R/E;else{const D=e*E;u=k>D?k/D:1,A=R>D?R/D:1}}this._cachedScaleForStroking[0]=u,this._cachedScaleForStroking[1]=A}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:n}=this,{lineWidth:f}=this.current,[o,a]=this.getScaleForStroking();if(n.lineWidth=f||1,o===1&&a===1){n.stroke();return}const u=n.getLineDash();if(e&&n.save(),n.scale(o,a),u.length>0){const A=Math.max(o,a);n.setLineDash(u.map(E=>E/A)),n.lineDashOffset/=A}n.stroke(),e&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const h in w.OPS)m.prototype[h]!==void 0&&(m.prototype[w.OPS[h]]=m.prototype[h])},419:(at,Z,V)=>{V.d(Z,{DOMCMapReaderFactory:()=>v,DOMCanvasFactory:()=>T,DOMFilterFactory:()=>P,DOMSVGFactory:()=>d,DOMStandardFontDataFactory:()=>r,PDFDateString:()=>L,PageViewport:()=>l,PixelsPerInch:()=>G,RenderingCancelledException:()=>b,StatTimer:()=>c,fetchData:()=>x,getColorValues:()=>_,getCurrentTransform:()=>z,getCurrentTransformInverse:()=>q,getFilenameFromUrl:()=>t,getPdfFilenameFromUrl:()=>i,getRGB:()=>O,getXfaPageViewport:()=>M,isDataScheme:()=>s,isPdfFile:()=>g,isValidFetchUrl:()=>p,noContextMenu:()=>y,setLayerDimensions:()=>nt});var w=V(583),B=V(292);const I="http://www.w3.org/2000/svg";class G{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class P extends w.BaseFilterFactory{#t;#e;#s;#n;#r;#i=0;constructor({docId:H,ownerDocument:U=globalThis.document}={}){super(),this.#s=H,this.#n=U}get#a(){return this.#t||=new Map}get#l(){return this.#r||=new Map}get#h(){if(!this.#e){const H=this.#n.createElement("div"),{style:U}=H;U.visibility="hidden",U.contain="strict",U.width=U.height=0,U.position="absolute",U.top=U.left=0,U.zIndex=-1;const Y=this.#n.createElementNS(I,"svg");Y.setAttribute("width",0),Y.setAttribute("height",0),this.#e=this.#n.createElementNS(I,"defs"),H.append(Y),Y.append(this.#e),this.#n.body.append(H)}return this.#e}addFilter(H){if(!H)return"none";let U=this.#a.get(H);if(U)return U;let Y,et,tt,ot;if(H.length===1){const ht=H[0],ut=new Array(256);for(let st=0;st<256;st++)ut[st]=ht[st]/255;ot=Y=et=tt=ut.join(",")}else{const[ht,ut,st]=H,m=new Array(256),h=new Array(256),e=new Array(256);for(let n=0;n<256;n++)m[n]=ht[n]/255,h[n]=ut[n]/255,e[n]=st[n]/255;Y=m.join(","),et=h.join(","),tt=e.join(","),ot=`${Y}${et}${tt}`}if(U=this.#a.get(ot),U)return this.#a.set(H,U),U;const ct=`g_${this.#s}_transfer_map_${this.#i++}`,pt=`url(#${ct})`;this.#a.set(H,pt),this.#a.set(ot,pt);const dt=this.#u(ct);return this.#o(Y,et,tt,dt),pt}addHCMFilter(H,U){const Y=`${H}-${U}`,et="base";let tt=this.#l.get(et);if(tt?.key===Y||(tt?(tt.filter?.remove(),tt.key=Y,tt.url="none",tt.filter=null):(tt={key:Y,url:"none",filter:null},this.#l.set(et,tt)),!H||!U))return tt.url;const ot=this.#p(H);H=B.Util.makeHexColor(...ot);const ct=this.#p(U);if(U=B.Util.makeHexColor(...ct),this.#h.style.color="",H==="#000000"&&U==="#ffffff"||H===U)return tt.url;const pt=new Array(256);for(let m=0;m<=255;m++){const h=m/255;pt[m]=h<=.03928?h/12.92:((h+.055)/1.055)**2.4}const dt=pt.join(","),ht=`g_${this.#s}_hcm_filter`,ut=tt.filter=this.#u(ht);this.#o(dt,dt,dt,ut),this.#d(ut);const st=(m,h)=>{const e=ot[m]/255,n=ct[m]/255,f=new Array(h+1);for(let o=0;o<=h;o++)f[o]=e+o/h*(n-e);return f.join(",")};return this.#o(st(0,5),st(1,5),st(2,5),ut),tt.url=`url(#${ht})`,tt.url}addHighlightHCMFilter(H,U,Y,et,tt){const ot=`${U}-${Y}-${et}-${tt}`;let ct=this.#l.get(H);if(ct?.key===ot||(ct?(ct.filter?.remove(),ct.key=ot,ct.url="none",ct.filter=null):(ct={key:ot,url:"none",filter:null},this.#l.set(H,ct)),!U||!Y))return ct.url;const[pt,dt]=[U,Y].map(this.#p.bind(this));let ht=Math.round(.2126*pt[0]+.7152*pt[1]+.0722*pt[2]),ut=Math.round(.2126*dt[0]+.7152*dt[1]+.0722*dt[2]),[st,m]=[et,tt].map(this.#p.bind(this));ut<ht&&([ht,ut,st,m]=[ut,ht,m,st]),this.#h.style.color="";const h=(f,o,a)=>{const u=new Array(256),A=(ut-ht)/a,E=f/255,R=(o-f)/(255*a);let k=0;for(let D=0;D<=a;D++){const N=Math.round(ht+D*A),F=E+D*R;for(let C=k;C<=N;C++)u[C]=F;k=N+1}for(let D=k;D<256;D++)u[D]=u[k-1];return u.join(",")},e=`g_${this.#s}_hcm_${H}_filter`,n=ct.filter=this.#u(e);return this.#d(n),this.#o(h(st[0],m[0],5),h(st[1],m[1],5),h(st[2],m[2],5),n),ct.url=`url(#${e})`,ct.url}destroy(H=!1){H&&this.#l.size!==0||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#i=0)}#d(H){const U=this.#n.createElementNS(I,"feColorMatrix");U.setAttribute("type","matrix"),U.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),H.append(U)}#u(H){const U=this.#n.createElementNS(I,"filter");return U.setAttribute("color-interpolation-filters","sRGB"),U.setAttribute("id",H),this.#h.append(U),U}#c(H,U,Y){const et=this.#n.createElementNS(I,U);et.setAttribute("type","discrete"),et.setAttribute("tableValues",Y),H.append(et)}#o(H,U,Y,et){const tt=this.#n.createElementNS(I,"feComponentTransfer");et.append(tt),this.#c(tt,"feFuncR",H),this.#c(tt,"feFuncG",U),this.#c(tt,"feFuncB",Y)}#p(H){return this.#h.style.color=H,O(getComputedStyle(this.#h).getPropertyValue("color"))}}class T extends w.BaseCanvasFactory{constructor({ownerDocument:H=globalThis.document}={}){super(),this._document=H}_createCanvas(H,U){const Y=this._document.createElement("canvas");return Y.width=H,Y.height=U,Y}}async function x(j,H="text"){if(p(j,document.baseURI)){const U=await fetch(j);if(!U.ok)throw new Error(U.statusText);switch(H){case"arraybuffer":return U.arrayBuffer();case"blob":return U.blob();case"json":return U.json()}return U.text()}return new Promise((U,Y)=>{const et=new XMLHttpRequest;et.open("GET",j,!0),et.responseType=H,et.onreadystatechange=()=>{if(et.readyState===XMLHttpRequest.DONE){if(et.status===200||et.status===0){switch(H){case"arraybuffer":case"blob":case"json":U(et.response);return}U(et.responseText);return}Y(new Error(et.statusText))}},et.send(null)})}class v extends w.BaseCMapReaderFactory{_fetchData(H,U){return x(H,this.isCompressed?"arraybuffer":"text").then(Y=>({cMapData:Y instanceof ArrayBuffer?new Uint8Array(Y):(0,B.stringToBytes)(Y),compressionType:U}))}}class r extends w.BaseStandardFontDataFactory{_fetchData(H){return x(H,"arraybuffer").then(U=>new Uint8Array(U))}}class d extends w.BaseSVGFactory{_createSVG(H){return document.createElementNS(I,H)}}class l{constructor({viewBox:H,scale:U,rotation:Y,offsetX:et=0,offsetY:tt=0,dontFlip:ot=!1}){this.viewBox=H,this.scale=U,this.rotation=Y,this.offsetX=et,this.offsetY=tt;const ct=(H[2]+H[0])/2,pt=(H[3]+H[1])/2;let dt,ht,ut,st;switch(Y%=360,Y<0&&(Y+=360),Y){case 180:dt=-1,ht=0,ut=0,st=1;break;case 90:dt=0,ht=1,ut=1,st=0;break;case 270:dt=0,ht=-1,ut=-1,st=0;break;case 0:dt=1,ht=0,ut=0,st=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}ot&&(ut=-ut,st=-st);let m,h,e,n;dt===0?(m=Math.abs(pt-H[1])*U+et,h=Math.abs(ct-H[0])*U+tt,e=(H[3]-H[1])*U,n=(H[2]-H[0])*U):(m=Math.abs(ct-H[0])*U+et,h=Math.abs(pt-H[1])*U+tt,e=(H[2]-H[0])*U,n=(H[3]-H[1])*U),this.transform=[dt*U,ht*U,ut*U,st*U,m-dt*U*ct-ut*U*pt,h-ht*U*ct-st*U*pt],this.width=e,this.height=n}get rawDims(){const{viewBox:H}=this;return(0,B.shadow)(this,"rawDims",{pageWidth:H[2]-H[0],pageHeight:H[3]-H[1],pageX:H[0],pageY:H[1]})}clone({scale:H=this.scale,rotation:U=this.rotation,offsetX:Y=this.offsetX,offsetY:et=this.offsetY,dontFlip:tt=!1}={}){return new l({viewBox:this.viewBox.slice(),scale:H,rotation:U,offsetX:Y,offsetY:et,dontFlip:tt})}convertToViewportPoint(H,U){return B.Util.applyTransform([H,U],this.transform)}convertToViewportRectangle(H){const U=B.Util.applyTransform([H[0],H[1]],this.transform),Y=B.Util.applyTransform([H[2],H[3]],this.transform);return[U[0],U[1],Y[0],Y[1]]}convertToPdfPoint(H,U){return B.Util.applyInverseTransform([H,U],this.transform)}}class b extends B.BaseException{constructor(H,U=0){super(H,"RenderingCancelledException"),this.extraDelay=U}}function s(j){const H=j.length;let U=0;for(;U<H&&j[U].trim()==="";)U++;return j.substring(U,U+5).toLowerCase()==="data:"}function g(j){return typeof j=="string"&&/\.pdf$/i.test(j)}function t(j,H=!1){return H||([j]=j.split(/[#?]/,1)),j.substring(j.lastIndexOf("/")+1)}function i(j,H="document.pdf"){if(typeof j!="string")return H;if(s(j))return(0,B.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),H;const U=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Y=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,et=U.exec(j);let tt=Y.exec(et[1])||Y.exec(et[2])||Y.exec(et[3]);if(tt&&(tt=tt[0],tt.includes("%")))try{tt=Y.exec(decodeURIComponent(tt))[0]}catch{}return tt||H}class c{started=Object.create(null);times=[];time(H){H in this.started&&(0,B.warn)(`Timer is already running for ${H}`),this.started[H]=Date.now()}timeEnd(H){H in this.started||(0,B.warn)(`Timer has not been started for ${H}`),this.times.push({name:H,start:this.started[H],end:Date.now()}),delete this.started[H]}toString(){const H=[];let U=0;for(const{name:Y}of this.times)U=Math.max(Y.length,U);for(const{name:Y,start:et,end:tt}of this.times)H.push(`${Y.padEnd(U)} ${tt-et}ms
`);return H.join("")}}function p(j,H){try{const{protocol:U}=H?new URL(j,H):new URL(j);return U==="http:"||U==="https:"}catch{return!1}}function y(j){j.preventDefault()}let S;class L{static toDateObject(H){if(!H||typeof H!="string")return null;S||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const U=S.exec(H);if(!U)return null;const Y=parseInt(U[1],10);let et=parseInt(U[2],10);et=et>=1&&et<=12?et-1:0;let tt=parseInt(U[3],10);tt=tt>=1&&tt<=31?tt:1;let ot=parseInt(U[4],10);ot=ot>=0&&ot<=23?ot:0;let ct=parseInt(U[5],10);ct=ct>=0&&ct<=59?ct:0;let pt=parseInt(U[6],10);pt=pt>=0&&pt<=59?pt:0;const dt=U[7]||"Z";let ht=parseInt(U[8],10);ht=ht>=0&&ht<=23?ht:0;let ut=parseInt(U[9],10)||0;return ut=ut>=0&&ut<=59?ut:0,dt==="-"?(ot+=ht,ct+=ut):dt==="+"&&(ot-=ht,ct-=ut),new Date(Date.UTC(Y,et,tt,ot,ct,pt))}}function M(j,{scale:H=1,rotation:U=0}){const{width:Y,height:et}=j.attributes.style,tt=[0,0,parseInt(Y),parseInt(et)];return new l({viewBox:tt,scale:H,rotation:U})}function O(j){if(j.startsWith("#")){const H=parseInt(j.slice(1),16);return[(H&16711680)>>16,(H&65280)>>8,H&255]}return j.startsWith("rgb(")?j.slice(4,-1).split(",").map(H=>parseInt(H)):j.startsWith("rgba(")?j.slice(5,-1).split(",").map(H=>parseInt(H)).slice(0,3):((0,B.warn)(`Not a valid color format: "${j}"`),[0,0,0])}function _(j){const H=document.createElement("span");H.style.visibility="hidden",document.body.append(H);for(const U of j.keys()){H.style.color=U;const Y=window.getComputedStyle(H).color;j.set(U,O(Y))}H.remove()}function z(j){const{a:H,b:U,c:Y,d:et,e:tt,f:ot}=j.getTransform();return[H,U,Y,et,tt,ot]}function q(j){const{a:H,b:U,c:Y,d:et,e:tt,f:ot}=j.getTransform().invertSelf();return[H,U,Y,et,tt,ot]}function nt(j,H,U=!1,Y=!0){if(H instanceof l){const{pageWidth:et,pageHeight:tt}=H.rawDims,{style:ot}=j,ct=B.FeatureTest.isCSSRoundSupported,pt=`var(--scale-factor) * ${et}px`,dt=`var(--scale-factor) * ${tt}px`,ht=ct?`round(${pt}, 1px)`:`calc(${pt})`,ut=ct?`round(${dt}, 1px)`:`calc(${dt})`;!U||H.rotation%180===0?(ot.width=ht,ot.height=ut):(ot.width=ut,ot.height=ht)}Y&&j.setAttribute("data-main-rotation",H.rotation)}},47:(at,Z,V)=>{V.d(Z,{DrawLayer:()=>I});var w=V(419),B=V(292);class I{#t=null;#e=0;#s=new Map;#n=new Map;constructor({pageIndex:P}){this.pageIndex=P}setParent(P){if(!this.#t){this.#t=P;return}if(this.#t!==P){if(this.#s.size>0)for(const T of this.#s.values())T.remove(),P.append(T);this.#t=P}}static get _svgFactory(){return(0,B.shadow)(this,"_svgFactory",new w.DOMSVGFactory)}static#r(P,{x:T=0,y:x=0,width:v=1,height:r=1}={}){const{style:d}=P;d.top=`${100*x}%`,d.left=`${100*T}%`,d.width=`${100*v}%`,d.height=`${100*r}%`}#i(P){const T=I._svgFactory.create(1,1,!0);return this.#t.append(T),T.setAttribute("aria-hidden",!0),I.#r(T,P),T}#a(P,T){const x=I._svgFactory.createElement("clipPath");P.append(x);const v=`clip_${T}`;x.setAttribute("id",v),x.setAttribute("clipPathUnits","objectBoundingBox");const r=I._svgFactory.createElement("use");return x.append(r),r.setAttribute("href",`#${T}`),r.classList.add("clip"),v}highlight(P,T,x,v=!1){const r=this.#e++,d=this.#i(P.box);d.classList.add("highlight"),P.free&&d.classList.add("free");const l=I._svgFactory.createElement("defs");d.append(l);const b=I._svgFactory.createElement("path");l.append(b);const s=`path_p${this.pageIndex}_${r}`;b.setAttribute("id",s),b.setAttribute("d",P.toSVGPath()),v&&this.#n.set(r,b);const g=this.#a(l,s),t=I._svgFactory.createElement("use");return d.append(t),d.setAttribute("fill",T),d.setAttribute("fill-opacity",x),t.setAttribute("href",`#${s}`),this.#s.set(r,d),{id:r,clipPathId:`url(#${g})`}}highlightOutline(P){const T=this.#e++,x=this.#i(P.box);x.classList.add("highlightOutline");const v=I._svgFactory.createElement("defs");x.append(v);const r=I._svgFactory.createElement("path");v.append(r);const d=`path_p${this.pageIndex}_${T}`;r.setAttribute("id",d),r.setAttribute("d",P.toSVGPath()),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(P.free){x.classList.add("free");const g=I._svgFactory.createElement("mask");v.append(g),l=`mask_p${this.pageIndex}_${T}`,g.setAttribute("id",l),g.setAttribute("maskUnits","objectBoundingBox");const t=I._svgFactory.createElement("rect");g.append(t),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("fill","white");const i=I._svgFactory.createElement("use");g.append(i),i.setAttribute("href",`#${d}`),i.setAttribute("stroke","none"),i.setAttribute("fill","black"),i.setAttribute("fill-rule","nonzero"),i.classList.add("mask")}const b=I._svgFactory.createElement("use");x.append(b),b.setAttribute("href",`#${d}`),l&&b.setAttribute("mask",`url(#${l})`);const s=b.cloneNode();return x.append(s),b.classList.add("mainOutline"),s.classList.add("secondaryOutline"),this.#s.set(T,x),T}finalizeLine(P,T){const x=this.#n.get(P);this.#n.delete(P),this.updateBox(P,T.box),x.setAttribute("d",T.toSVGPath())}updateLine(P,T){this.#s.get(P).firstChild.firstChild.setAttribute("d",T.toSVGPath())}removeFreeHighlight(P){this.remove(P),this.#n.delete(P)}updatePath(P,T){this.#n.get(P).setAttribute("d",T.toSVGPath())}updateBox(P,T){I.#r(this.#s.get(P),T)}show(P,T){this.#s.get(P).classList.toggle("hidden",!T)}rotate(P,T){this.#s.get(P).setAttribute("data-main-rotation",T)}changeColor(P,T){this.#s.get(P).setAttribute("fill",T)}changeOpacity(P,T){this.#s.get(P).setAttribute("fill-opacity",T)}addClass(P,T){this.#s.get(P).classList.add(T)}removeClass(P,T){this.#s.get(P).classList.remove(T)}remove(P){this.#t!==null&&(this.#s.get(P).remove(),this.#s.delete(P))}destroy(){this.#t=null;for(const P of this.#s.values())P.remove();this.#s.clear()}}},731:(at,Z,V)=>{V.d(Z,{AnnotationEditorLayer:()=>s});var w=V(292),B=V(310),I=V(830),G=V(976);const P=/\r\n?|\n/g;class T extends B.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#s=this.editorDivInput.bind(this);#n=this.editorDivKeydown.bind(this);#r=this.editorDivPaste.bind(this);#i;#a="";#l=`${this.id}-editor`;#h;#d=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=T.prototype,i=y=>y.isEmpty(),c=I.AnnotationEditorUIManager.TRANSLATE_SMALL,p=I.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,w.shadow)(this,"_keyboardManager",new I.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-c,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-p,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[c,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[p,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-c],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-p],checker:i}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,c],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,p],checker:i}]]))}static _type="freetext";static _editorType=w.AnnotationEditorType.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#i=t.color||T._defaultColor||B.AnnotationEditor._defaultLineColor,this.#h=t.fontSize||T._defaultFontSize}static initialize(t,i){B.AnnotationEditor.initialize(t,i,{strings:["pdfjs-free-text-default-content"]});const c=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(c.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,i){switch(t){case w.AnnotationEditorParamsType.FREETEXT_SIZE:T._defaultFontSize=i;break;case w.AnnotationEditorParamsType.FREETEXT_COLOR:T._defaultColor=i;break}}updateParams(t,i){switch(t){case w.AnnotationEditorParamsType.FREETEXT_SIZE:this.#u(i);break;case w.AnnotationEditorParamsType.FREETEXT_COLOR:this.#c(i);break}}static get defaultPropertiesToUpdate(){return[[w.AnnotationEditorParamsType.FREETEXT_SIZE,T._defaultFontSize],[w.AnnotationEditorParamsType.FREETEXT_COLOR,T._defaultColor||B.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[w.AnnotationEditorParamsType.FREETEXT_SIZE,this.#h],[w.AnnotationEditorParamsType.FREETEXT_COLOR,this.#i]]}#u(t){const i=p=>{this.editorDiv.style.fontSize=`calc(${p}px * var(--scale-factor))`,this.translate(0,-(p-this.#h)*this.parentScale),this.#h=p,this.#p()},c=this.#h;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#c(t){const i=p=>{this.#i=this.editorDiv.style.color=p},c=this.#i;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,i){this._uiManager.translateSelectedEditors(t,i,!0)}getInitialTranslation(){const t=this.parentScale;return[-T._internalPadding*t,-(T._internalPadding+this.#h)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(w.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#n),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#s),this.editorDiv.addEventListener("paste",this.#r))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#l),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#n),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#s),this.editorDiv.removeEventListener("paste",this.#r),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();for(const i of this.editorDiv.childNodes)t.push(T.#g(i));return t.join(`
`)}#p(){const[t,i]=this.parentDimensions;let c;if(this.isAttachedToDOM)c=this.div.getBoundingClientRect();else{const{currentLayer:p,div:y}=this,S=y.style.display,L=y.classList.contains("hidden");y.classList.remove("hidden"),y.style.display="hidden",p.div.append(this.div),c=y.getBoundingClientRect(),y.remove(),y.style.display=S,y.classList.toggle("hidden",L)}this.rotation%180===this.parentRotation%180?(this.width=c.width/t,this.height=c.height/i):(this.width=c.height/t,this.height=c.width/i),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#a,i=this.#a=this.#o().trimEnd();if(t===i)return;const c=p=>{if(this.#a=p,!p){this.remove();return}this.#f(),this._uiManager.rebuild(this),this.#p()};this.addCommands({cmd:()=>{c(i)},undo:()=>{c(t)},mustExec:!1}),this.#p()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){T._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#l),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),B.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(p=>this.editorDiv?.setAttribute("default-content",p)),this.editorDiv.contentEditable=!0;const{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#h}px * var(--scale-factor))`,c.color=this.#i,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,I.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[p,y]=this.parentDimensions;if(this.annotationElementId){const{position:S}=this.#d;let[L,M]=this.getInitialTranslation();[L,M]=this.pageTranslationToScreen(L,M);const[O,_]=this.pageDimensions,[z,q]=this.pageTranslation;let nt,j;switch(this.rotation){case 0:nt=t+(S[0]-z)/O,j=i+this.height-(S[1]-q)/_;break;case 90:nt=t+(S[0]-z)/O,j=i-(S[1]-q)/_,[L,M]=[M,-L];break;case 180:nt=t-this.width+(S[0]-z)/O,j=i-(S[1]-q)/_,[L,M]=[-L,-M];break;case 270:nt=t+(S[0]-z-this.height*_)/O,j=i+(S[1]-q-this.width*O)/_,[L,M]=[-M,L];break}this.setAt(nt*p,j*y,L,M)}else this.setAt(t*p,i*y,this.width*p,this.height*y);this.#f(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#g(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(P,"")}editorDivPaste(t){const i=t.clipboardData||window.clipboardData,{types:c}=i;if(c.length===1&&c[0]==="text/plain")return;t.preventDefault();const p=T.#m(i.getData("text")||"").replaceAll(P,`
`);if(!p)return;const y=window.getSelection();if(!y.rangeCount)return;this.editorDiv.normalize(),y.deleteFromDocument();const S=y.getRangeAt(0);if(!p.includes(`
`)){S.insertNode(document.createTextNode(p)),this.editorDiv.normalize(),y.collapseToStart();return}const{startContainer:L,startOffset:M}=S,O=[],_=[];if(L.nodeType===Node.TEXT_NODE){const nt=L.parentElement;if(_.push(L.nodeValue.slice(M).replaceAll(P,"")),nt!==this.editorDiv){let j=O;for(const H of this.editorDiv.childNodes){if(H===nt){j=_;continue}j.push(T.#g(H))}}O.push(L.nodeValue.slice(0,M).replaceAll(P,""))}else if(L===this.editorDiv){let nt=O,j=0;for(const H of this.editorDiv.childNodes)j++===M&&(nt=_),nt.push(T.#g(H))}this.#a=`${O.join(`
`)}${p}${_.join(`
`)}`,this.#f();const z=new Range;let q=O.reduce((nt,j)=>nt+j.length,0);for(const{firstChild:nt}of this.editorDiv.childNodes)if(nt.nodeType===Node.TEXT_NODE){const j=nt.nodeValue.length;if(q<=j){z.setStart(nt,q),z.setEnd(nt,q);break}q-=j}y.removeAllRanges(),y.addRange(z)}#f(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const t of this.#a.split(`
`)){const i=document.createElement("div");i.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(i)}}#A(){return this.#a.replaceAll(""," ")}static#m(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}static deserialize(t,i,c){let p=null;if(t instanceof G.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:S,fontColor:L},rect:M,rotation:O,id:_},textContent:z,textPosition:q,parent:{page:{pageNumber:nt}}}=t;if(!z||z.length===0)return null;p=t={annotationType:w.AnnotationEditorType.FREETEXT,color:Array.from(L),fontSize:S,value:z.join(`
`),position:q,pageIndex:nt-1,rect:M.slice(0),rotation:O,id:_,deleted:!1}}const y=super.deserialize(t,i,c);return y.#h=t.fontSize,y.#i=w.Util.makeHexColor(...t.color),y.#a=T.#m(t.value),y.annotationElementId=t.id||null,y.#d=p,y}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const i=T._internalPadding*this.parentScale,c=this.getRect(i,i),p=B.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#i),y={annotationType:w.AnnotationEditorType.FREETEXT,color:p,fontSize:this.#h,value:this.#A(),pageIndex:this.pageIndex,rect:c,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?y:this.annotationElementId&&!this.#v(y)?null:(y.id=this.annotationElementId,y)}#v(t){const{value:i,fontSize:c,color:p,pageIndex:y}=this.#d;return this._hasBeenMoved||t.value!==i||t.fontSize!==c||t.color.some((S,L)=>S!==p[L])||t.pageIndex!==y}renderAnnotationElement(t){const i=super.renderAnnotationElement(t);if(this.deleted)return i;const{style:c}=i;c.fontSize=`calc(${this.#h}px * var(--scale-factor))`,c.color=this.#i,i.replaceChildren();for(const y of this.#a.split(`
`)){const S=document.createElement("div");S.append(y?document.createTextNode(y):document.createElement("br")),i.append(S)}const p=T._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(p,p)}),i}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}var x=V(61),v=V(259),r=V(419);class d extends B.AnnotationEditor{#t=null;#e=0;#s;#n=null;#r=null;#i=null;#a=null;#l=0;#h=null;#d=null;#u=null;#c=!1;#o=this.#E.bind(this);#p=null;#g;#f=null;#A="";#m;#v="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _l10nPromise;static _type="highlight";static _editorType=w.AnnotationEditorType.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=d.prototype;return(0,w.shadow)(this,"_keyboardManager",new I.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||d._defaultColor,this.#m=t.thickness||d._defaultThickness,this.#g=t.opacity||d._defaultOpacity,this.#s=t.boxes||null,this.#v=t.methodOfCreation||"",this.#A=t.text||"",this._isDraggable=!1,t.highlightId>-1?(this.#c=!0,this.#C(t),this.#b()):(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#a=t.focusNode,this.#l=t.focusOffset,this.#w(),this.#b(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#c?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#m,methodOfCreation:this.#v}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new x.Outliner(this.#s,.001);this.#d=t.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#d.box;const i=new x.Outliner(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#i=i.getOutlines();const{lastPoint:c}=this.#i.box;this.#p=[(c[0]-this.x)/this.width,(c[1]-this.y)/this.height]}#C({highlightOutlines:t,highlightId:i,clipPathId:c}){this.#d=t;const p=1.5;if(this.#i=t.getNewOutline(this.#m/2+p,.0025),i>=0)this.#u=i,this.#n=c,this.parent.drawLayer.finalizeLine(i,t),this.#f=this.parent.drawLayer.highlightOutline(this.#i);else if(this.parent){const _=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#u,t),this.parent.drawLayer.updateBox(this.#u,d.#S(this.#d.box,(_-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#f,this.#i),this.parent.drawLayer.updateBox(this.#f,d.#S(this.#i.box,_))}const{x:y,y:S,width:L,height:M}=t.box;switch(this.rotation){case 0:this.x=y,this.y=S,this.width=L,this.height=M;break;case 90:{const[_,z]=this.parentDimensions;this.x=S,this.y=1-y,this.width=L*z/_,this.height=M*_/z;break}case 180:this.x=1-y,this.y=1-S,this.width=L,this.height=M;break;case 270:{const[_,z]=this.parentDimensions;this.x=1-S,this.y=y,this.width=L*z/_,this.height=M*_/z;break}}const{lastPoint:O}=this.#i.box;this.#p=[(O[0]-y)/L,(O[1]-S)/M]}static initialize(t,i){B.AnnotationEditor.initialize(t,i),d._defaultColor||=i.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,i){switch(t){case w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:d._defaultColor=i;break;case w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:d._defaultThickness=i;break}}translateInPage(t,i){}get toolbarPosition(){return this.#p}updateParams(t,i){switch(t){case w.AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#R(i);break;case w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:this.#I(i);break}}static get defaultPropertiesToUpdate(){return[[w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,d._defaultColor],[w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,d._defaultThickness]]}get propertiesToUpdate(){return[[w.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||d._defaultColor],[w.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,this.#m||d._defaultThickness],[w.AnnotationEditorParamsType.HIGHLIGHT_FREE,this.#c]]}#R(t){const i=p=>{this.color=p,this.parent?.drawLayer.changeColor(this.#u,p),this.#r?.updateColor(p)},c=this.color;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#I(t){const i=this.#m,c=p=>{this.#m=p,this.#L(p)};this.addCommands({cmd:c.bind(this,t),undo:c.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(this.#r=new v.ColorPicker({editor:this}),t.addColorPicker(this.#r)),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#T())}getBaseTranslation(){return[0,0]}getRect(t,i){return super.getRect(t,i,this.#T())}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#y(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#b(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let i=!1;this.parent&&!t?this.#y():t&&(this.#b(t),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),i&&this.select()}#L(t){if(!this.#c)return;this.#C({highlightOutlines:this.#d.getNewOutline(t/2)}),this.fixAndSetPosition();const[i,c]=this.parentDimensions;this.setDims(this.width*i,this.height*c)}#y(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#b(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#n}=t.drawLayer.highlight(this.#d,this.color,this.#g),this.#f=t.drawLayer.highlightOutline(this.#i),this.#h&&(this.#h.style.clipPath=this.#n))}static#S({x:t,y:i,width:c,height:p},y){switch(y){case 90:return{x:1-i-p,y:t,width:p,height:c};case 180:return{x:1-t-c,y:1-i-p,width:c,height:p};case 270:return{x:i,y:1-t-c,width:p,height:c}}return{x:t,y:i,width:c,height:p}}rotate(t){const{drawLayer:i}=this.parent;let c;this.#c?(t=(t-this.rotation+360)%360,c=d.#S(this.#d.box,t)):c=d.#S(this,t),i.rotate(this.#u,t),i.rotate(this.#f,t),i.updateBox(this.#u,c),i.updateBox(this.#f,d.#S(this.#i.box,t))}render(){if(this.div)return this.div;const t=super.render();this.#A&&(t.setAttribute("aria-label",this.#A),t.setAttribute("role","mark")),this.#c?t.classList.add("free"):this.div.addEventListener("keydown",this.#o);const i=this.#h=document.createElement("div");t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=this.#n;const[c,p]=this.parentDimensions;return this.setDims(this.width*c,this.height*p),(0,I.bindEvents)(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.parent.drawLayer.addClass(this.#f,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#f,"hovered")}#E(t){d._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#k(!0);break;case 1:case 3:this.#k(!1);break}}#k(t){if(!this.#t)return;const i=window.getSelection();t?i.setPosition(this.#t,this.#e):i.setPosition(this.#a,this.#l)}select(){super.select(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"hovered"),this.parent?.drawLayer.addClass(this.#f,"selected"))}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.removeClass(this.#f,"selected"),this.#c||this.#k(!1))}get _mustFixPosition(){return!this.#c}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.show(this.#u,t),this.parent.drawLayer.show(this.#f,t))}#T(){return this.#c?this.rotation:0}#M(){if(this.#c)return null;const[t,i]=this.pageDimensions,c=this.#s,p=new Array(c.length*8);let y=0;for(const{x:S,y:L,width:M,height:O}of c){const _=S*t,z=(1-L-O)*i;p[y]=p[y+4]=_,p[y+1]=p[y+3]=z,p[y+2]=p[y+6]=_+M*t,p[y+5]=p[y+7]=z+O*i,y+=8}return p}#F(t){return this.#d.serialize(t,this.#T())}static startHighlighting(t,i,{target:c,x:p,y}){const{x:S,y:L,width:M,height:O}=c.getBoundingClientRect(),_=j=>{this.#N(t,j)},z={capture:!0,passive:!1},q=j=>{j.preventDefault(),j.stopPropagation()},nt=j=>{c.removeEventListener("pointermove",_),window.removeEventListener("blur",nt),window.removeEventListener("pointerup",nt),window.removeEventListener("pointerdown",q,z),window.removeEventListener("contextmenu",r.noContextMenu),this.#P(t,j)};window.addEventListener("blur",nt),window.addEventListener("pointerup",nt),window.addEventListener("pointerdown",q,z),window.addEventListener("contextmenu",r.noContextMenu),c.addEventListener("pointermove",_),this._freeHighlight=new x.FreeOutliner({x:p,y},[S,L,M,O],t.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static#N(t,i){this._freeHighlight.add(i)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#P(t,i){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(t,i,c){const p=super.deserialize(t,i,c),{rect:[y,S,L,M],color:O,quadPoints:_}=t;p.color=w.Util.makeHexColor(...O),p.#g=t.opacity;const[z,q]=p.pageDimensions;p.width=(L-y)/z,p.height=(M-S)/q;const nt=p.#s=[];for(let j=0;j<_.length;j+=8)nt.push({x:(_[4]-L)/z,y:(M-(1-_[j+5]))/q,width:(_[j+2]-_[j])/z,height:(_[j+5]-_[j+1])/q});return p.#w(),p}serialize(t=!1){if(this.isEmpty()||t)return null;const i=this.getRect(0,0),c=B.AnnotationEditor._colorManager.convert(this.color);return{annotationType:w.AnnotationEditorType.HIGHLIGHT,color:c,opacity:this.#g,thickness:this.#m,quadPoints:this.#M(),outlines:this.#F(i),pageIndex:this.pageIndex,rect:i,rotation:this.#T(),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}class l extends B.AnnotationEditor{#t=0;#e=0;#s=this.canvasPointermove.bind(this);#n=this.canvasPointerleave.bind(this);#r=this.canvasPointerup.bind(this);#i=this.canvasPointerdown.bind(this);#a=null;#l=new Path2D;#h=!1;#d=!1;#u=!1;#c=null;#o=0;#p=0;#g=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=w.AnnotationEditorType.INK;constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t,i){B.AnnotationEditor.initialize(t,i)}static updateDefaultParams(t,i){switch(t){case w.AnnotationEditorParamsType.INK_THICKNESS:l._defaultThickness=i;break;case w.AnnotationEditorParamsType.INK_COLOR:l._defaultColor=i;break;case w.AnnotationEditorParamsType.INK_OPACITY:l._defaultOpacity=i/100;break}}updateParams(t,i){switch(t){case w.AnnotationEditorParamsType.INK_THICKNESS:this.#f(i);break;case w.AnnotationEditorParamsType.INK_COLOR:this.#A(i);break;case w.AnnotationEditorParamsType.INK_OPACITY:this.#m(i);break}}static get defaultPropertiesToUpdate(){return[[w.AnnotationEditorParamsType.INK_THICKNESS,l._defaultThickness],[w.AnnotationEditorParamsType.INK_COLOR,l._defaultColor||B.AnnotationEditor._defaultLineColor],[w.AnnotationEditorParamsType.INK_OPACITY,Math.round(l._defaultOpacity*100)]]}get propertiesToUpdate(){return[[w.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||l._defaultThickness],[w.AnnotationEditorParamsType.INK_COLOR,this.color||l._defaultColor||B.AnnotationEditor._defaultLineColor],[w.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??l._defaultOpacity))]]}#f(t){const i=p=>{this.thickness=p,this.#_()},c=this.thickness;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#A(t){const i=p=>{this.color=p,this.#E()},c=this.color;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#m(t){const i=p=>{this.opacity=p,this.#E()};t/=100;const c=this.opacity;this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:w.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#T(),this.#M()),this.isAttachedToDOM||(this.parent.add(this),this.#F()),this.#_()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#a&&(clearTimeout(this.#a),this.#a=null),this.#c.disconnect(),this.#c=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,i]=this.parentDimensions,c=this.width*t,p=this.height*i;this.setDimensions(c,p)}enableEditMode(){this.#h||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#i))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#i))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#v(){const{parentRotation:t,parentDimensions:[i,c]}=this;switch(t){case 90:return[0,c,c,i];case 180:return[i,c,i,c];case 270:return[i,0,c,i];default:return[0,0,i,c]}}#w(){const{ctx:t,color:i,opacity:c,thickness:p,parentScale:y,scaleFactor:S}=this;t.lineWidth=p*y/S,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${i}${(0,I.opacityToHex)(c)}`}#C(t,i){this.canvas.addEventListener("contextmenu",r.noContextMenu),this.canvas.addEventListener("pointerleave",this.#n),this.canvas.addEventListener("pointermove",this.#s),this.canvas.addEventListener("pointerup",this.#r),this.canvas.removeEventListener("pointerdown",this.#i),this.isEditing=!0,this.#u||(this.#u=!0,this.#F(),this.thickness||=l._defaultThickness,this.color||=l._defaultColor||B.AnnotationEditor._defaultLineColor,this.opacity??=l._defaultOpacity),this.currentPath.push([t,i]),this.#d=!1,this.#w(),this.#g=()=>{this.#y(),this.#g&&window.requestAnimationFrame(this.#g)},window.requestAnimationFrame(this.#g)}#R(t,i){const[c,p]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===c&&i===p)return;const y=this.currentPath;let S=this.#l;if(y.push([t,i]),this.#d=!0,y.length<=2){S.moveTo(...y[0]),S.lineTo(t,i);return}y.length===3&&(this.#l=S=new Path2D,S.moveTo(...y[0])),this.#b(S,...y.at(-3),...y.at(-2),t,i)}#I(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#l.lineTo(...t)}#L(t,i){this.#g=null,t=Math.min(Math.max(t,0),this.canvas.width),i=Math.min(Math.max(i,0),this.canvas.height),this.#R(t,i),this.#I();let c;if(this.currentPath.length!==1)c=this.#S();else{const M=[t,i];c=[[M,M.slice(),M.slice(),M]]}const p=this.#l,y=this.currentPath;this.currentPath=[],this.#l=new Path2D;const S=()=>{this.allRawPaths.push(y),this.paths.push(c),this.bezierPath2D.push(p),this._uiManager.rebuild(this)},L=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#T(),this.#M()),this.#_())};this.addCommands({cmd:S,undo:L,mustExec:!0})}#y(){if(!this.#d)return;this.#d=!1;const t=Math.ceil(this.thickness*this.parentScale),i=this.currentPath.slice(-3),c=i.map(S=>S[0]),p=i.map(S=>S[1]);Math.min(...c)-t,Math.max(...c)+t,Math.min(...p)-t,Math.max(...p)+t;const{ctx:y}=this;y.save(),y.clearRect(0,0,this.canvas.width,this.canvas.height);for(const S of this.bezierPath2D)y.stroke(S);y.stroke(this.#l),y.restore()}#b(t,i,c,p,y,S,L){const M=(i+p)/2,O=(c+y)/2,_=(p+S)/2,z=(y+L)/2;t.bezierCurveTo(M+2*(p-M)/3,O+2*(y-O)/3,_+2*(p-_)/3,z+2*(y-z)/3,_,z)}#S(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const i=[];let c,[p,y]=t[0];for(c=1;c<t.length-2;c++){const[q,nt]=t[c],[j,H]=t[c+1],U=(q+j)/2,Y=(nt+H)/2,et=[p+2*(q-p)/3,y+2*(nt-y)/3],tt=[U+2*(q-U)/3,Y+2*(nt-Y)/3];i.push([[p,y],et,tt,[U,Y]]),[p,y]=[U,Y]}const[S,L]=t[c],[M,O]=t[c+1],_=[p+2*(S-p)/3,y+2*(L-y)/3],z=[M+2*(S-M)/3,O+2*(L-O)/3];return i.push([[p,y],_,z,[M,O]]),i}#E(){if(this.isEmpty()){this.#P();return}this.#w();const{canvas:t,ctx:i}=this;i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height),this.#P();for(const c of this.bezierPath2D)i.stroke(c)}commit(){this.#h||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#h=!0,this.div.classList.add("disabled"),this.#_(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#h||(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#C(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#R(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#k(t)}canvasPointerleave(t){this.#k(t)}#k(t){this.canvas.removeEventListener("pointerleave",this.#n),this.canvas.removeEventListener("pointermove",this.#s),this.canvas.removeEventListener("pointerup",this.#r),this.canvas.addEventListener("pointerdown",this.#i),this.#a&&clearTimeout(this.#a),this.#a=setTimeout(()=>{this.#a=null,this.canvas.removeEventListener("contextmenu",r.noContextMenu)},10),this.#L(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#T(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#M(){this.#c=new ResizeObserver(t=>{const i=t[0].contentRect;i.width&&i.height&&this.setDimensions(i.width,i.height)}),this.#c.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#h}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[c,p,y,S]=this.#v();if(this.setAt(c,p,0,0),this.setDims(y,S),this.#T(),this.width){const[L,M]=this.parentDimensions;this.setAspectRatio(this.width*L,this.height*M),this.setAt(t*L,i*M,this.width*L,this.height*M),this.#u=!0,this.#F(),this.setDims(this.width*L,this.height*M),this.#E(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#M(),this.div}#F(){if(!this.#u)return;const[t,i]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*i),this.#P()}setDimensions(t,i){const c=Math.round(t),p=Math.round(i);if(this.#o===c&&this.#p===p)return;this.#o=c,this.#p=p,this.canvas.style.visibility="hidden";const[y,S]=this.parentDimensions;this.width=t/y,this.height=i/S,this.fixAndSetPosition(),this.#h&&this.#N(t,i),this.#F(),this.#E(),this.canvas.style.visibility="visible",this.fixDims()}#N(t,i){const c=this.#B(),p=(t-c)/this.#e,y=(i-c)/this.#t;this.scaleFactor=Math.min(p,y)}#P(){const t=this.#B()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#D(t){const i=new Path2D;for(let c=0,p=t.length;c<p;c++){const[y,S,L,M]=t[c];c===0&&i.moveTo(...y),i.bezierCurveTo(S[0],S[1],L[0],L[1],M[0],M[1])}return i}static#U(t,i,c){const[p,y,S,L]=i;switch(c){case 0:for(let M=0,O=t.length;M<O;M+=2)t[M]+=p,t[M+1]=L-t[M+1];break;case 90:for(let M=0,O=t.length;M<O;M+=2){const _=t[M];t[M]=t[M+1]+p,t[M+1]=_+y}break;case 180:for(let M=0,O=t.length;M<O;M+=2)t[M]=S-t[M],t[M+1]+=y;break;case 270:for(let M=0,O=t.length;M<O;M+=2){const _=t[M];t[M]=S-t[M+1],t[M+1]=L-_}break;default:throw new Error("Invalid rotation")}return t}static#$(t,i,c){const[p,y,S,L]=i;switch(c){case 0:for(let M=0,O=t.length;M<O;M+=2)t[M]-=p,t[M+1]=L-t[M+1];break;case 90:for(let M=0,O=t.length;M<O;M+=2){const _=t[M];t[M]=t[M+1]-y,t[M+1]=_-p}break;case 180:for(let M=0,O=t.length;M<O;M+=2)t[M]=S-t[M],t[M+1]-=y;break;case 270:for(let M=0,O=t.length;M<O;M+=2){const _=t[M];t[M]=L-t[M+1],t[M+1]=S-_}break;default:throw new Error("Invalid rotation")}return t}#X(t,i,c,p){const y=[],S=this.thickness/2,L=t*i+S,M=t*c+S;for(const O of this.paths){const _=[],z=[];for(let q=0,nt=O.length;q<nt;q++){const[j,H,U,Y]=O[q];if(j[0]===Y[0]&&j[1]===Y[1]&&nt===1){const st=t*j[0]+L,m=t*j[1]+M;_.push(st,m),z.push(st,m);break}const et=t*j[0]+L,tt=t*j[1]+M,ot=t*H[0]+L,ct=t*H[1]+M,pt=t*U[0]+L,dt=t*U[1]+M,ht=t*Y[0]+L,ut=t*Y[1]+M;q===0&&(_.push(et,tt),z.push(et,tt)),_.push(ot,ct,pt,dt,ht,ut),z.push(ot,ct),q===nt-1&&z.push(ht,ut)}y.push({bezier:l.#U(_,p,this.rotation),points:l.#U(z,p,this.rotation)})}return y}#G(){let t=1/0,i=-1/0,c=1/0,p=-1/0;for(const y of this.paths)for(const[S,L,M,O]of y){const _=w.Util.bezierBoundingBox(...S,...L,...M,...O);t=Math.min(t,_[0]),c=Math.min(c,_[1]),i=Math.max(i,_[2]),p=Math.max(p,_[3])}return[t,c,i,p]}#B(){return this.#h?Math.ceil(this.thickness*this.parentScale):0}#_(t=!1){if(this.isEmpty())return;if(!this.#h){this.#E();return}const i=this.#G(),c=this.#B();this.#e=Math.max(B.AnnotationEditor.MIN_SIZE,i[2]-i[0]),this.#t=Math.max(B.AnnotationEditor.MIN_SIZE,i[3]-i[1]);const p=Math.ceil(c+this.#e*this.scaleFactor),y=Math.ceil(c+this.#t*this.scaleFactor),[S,L]=this.parentDimensions;this.width=p/S,this.height=y/L,this.setAspectRatio(p,y);const M=this.translationX,O=this.translationY;this.translationX=-i[0],this.translationY=-i[1],this.#F(),this.#E(),this.#o=p,this.#p=y,this.setDims(p,y);const _=t?c/this.scaleFactor/2:0;this.translate(M-this.translationX-_,O-this.translationY-_)}static deserialize(t,i,c){if(t instanceof G.InkAnnotationElement)return null;const p=super.deserialize(t,i,c);p.thickness=t.thickness,p.color=w.Util.makeHexColor(...t.color),p.opacity=t.opacity;const[y,S]=p.pageDimensions,L=p.width*y,M=p.height*S,O=p.parentScale,_=t.thickness/2;p.#h=!0,p.#o=Math.round(L),p.#p=Math.round(M);const{paths:z,rect:q,rotation:nt}=t;for(let{bezier:H}of z){H=l.#$(H,q,nt);const U=[];p.paths.push(U);let Y=O*(H[0]-_),et=O*(H[1]-_);for(let ot=2,ct=H.length;ot<ct;ot+=6){const pt=O*(H[ot]-_),dt=O*(H[ot+1]-_),ht=O*(H[ot+2]-_),ut=O*(H[ot+3]-_),st=O*(H[ot+4]-_),m=O*(H[ot+5]-_);U.push([[Y,et],[pt,dt],[ht,ut],[st,m]]),Y=st,et=m}const tt=this.#D(U);p.bezierPath2D.push(tt)}const j=p.#G();return p.#e=Math.max(B.AnnotationEditor.MIN_SIZE,j[2]-j[0]),p.#t=Math.max(B.AnnotationEditor.MIN_SIZE,j[3]-j[1]),p.#N(L,M),p}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),i=B.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:w.AnnotationEditorType.INK,color:i,thickness:this.thickness,opacity:this.opacity,paths:this.#X(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class b extends B.AnnotationEditor{#t=null;#e=null;#s=null;#n=null;#r=null;#i="";#a=null;#l=null;#h=null;#d=!1;#u=!1;static _type="stamp";static _editorType=w.AnnotationEditorType.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#r=t.bitmapFile}static initialize(t,i){B.AnnotationEditor.initialize(t,i)}static get supportedTypes(){const t=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,w.shadow)(this,"supportedTypes",t.map(i=>`image/${i}`))}static get supportedTypesStr(){return(0,w.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,i){i.pasteEditor(w.AnnotationEditorType.STAMP,{bitmapFile:t.getAsFile()})}#c(t,i=!1){if(!t){this.remove();return}this.#t=t.bitmap,i||(this.#e=t.id,this.#d=t.isSvg),t.file&&(this.#i=t.file.name),this.#g()}#o(){this.#s=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#p(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#c(i,!0)).finally(()=>this.#o());return}if(this.#n){const i=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(i).then(c=>this.#c(c)).finally(()=>this.#o());return}if(this.#r){const i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(i).then(c=>this.#c(c)).finally(()=>this.#o());return}const t=document.createElement("input");t.type="file",t.accept=b.supportedTypesStr,this.#s=new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const c=await this._uiManager.imageManager.getFromFile(t.files[0]);this.#c(c)}i()}),t.addEventListener("cancel",()=>{this.remove(),i()})}).finally(()=>this.#o()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#l?.disconnect(),this.#l=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#p();return}super.rebuild(),this.div!==null&&(this.#e&&this.#a===null&&this.#p(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#n||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let t,i;if(this.width&&(t=this.x,i=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),this.#t?this.#g():this.#p(),this.width){const[c,p]=this.parentDimensions;this.setAt(t*c,i*p,this.width*c,this.height*p)}return this.div}#g(){const{div:t}=this;let{width:i,height:c}=this.#t;const[p,y]=this.pageDimensions,S=.75;if(this.width)i=this.width*p,c=this.height*y;else if(i>S*p||c>S*y){const _=Math.min(S*p/i,S*y/c);i*=_,c*=_}const[L,M]=this.parentDimensions;this.setDims(i*L/p,c*M/y),this._uiManager.enableWaiting(!1);const O=this.#a=document.createElement("canvas");t.append(O),t.hidden=!1,this.#m(i,c),this.#w(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#i&&O.setAttribute("aria-label",this.#i)}#f(t,i){const[c,p]=this.parentDimensions;this.width=t/c,this.height=i/p,this.setDims(t,i),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#h!==null&&clearTimeout(this.#h);const y=200;this.#h=setTimeout(()=>{this.#h=null,this.#m(t,i)},y)}#A(t,i){const{width:c,height:p}=this.#t;let y=c,S=p,L=this.#t;for(;y>2*t||S>2*i;){const M=y,O=S;y>2*t&&(y=y>=16384?Math.floor(y/2)-1:Math.ceil(y/2)),S>2*i&&(S=S>=16384?Math.floor(S/2)-1:Math.ceil(S/2));const _=new OffscreenCanvas(y,S);_.getContext("2d").drawImage(L,0,0,M,O,0,0,y,S),L=_.transferToImageBitmap()}return L}#m(t,i){t=Math.ceil(t),i=Math.ceil(i);const c=this.#a;if(!c||c.width===t&&c.height===i)return;c.width=t,c.height=i;const p=this.#d?this.#t:this.#A(t,i);if(this._uiManager.hasMLManager&&!this.hasAltText()){const S=new OffscreenCanvas(t,i);S.getContext("2d").drawImage(p,0,0,p.width,p.height,0,0,t,i),S.convertToBlob().then(M=>{const O=new FileReader;O.onload=()=>{const _=O.result;this._uiManager.mlGuess({service:"image-to-text",request:{imageData:_}}).then(z=>{const q=z?.output||"";this.parent&&q&&!this.hasAltText()&&(this.altTextData={altText:q,decorative:!1})})},O.readAsDataURL(M)})}const y=c.getContext("2d");y.filter=this._uiManager.hcmFilter,y.drawImage(p,0,0,p.width,p.height,0,0,t,i)}getImageForAltText(){return this.#a}#v(t){if(t){if(this.#d){const p=this._uiManager.imageManager.getSvgUrl(this.#e);if(p)return p}const i=document.createElement("canvas");return{width:i.width,height:i.height}=this.#t,i.getContext("2d").drawImage(this.#t,0,0),i.toDataURL()}if(this.#d){const[i,c]=this.pageDimensions,p=Math.round(this.width*i*r.PixelsPerInch.PDF_TO_CSS_UNITS),y=Math.round(this.height*c*r.PixelsPerInch.PDF_TO_CSS_UNITS),S=new OffscreenCanvas(p,y);return S.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,p,y),S.transferToImageBitmap()}return structuredClone(this.#t)}#w(){this.#l=new ResizeObserver(t=>{const i=t[0].contentRect;i.width&&i.height&&this.#f(i.width,i.height)}),this.#l.observe(this.div)}static deserialize(t,i,c){if(t instanceof G.StampAnnotationElement)return null;const p=super.deserialize(t,i,c),{rect:y,bitmapUrl:S,bitmapId:L,isSvg:M,accessibilityData:O}=t;L&&c.imageManager.isValidId(L)?p.#e=L:p.#n=S,p.#d=M;const[_,z]=p.pageDimensions;return p.width=(y[2]-y[0])/_,p.height=(y[3]-y[1])/z,O&&(p.altTextData=O),p}serialize(t=!1,i=null){if(this.isEmpty())return null;const c={annotationType:w.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#d,structTreeParentId:this._structTreeParentId};if(t)return c.bitmapUrl=this.#v(!0),c.accessibilityData=this.altTextData,c;const{decorative:p,altText:y}=this.altTextData;if(!p&&y&&(c.accessibilityData={type:"Figure",alt:y}),i===null)return c;i.stamps||=new Map;const S=this.#d?(c.rect[2]-c.rect[0])*(c.rect[3]-c.rect[1]):null;if(!i.stamps.has(this.#e))i.stamps.set(this.#e,{area:S,serialized:c}),c.bitmap=this.#v(!1);else if(this.#d){const L=i.stamps.get(this.#e);S>L.area&&(L.area=S,L.serialized.bitmap.close(),L.serialized.bitmap=this.#v(!1))}return c}}class s{#t;#e=!1;#s=null;#n=null;#r=null;#i=null;#a=null;#l=new Map;#h=!1;#d=!1;#u=!1;#c=null;#o;static _initialized=!1;static#p=new Map([T,l,b,d].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:i,div:c,accessibilityManager:p,annotationLayer:y,drawLayer:S,textLayer:L,viewport:M,l10n:O}){const _=[...s.#p.values()];if(!s._initialized){s._initialized=!0;for(const z of _)z.initialize(O,t)}t.registerEditorTypes(_),this.#o=t,this.pageIndex=i,this.div=c,this.#t=p,this.#s=y,this.viewport=M,this.#c=L,this.drawLayer=S,this.#o.addLayer(this)}get isEmpty(){return this.#l.size===0}get isInvisible(){return this.isEmpty&&this.#o.getMode()===w.AnnotationEditorType.NONE}updateToolbar(t){this.#o.updateToolbar(t)}updateMode(t=this.#o.getMode()){switch(this.#v(),t){case w.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case w.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case w.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:i}=this.div;for(const c of s.#p.values())i.toggle(`${c._type}Editing`,t===c._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#c?.div}addInkEditorIfNeeded(t){if(this.#o.getMode()!==w.AnnotationEditorType.INK)return;if(!t){for(const c of this.#l.values())if(c.isEmpty()){c.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(t){this.#o.setEditingState(t)}addCommands(t){this.#o.addCommands(t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.div.classList.toggle("disabled",!t)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const c of this.#l.values())c.enableEditing(),c.show(!0),c.annotationElementId&&(this.#o.removeChangedExistingAnnotation(c),t.add(c.annotationElementId));if(!this.#s)return;const i=this.#s.getEditableAnnotations();for(const c of i){if(c.hide(),this.#o.isDeletedAnnotationElement(c.data.id)||t.has(c.data.id))continue;const p=this.deserialize(c);p&&(this.addOrRebuild(p),p.enableEditing())}}disable(){this.#u=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,i=new Map;for(const p of this.#l.values())if(p.disableEditing(),!!p.annotationElementId){if(p.serialize()!==null){t.set(p.annotationElementId,p);continue}else i.set(p.annotationElementId,p);this.getEditableAnnotation(p.annotationElementId)?.show(),p.remove()}if(this.#s){const p=this.#s.getEditableAnnotations();for(const y of p){const{id:S}=y.data;if(this.#o.isDeletedAnnotationElement(S))continue;let L=i.get(S);if(L){L.resetAnnotationElement(y),L.show(!1),y.show();continue}L=t.get(S),L&&(this.#o.addChangedExistingAnnotation(L),L.renderAnnotationElement(y),L.show(!1)),y.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:c}=this.div;for(const p of s.#p.values())c.remove(`${p._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#u=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#o.getActive()!==t&&this.#o.setActiveEditor(t)}enableTextSelection(){this.div.tabIndex=-1,this.#c?.div&&!this.#i&&(this.#i=this.#g.bind(this),this.#c.div.addEventListener("pointerdown",this.#i),this.#c.div.classList.add("highlighting"))}disableTextSelection(){this.div.tabIndex=0,this.#c?.div&&this.#i&&(this.#c.div.removeEventListener("pointerdown",this.#i),this.#i=null,this.#c.div.classList.remove("highlighting"))}#g(t){if(this.#o.unselectAll(),t.target===this.#c.div){const{isMac:i}=w.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#o.showAllEditors("highlight",!0,!0),this.#c.div.classList.add("free"),d.startHighlighting(this,this.#o.direction==="ltr",t),this.#c.div.addEventListener("pointerup",()=>{this.#c.div.classList.remove("free")},{once:!0}),t.preventDefault()}}enableClick(){this.#r||(this.#r=this.pointerdown.bind(this),this.#n=this.pointerup.bind(this),this.div.addEventListener("pointerdown",this.#r),this.div.addEventListener("pointerup",this.#n))}disableClick(){this.#r&&(this.div.removeEventListener("pointerdown",this.#r),this.div.removeEventListener("pointerup",this.#n),this.#r=null,this.#n=null)}attach(t){this.#l.set(t.id,t);const{annotationElementId:i}=t;i&&this.#o.isDeletedAnnotationElement(i)&&this.#o.removeDeletedAnnotationElement(t)}detach(t){this.#l.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#u&&t.annotationElementId&&this.#o.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#o.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,this.#d||this.addInkEditorIfNeeded(!1)}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#o.addDeletedAnnotationElement(t.annotationElementId),B.AnnotationEditor.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#o.addEditor(t),this.attach(t),!t.isAttachedToDOM){const i=t.render();this.div.append(i),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),this.#o.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:i}=document;t.div.contains(i)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0}),i.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const i=()=>t._uiManager.rebuild(t),c=()=>{t.remove()};this.addCommands({cmd:i,undo:c,mustExec:!1})}getNextId(){return this.#o.getId()}get#f(){return s.#p.get(this.#o.getMode())}#A(t){const i=this.#f;return i?new i.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#f?.canCreateNewEmptyEditor()}pasteEditor(t,i){this.#o.updateToolbar(t),this.#o.updateMode(t);const{offsetX:c,offsetY:p}=this.#m(),y=this.getNextId(),S=this.#A({parent:this,id:y,x:c,y:p,uiManager:this.#o,isCentered:!0,...i});S&&this.add(S)}deserialize(t){return s.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#o)||null}createAndAddNewEditor(t,i,c={}){const p=this.getNextId(),y=this.#A({parent:this,id:p,x:t.offsetX,y:t.offsetY,uiManager:this.#o,isCentered:i,...c});return y&&this.add(y),y}#m(){const{x:t,y:i,width:c,height:p}=this.div.getBoundingClientRect(),y=Math.max(0,t),S=Math.max(0,i),L=Math.min(window.innerWidth,t+c),M=Math.min(window.innerHeight,i+p),O=(y+L)/2-t,_=(S+M)/2-i,[z,q]=this.viewport.rotation%180===0?[O,_]:[_,O];return{offsetX:z,offsetY:q}}addNewEditor(){this.createAndAddNewEditor(this.#m(),!0)}setSelected(t){this.#o.setSelected(t)}toggleSelected(t){this.#o.toggleSelected(t)}isSelected(t){return this.#o.isSelected(t)}unselect(t){this.#o.unselect(t)}pointerup(t){const{isMac:i}=w.FeatureTest.platform;if(!(t.button!==0||t.ctrlKey&&i)&&t.target===this.div&&this.#h){if(this.#h=!1,!this.#e){this.#e=!0;return}if(this.#o.getMode()===w.AnnotationEditorType.STAMP){this.#o.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#o.getMode()===w.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#h){this.#h=!1;return}const{isMac:i}=w.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&i||t.target!==this.div)return;this.#h=!0;const c=this.#o.getActive();this.#e=!c||c.isEmpty()}findNewParent(t,i,c){const p=this.#o.findParent(i,c);return p===null||p===this?!1:(p.changeParent(t),!0)}destroy(){this.#o.getActive()?.parent===this&&(this.#o.commitOrRemove(),this.#o.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#l.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#l.clear(),this.#o.removeLayer(this)}#v(){this.#d=!0;for(const t of this.#l.values())t.isEmpty()&&t.remove();this.#d=!1}render({viewport:t}){this.viewport=t,(0,r.setLayerDimensions)(this.div,t);for(const i of this.#o.getEditors(this.pageIndex))this.add(i),i.rebuild();this.updateMode()}update({viewport:t}){this.#o.commitOrRemove(),this.#v();const i=this.viewport.rotation,c=t.rotation;if(this.viewport=t,(0,r.setLayerDimensions)(this.div,{rotation:c}),i!==c)for(const p of this.#l.values())p.rotate(c);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:t,pageHeight:i}=this.viewport.rawDims;return[t,i]}get scale(){return this.#o.viewParameters.realScale}}},259:(at,Z,V)=>{V.d(Z,{ColorPicker:()=>G});var w=V(292),B=V(830),I=V(419);class G{#t=this.#g.bind(this);#e=this.#A.bind(this);#s=null;#n=null;#r;#i=null;#a=!1;#l=!1;#h=null;#d;#u=null;#c;static get _keyboardManager(){return(0,w.shadow)(this,"_keyboardManager",new B.KeyboardManager([[["Escape","mac+Escape"],G.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],G.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],G.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],G.prototype._moveToPrevious],[["Home","mac+Home"],G.prototype._moveToBeginning],[["End","mac+End"],G.prototype._moveToEnd]]))}constructor({editor:T=null,uiManager:x=null}){T?(this.#l=!1,this.#c=w.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.#h=T):(this.#l=!0,this.#c=w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR),this.#u=T?._uiManager||x,this.#d=this.#u._eventBus,this.#r=T?.color||this.#u?.highlightColors.values().next().value||"#FFFF98"}renderButton(){const T=this.#s=document.createElement("button");T.className="colorPicker",T.tabIndex="0",T.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),T.setAttribute("aria-haspopup",!0),T.addEventListener("click",this.#f.bind(this)),T.addEventListener("keydown",this.#t);const x=this.#n=document.createElement("span");return x.className="swatch",x.setAttribute("aria-hidden",!0),x.style.backgroundColor=this.#r,T.append(x),T}renderMainDropdown(){const T=this.#i=this.#o();return T.setAttribute("aria-orientation","horizontal"),T.setAttribute("aria-labelledby","highlightColorPickerLabel"),T}#o(){const T=document.createElement("div");T.addEventListener("contextmenu",I.noContextMenu),T.className="dropdown",T.role="listbox",T.setAttribute("aria-multiselectable",!1),T.setAttribute("aria-orientation","vertical"),T.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[x,v]of this.#u.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",v),r.title=x,r.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${x}`);const d=document.createElement("span");r.append(d),d.className="swatch",d.style.backgroundColor=v,r.setAttribute("aria-selected",v===this.#r),r.addEventListener("click",this.#p.bind(this,v)),T.append(r)}return T.addEventListener("keydown",this.#t),T}#p(T,x){x.stopPropagation(),this.#d.dispatch("switchannotationeditorparams",{source:this,type:this.#c,value:T})}_colorSelectFromKeyboard(T){if(T.target===this.#s){this.#f(T);return}const x=T.target.getAttribute("data-color");x&&this.#p(x,T)}_moveToNext(T){if(!this.#m){this.#f(T);return}if(T.target===this.#s){this.#i.firstChild?.focus();return}T.target.nextSibling?.focus()}_moveToPrevious(T){if(T.target===this.#i?.firstChild||T.target===this.#s){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#f(T),T.target.previousSibling?.focus()}_moveToBeginning(T){if(!this.#m){this.#f(T);return}this.#i.firstChild?.focus()}_moveToEnd(T){if(!this.#m){this.#f(T);return}this.#i.lastChild?.focus()}#g(T){G._keyboardManager.exec(this,T)}#f(T){if(this.#m){this.hideDropdown();return}if(this.#a=T.detail===0,window.addEventListener("pointerdown",this.#e),this.#i){this.#i.classList.remove("hidden");return}const x=this.#i=this.#o();this.#s.append(x)}#A(T){this.#i?.contains(T.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),window.removeEventListener("pointerdown",this.#e)}get#m(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#l){if(!this.#m){this.#h?.unselect();return}this.hideDropdown(),this.#s.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(T){if(this.#n&&(this.#n.style.backgroundColor=T),!this.#i)return;const x=this.#u.highlightColors.values();for(const v of this.#i.children)v.setAttribute("aria-selected",x.next().value===T)}destroy(){this.#s?.remove(),this.#s=null,this.#n=null,this.#i?.remove(),this.#i=null}}},310:(at,Z,V)=>{V.d(Z,{AnnotationEditor:()=>T});var w=V(830),B=V(292),I=V(419);class G{#t="";#e=!1;#s=null;#n=null;#r=null;#i=!1;#a=null;static _l10nPromise=null;constructor(r){this.#a=r}static initialize(r){G._l10nPromise||=r}async render(){const r=this.#s=document.createElement("button");r.className="altText";const d=await G._l10nPromise.get("pdfjs-editor-alt-text-button-label");r.textContent=d,r.setAttribute("aria-label",d),r.tabIndex="0",r.addEventListener("contextmenu",I.noContextMenu),r.addEventListener("pointerdown",b=>b.stopPropagation());const l=b=>{b.preventDefault(),this.#a._uiManager.editAltText(this.#a)};return r.addEventListener("click",l,{capture:!0}),r.addEventListener("keydown",b=>{b.target===r&&b.key==="Enter"&&(this.#i=!0,l(b))}),await this.#l(),r}finish(){this.#s&&(this.#s.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return!this.#t&&!this.#e}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:r,decorative:d}){this.#t===r&&this.#e===d||(this.#t=r,this.#e=d,this.#l())}toggle(r=!1){this.#s&&(!r&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#s.disabled=!r)}destroy(){this.#s?.remove(),this.#s=null,this.#n=null}async#l(){const r=this.#s;if(!r)return;if(!this.#t&&!this.#e){r.classList.remove("done"),this.#n?.remove();return}r.classList.add("done"),G._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(b=>{r.setAttribute("aria-label",b)});let d=this.#n;if(!d){this.#n=d=document.createElement("span"),d.className="tooltip",d.setAttribute("role","tooltip");const b=d.id=`alt-text-tooltip-${this.#a.id}`;r.setAttribute("aria-describedby",b);const s=100;r.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#n.classList.add("show"),this.#a._reportTelemetry({action:"alt_text_tooltip"})},s)}),r.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#n?.classList.remove("show")})}d.innerText=this.#e?await G._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#t,d.parentNode||r.append(d),this.#a.getImageForAltText()?.setAttribute("aria-describedby",d.id)}}var P=V(362);class T{#t=null;#e=null;#s=!1;#n=!1;#r=null;#i=null;#a=this.focusin.bind(this);#l=this.focusout.bind(this);#h=null;#d="";#u=!1;#c=null;#o=!1;#p=!1;#g=!1;#f=null;#A=0;#m=0;#v=null;_initialOptions=Object.create(null);_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#w=!1;#C=T._zIndex++;static _borderLineWidth=-1;static _colorManager=new w.ColorManager;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const r=T.prototype._resizeWithKeyboard,d=w.AnnotationEditorUIManager.TRANSLATE_SMALL,l=w.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,B.shadow)(this,"_resizerKeyboardManager",new w.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],r,{args:[-d,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],r,{args:[-l,0]}],[["ArrowRight","mac+ArrowRight"],r,{args:[d,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],r,{args:[l,0]}],[["ArrowUp","mac+ArrowUp"],r,{args:[0,-d]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],r,{args:[0,-l]}],[["ArrowDown","mac+ArrowDown"],r,{args:[0,d]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],r,{args:[0,l]}],[["Escape","mac+Escape"],T.prototype._stopResizingWithKeyboard]]))}constructor(r){this.constructor===T&&(0,B.unreachable)("Cannot initialize AnnotationEditor."),this.parent=r.parent,this.id=r.id,this.width=this.height=null,this.pageIndex=r.parent.pageIndex,this.name=r.name,this.div=null,this._uiManager=r.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=r.isCentered,this._structTreeParentId=null;const{rotation:d,rawDims:{pageWidth:l,pageHeight:b,pageX:s,pageY:g}}=this.parent.viewport;this.rotation=d,this.pageRotation=(360+d-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[l,b],this.pageTranslation=[s,g];const[t,i]=this.parentDimensions;this.x=r.x/t,this.y=r.y/i,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,B.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(r){const d=new x({id:r.parent.getNextId(),parent:r.parent,uiManager:r._uiManager});d.annotationElementId=r.annotationElementId,d.deleted=!0,d._uiManager.addToAnnotationStorage(d)}static initialize(r,d,l){if(T._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(s=>[s,r.get(s.replaceAll(/([A-Z])/g,g=>`-${g.toLowerCase()}`))])),l?.strings)for(const s of l.strings)T._l10nPromise.set(s,r.get(s));if(T._borderLineWidth!==-1)return;const b=getComputedStyle(document.documentElement);T._borderLineWidth=parseFloat(b.getPropertyValue("--outline-width"))||0}static updateDefaultParams(r,d){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(r){return!1}static paste(r,d){(0,B.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(r){this.#w=r,this.div?.classList.toggle("draggable",r)}get isEnterHandled(){return!0}center(){const[r,d]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*d/(r*2),this.y+=this.width*r/(d*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*d/(r*2),this.y-=this.width*r/(d*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(r){this._uiManager.addCommands(r)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#C}setParent(r){r!==null?(this.pageIndex=r.pageIndex,this.pageDimensions=r.pageDimensions):this.#D(),this.parent=r}focusin(r){this._focusEventsAllowed&&(this.#u?this.#u=!1:this.parent.setSelected(this))}focusout(r){!this._focusEventsAllowed||!this.isAttachedToDOM||r.relatedTarget?.closest(`#${this.id}`)||(r.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(r,d,l,b){const[s,g]=this.parentDimensions;[l,b]=this.screenToPageTranslation(l,b),this.x=(r+l)/s,this.y=(d+b)/g,this.fixAndSetPosition()}#R([r,d],l,b){[l,b]=this.screenToPageTranslation(l,b),this.x+=l/r,this.y+=b/d,this.fixAndSetPosition()}translate(r,d){this.#R(this.parentDimensions,r,d)}translateInPage(r,d){this.#c||=[this.x,this.y],this.#R(this.pageDimensions,r,d),this.div.scrollIntoView({block:"nearest"})}drag(r,d){this.#c||=[this.x,this.y];const[l,b]=this.parentDimensions;if(this.x+=r/l,this.y+=d/b,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:c,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,c,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:s,y:g}=this;const[t,i]=this.getBaseTranslation();s+=t,g+=i,this.div.style.left=`${(100*s).toFixed(2)}%`,this.div.style.top=`${(100*g).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#c&&(this.#c[0]!==this.x||this.#c[1]!==this.y)}getBaseTranslation(){const[r,d]=this.parentDimensions,{_borderLineWidth:l}=T,b=l/r,s=l/d;switch(this.rotation){case 90:return[-b,s];case 180:return[b,s];case 270:return[b,-s];default:return[-b,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(r=this.rotation){const[d,l]=this.pageDimensions;let{x:b,y:s,width:g,height:t}=this;if(g*=d,t*=l,b*=d,s*=l,this._mustFixPosition)switch(r){case 0:b=Math.max(0,Math.min(d-g,b)),s=Math.max(0,Math.min(l-t,s));break;case 90:b=Math.max(0,Math.min(d-t,b)),s=Math.min(l,Math.max(g,s));break;case 180:b=Math.min(d,Math.max(g,b)),s=Math.min(l,Math.max(t,s));break;case 270:b=Math.min(d,Math.max(t,b)),s=Math.max(0,Math.min(l-g,s));break}this.x=b/=d,this.y=s/=l;const[i,c]=this.getBaseTranslation();b+=i,s+=c;const{style:p}=this.div;p.left=`${(100*b).toFixed(2)}%`,p.top=`${(100*s).toFixed(2)}%`,this.moveInDOM()}static#I(r,d,l){switch(l){case 90:return[d,-r];case 180:return[-r,-d];case 270:return[-d,r];default:return[r,d]}}screenToPageTranslation(r,d){return T.#I(r,d,this.parentRotation)}pageTranslationToScreen(r,d){return T.#I(r,d,360-this.parentRotation)}#L(r){switch(r){case 90:{const[d,l]=this.pageDimensions;return[0,-d/l,l/d,0]}case 180:return[-1,0,0,-1];case 270:{const[d,l]=this.pageDimensions;return[0,d/l,-l/d,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:r,pageDimensions:[d,l]}=this,b=d*r,s=l*r;return B.FeatureTest.isCSSRoundSupported?[Math.round(b),Math.round(s)]:[b,s]}setDims(r,d){const[l,b]=this.parentDimensions;this.div.style.width=`${(100*r/l).toFixed(2)}%`,this.#n||(this.div.style.height=`${(100*d/b).toFixed(2)}%`)}fixDims(){const{style:r}=this.div,{height:d,width:l}=r,b=l.endsWith("%"),s=!this.#n&&d.endsWith("%");if(b&&s)return;const[g,t]=this.parentDimensions;b||(r.width=`${(100*parseFloat(l)/g).toFixed(2)}%`),!this.#n&&!s&&(r.height=`${(100*parseFloat(d)/t).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#y(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const r=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(const d of r){const l=document.createElement("div");this.#r.append(l),l.classList.add("resizer",d),l.setAttribute("data-resizer-name",d),l.addEventListener("pointerdown",this.#b.bind(this,d)),l.addEventListener("contextmenu",I.noContextMenu),l.tabIndex=-1}this.div.prepend(this.#r)}#b(r,d){d.preventDefault();const{isMac:l}=B.FeatureTest.platform;if(d.button!==0||d.ctrlKey&&l)return;this.#e?.toggle(!1);const b=this.#E.bind(this,r),s=this._isDraggable;this._isDraggable=!1;const g={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",b,g),window.addEventListener("contextmenu",I.noContextMenu);const t=this.x,i=this.y,c=this.width,p=this.height,y=this.parent.div.style.cursor,S=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(d.target).cursor;const L=()=>{this.parent.togglePointerEvents(!0),this.#e?.toggle(!0),this._isDraggable=s,window.removeEventListener("pointerup",L),window.removeEventListener("blur",L),window.removeEventListener("pointermove",b,g),window.removeEventListener("contextmenu",I.noContextMenu),this.parent.div.style.cursor=y,this.div.style.cursor=S,this.#S(t,i,c,p)};window.addEventListener("pointerup",L),window.addEventListener("blur",L)}#S(r,d,l,b){const s=this.x,g=this.y,t=this.width,i=this.height;s===r&&g===d&&t===l&&i===b||this.addCommands({cmd:()=>{this.width=t,this.height=i,this.x=s,this.y=g;const[c,p]=this.parentDimensions;this.setDims(c*t,p*i),this.fixAndSetPosition()},undo:()=>{this.width=l,this.height=b,this.x=r,this.y=d;const[c,p]=this.parentDimensions;this.setDims(c*l,p*b),this.fixAndSetPosition()},mustExec:!0})}#E(r,d){const[l,b]=this.parentDimensions,s=this.x,g=this.y,t=this.width,i=this.height,c=T.MIN_SIZE/l,p=T.MIN_SIZE/b,y=m=>Math.round(m*1e4)/1e4,S=this.#L(this.rotation),L=(m,h)=>[S[0]*m+S[2]*h,S[1]*m+S[3]*h],M=this.#L(360-this.rotation),O=(m,h)=>[M[0]*m+M[2]*h,M[1]*m+M[3]*h];let _,z,q=!1,nt=!1;switch(r){case"topLeft":q=!0,_=(m,h)=>[0,0],z=(m,h)=>[m,h];break;case"topMiddle":_=(m,h)=>[m/2,0],z=(m,h)=>[m/2,h];break;case"topRight":q=!0,_=(m,h)=>[m,0],z=(m,h)=>[0,h];break;case"middleRight":nt=!0,_=(m,h)=>[m,h/2],z=(m,h)=>[0,h/2];break;case"bottomRight":q=!0,_=(m,h)=>[m,h],z=(m,h)=>[0,0];break;case"bottomMiddle":_=(m,h)=>[m/2,h],z=(m,h)=>[m/2,0];break;case"bottomLeft":q=!0,_=(m,h)=>[0,h],z=(m,h)=>[m,0];break;case"middleLeft":nt=!0,_=(m,h)=>[0,h/2],z=(m,h)=>[m,h/2];break}const j=_(t,i),H=z(t,i);let U=L(...H);const Y=y(s+U[0]),et=y(g+U[1]);let tt=1,ot=1,[ct,pt]=this.screenToPageTranslation(d.movementX,d.movementY);if([ct,pt]=O(ct/l,pt/b),q){const m=Math.hypot(t,i);tt=ot=Math.max(Math.min(Math.hypot(H[0]-j[0]-ct,H[1]-j[1]-pt)/m,1/t,1/i),c/t,p/i)}else nt?tt=Math.max(c,Math.min(1,Math.abs(H[0]-j[0]-ct)))/t:ot=Math.max(p,Math.min(1,Math.abs(H[1]-j[1]-pt)))/i;const dt=y(t*tt),ht=y(i*ot);U=L(...z(dt,ht));const ut=Y-U[0],st=et-U[1];this.width=dt,this.height=ht,this.x=ut,this.y=st,this.setDims(l*dt,b*ht),this.fixAndSetPosition()}altTextFinish(){this.#e?.finish()}async addEditToolbar(){return this.#h||this.#p?this.#h:(this.#h=new P.EditorToolbar(this),this.div.append(this.#h.render()),this.#e&&this.#h.addAltTextButton(await this.#e.render()),this.#h)}removeEditToolbar(){this.#h&&(this.#h.remove(),this.#h=null,this.#e?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#e||(G.initialize(T._l10nPromise),this.#e=new G(this),await this.addEditToolbar())}get altTextData(){return this.#e?.data}set altTextData(r){this.#e&&(this.#e.data=r)}hasAltText(){return!this.#e?.isEmpty()}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#s?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.div.addEventListener("focusin",this.#a),this.div.addEventListener("focusout",this.#l);const[r,d]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*d/r).toFixed(2)}%`,this.div.style.maxHeight=`${(100*r/d).toFixed(2)}%`);const[l,b]=this.getInitialTranslation();return this.translate(l,b),(0,w.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(r){const{isMac:d}=B.FeatureTest.platform;if(r.button!==0||r.ctrlKey&&d){r.preventDefault();return}if(this.#u=!0,this._isDraggable){this.#T(r);return}this.#k(r)}#k(r){const{isMac:d}=B.FeatureTest.platform;r.ctrlKey&&!d||r.shiftKey||r.metaKey&&d?this.parent.toggleSelected(this):this.parent.setSelected(this)}#T(r){const d=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let l,b;d&&(this.div.classList.add("moving"),l={passive:!0,capture:!0},this.#A=r.clientX,this.#m=r.clientY,b=g=>{const{clientX:t,clientY:i}=g,[c,p]=this.screenToPageTranslation(t-this.#A,i-this.#m);this.#A=t,this.#m=i,this._uiManager.dragSelectedEditors(c,p)},window.addEventListener("pointermove",b,l));const s=()=>{window.removeEventListener("pointerup",s),window.removeEventListener("blur",s),d&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",b,l)),this.#u=!1,this._uiManager.endDragSession()||this.#k(r)};window.addEventListener("pointerup",s),window.addEventListener("blur",s)}moveInDOM(){this.#f&&clearTimeout(this.#f),this.#f=setTimeout(()=>{this.#f=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(r,d,l){r.changeParent(this),this.x=d,this.y=l,this.fixAndSetPosition()}getRect(r,d,l=this.rotation){const b=this.parentScale,[s,g]=this.pageDimensions,[t,i]=this.pageTranslation,c=r/b,p=d/b,y=this.x*s,S=this.y*g,L=this.width*s,M=this.height*g;switch(l){case 0:return[y+c+t,g-S-p-M+i,y+c+L+t,g-S-p+i];case 90:return[y+p+t,g-S+c+i,y+p+M+t,g-S+c+L+i];case 180:return[y-c-L+t,g-S+p+i,y-c+t,g-S+p+M+i];case 270:return[y-p-M+t,g-S-c-L+i,y-p+t,g-S-c+i];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(r,d){const[l,b,s,g]=r,t=s-l,i=g-b;switch(this.rotation){case 0:return[l,d-g,t,i];case 90:return[l,d-b,i,t];case 180:return[s,d-b,t,i];case 270:return[s,d-g,i,t];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#p=!0}disableEditMode(){this.#p=!1}isInEditMode(){return this.#p}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#a),this.div?.addEventListener("focusout",this.#l)}rotate(r){}serialize(r=!1,d=null){(0,B.unreachable)("An editor must be serializable")}static deserialize(r,d,l){const b=new this.prototype.constructor({parent:d,id:d.getNextId(),uiManager:l});b.rotation=r.rotation;const[s,g]=b.pageDimensions,[t,i,c,p]=b.getRectInCurrentCoords(r.rect,g);return b.x=t/s,b.y=i/g,b.width=c/s,b.height=p/g,b}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.div.removeEventListener("focusin",this.#a),this.div.removeEventListener("focusout",this.#l),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#f&&(clearTimeout(this.#f),this.#f=null),this.#D(),this.removeEditToolbar(),this.#v){for(const r of this.#v.values())clearTimeout(r);this.#v=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#y(),this.#r.classList.remove("hidden"),(0,w.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(r){if(!this.isResizable||r.target!==this.div||r.key!=="Enter")return;this._uiManager.setSelected(this),this.#i={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const d=this.#r.children;if(!this.#t){this.#t=Array.from(d);const g=this.#M.bind(this),t=this.#F.bind(this);for(const i of this.#t){const c=i.getAttribute("data-resizer-name");i.setAttribute("role","spinbutton"),i.addEventListener("keydown",g),i.addEventListener("blur",t),i.addEventListener("focus",this.#N.bind(this,c)),T._l10nPromise.get(`pdfjs-editor-resizer-label-${c}`).then(p=>i.setAttribute("aria-label",p))}}const l=this.#t[0];let b=0;for(const g of d){if(g===l)break;b++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(s!==b){if(s<b)for(let t=0;t<b-s;t++)this.#r.append(this.#r.firstChild);else if(s>b)for(let t=0;t<s-b;t++)this.#r.firstChild.before(this.#r.lastChild);let g=0;for(const t of d){const c=this.#t[g++].getAttribute("data-resizer-name");T._l10nPromise.get(`pdfjs-editor-resizer-label-${c}`).then(p=>t.setAttribute("aria-label",p))}}this.#P(0),this.#g=!0,this.#r.firstChild.focus({focusVisible:!0}),r.preventDefault(),r.stopImmediatePropagation()}#M(r){T._resizerKeyboardManager.exec(this,r)}#F(r){this.#g&&r.relatedTarget?.parentNode!==this.#r&&this.#D()}#N(r){this.#d=this.#g?r:""}#P(r){if(this.#t)for(const d of this.#t)d.tabIndex=r}_resizeWithKeyboard(r,d){this.#g&&this.#E(this.#d,{movementX:r,movementY:d})}#D(){if(this.#g=!1,this.#P(-1),this.#i){const{savedX:r,savedY:d,savedWidth:l,savedHeight:b}=this.#i;this.#S(r,d,l,b),this.#i=null}}_stopResizingWithKeyboard(){this.#D(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this.#h){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#h?.show()});return}this.#h?.show()}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this.#h?.hide()}updateParams(r,d){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#o}set isEditing(r){this.#o=r,this.parent&&(r?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(r,d){this.#n=!0;const l=r/d,{style:b}=this.div;b.aspectRatio=l,b.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(r,d=!1){if(d){this.#v||=new Map;const{action:l}=r;let b=this.#v.get(l);b&&clearTimeout(b),b=setTimeout(()=>{this._reportTelemetry(r),this.#v.delete(l),this.#v.size===0&&(this.#v=null)},T._telemetryTimeout),this.#v.set(l,b);return}r.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:r}})}show(r=this._isVisible){this.div.classList.toggle("hidden",!r),this._isVisible=r}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}renderAnnotationElement(r){let d=r.container.querySelector(".annotationContent");if(!d)d=document.createElement("div"),d.classList.add("annotationContent",this.editorType),r.container.prepend(d);else if(d.nodeName==="CANVAS"){const l=d;d=document.createElement("div"),d.classList.add("annotationContent",this.editorType),l.before(d)}return d}resetAnnotationElement(r){const{firstChild:d}=r.container;d.nodeName==="DIV"&&d.classList.contains("annotationContent")&&d.remove()}}class x extends T{constructor(r){super(r),this.annotationElementId=r.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},61:(at,Z,V)=>{V.d(Z,{FreeOutliner:()=>P,Outliner:()=>B});var w=V(292);class B{#t;#e=[];#s=[];constructor(v,r=0,d=0,l=!0){let b=1/0,s=-1/0,g=1/0,t=-1/0;const c=10**-4;for(const{x:_,y:z,width:q,height:nt}of v){const j=Math.floor((_-r)/c)*c,H=Math.ceil((_+q+r)/c)*c,U=Math.floor((z-r)/c)*c,Y=Math.ceil((z+nt+r)/c)*c,et=[j,U,Y,!0],tt=[H,U,Y,!1];this.#e.push(et,tt),b=Math.min(b,j),s=Math.max(s,H),g=Math.min(g,U),t=Math.max(t,Y)}const p=s-b+2*d,y=t-g+2*d,S=b-d,L=g-d,M=this.#e.at(l?-1:-2),O=[M[0],M[2]];for(const _ of this.#e){const[z,q,nt]=_;_[0]=(z-S)/p,_[1]=(q-L)/y,_[2]=(nt-L)/y}this.#t={x:S,y:L,width:p,height:y,lastPoint:O}}getOutlines(){this.#e.sort((r,d)=>r[0]-d[0]||r[1]-d[1]||r[2]-d[2]);const v=[];for(const r of this.#e)r[3]?(v.push(...this.#l(r)),this.#i(r)):(this.#a(r),v.push(...this.#l(r)));return this.#n(v)}#n(v){const r=[],d=new Set;for(const s of v){const[g,t,i]=s;r.push([g,t,s],[g,i,s])}r.sort((s,g)=>s[1]-g[1]||s[0]-g[0]);for(let s=0,g=r.length;s<g;s+=2){const t=r[s][2],i=r[s+1][2];t.push(i),i.push(t),d.add(t),d.add(i)}const l=[];let b;for(;d.size>0;){const s=d.values().next().value;let[g,t,i,c,p]=s;d.delete(s);let y=g,S=t;for(b=[g,i],l.push(b);;){let L;if(d.has(c))L=c;else if(d.has(p))L=p;else break;d.delete(L),[g,t,i,c,p]=L,y!==g&&(b.push(y,S,g,S===t?t:i),y=g),S=S===t?i:t}b.push(y,S)}return new G(l,this.#t)}#r(v){const r=this.#s;let d=0,l=r.length-1;for(;d<=l;){const b=d+l>>1,s=r[b][0];if(s===v)return b;s<v?d=b+1:l=b-1}return l+1}#i([,v,r]){const d=this.#r(v);this.#s.splice(d,0,[v,r])}#a([,v,r]){const d=this.#r(v);for(let l=d;l<this.#s.length;l++){const[b,s]=this.#s[l];if(b!==v)break;if(b===v&&s===r){this.#s.splice(l,1);return}}for(let l=d-1;l>=0;l--){const[b,s]=this.#s[l];if(b!==v)break;if(b===v&&s===r){this.#s.splice(l,1);return}}}#l(v){const[r,d,l]=v,b=[[r,d,l]],s=this.#r(l);for(let g=0;g<s;g++){const[t,i]=this.#s[g];for(let c=0,p=b.length;c<p;c++){const[,y,S]=b[c];if(!(i<=y||S<=t)){if(y>=t){if(S>i)b[c][1]=i;else{if(p===1)return[];b.splice(c,1),c--,p--}continue}b[c][2]=t,S>i&&b.push([r,i,S])}}}return b}}class I{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(v,r){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof T}}class G extends I{#t;#e;constructor(v,r){super(),this.#e=v,this.#t=r}toSVGPath(){const v=[];for(const r of this.#e){let[d,l]=r;v.push(`M${d} ${l}`);for(let b=2;b<r.length;b+=2){const s=r[b],g=r[b+1];s===d?(v.push(`V${g}`),l=g):g===l&&(v.push(`H${s}`),d=s)}v.push("Z")}return v.join(" ")}serialize([v,r,d,l],b){const s=[],g=d-v,t=l-r;for(const i of this.#e){const c=new Array(i.length);for(let p=0;p<i.length;p+=2)c[p]=v+i[p]*g,c[p+1]=l-i[p+1]*t;s.push(c)}return s}get box(){return this.#t}}class P{#t;#e=[];#s;#n;#r=[];#i=new Float64Array(18);#a;#l;#h;#d;#u;#c;#o=[];static#p=8;static#g=2;static#f=P.#p+P.#g;constructor({x:v,y:r},d,l,b,s,g=0){this.#t=d,this.#c=b*l,this.#n=s,this.#i.set([NaN,NaN,NaN,NaN,v,r],6),this.#s=g,this.#d=P.#p*l,this.#h=P.#f*l,this.#u=l,this.#o.push(v,r)}get free(){return!0}isEmpty(){return isNaN(this.#i[8])}#A(){const v=this.#i.subarray(4,6),r=this.#i.subarray(16,18),[d,l,b,s]=this.#t;return[(this.#a+(v[0]-r[0])/2-d)/b,(this.#l+(v[1]-r[1])/2-l)/s,(this.#a+(r[0]-v[0])/2-d)/b,(this.#l+(r[1]-v[1])/2-l)/s]}add({x:v,y:r}){this.#a=v,this.#l=r;const[d,l,b,s]=this.#t;let[g,t,i,c]=this.#i.subarray(8,12);const p=v-i,y=r-c,S=Math.hypot(p,y);if(S<this.#h)return!1;const L=S-this.#d,M=L/S,O=M*p,_=M*y;let z=g,q=t;g=i,t=c,i+=O,c+=_,this.#o?.push(v,r);const nt=-_/L,j=O/L,H=nt*this.#c,U=j*this.#c;return this.#i.set(this.#i.subarray(2,8),0),this.#i.set([i+H,c+U],4),this.#i.set(this.#i.subarray(14,18),12),this.#i.set([i-H,c-U],16),isNaN(this.#i[6])?(this.#r.length===0&&(this.#i.set([g+H,t+U],2),this.#r.push(NaN,NaN,NaN,NaN,(g+H-d)/b,(t+U-l)/s),this.#i.set([g-H,t-U],14),this.#e.push(NaN,NaN,NaN,NaN,(g-H-d)/b,(t-U-l)/s)),this.#i.set([z,q,g,t,i,c],6),!this.isEmpty()):(this.#i.set([z,q,g,t,i,c],6),Math.abs(Math.atan2(q-t,z-g)-Math.atan2(_,O))<Math.PI/2?([g,t,i,c]=this.#i.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((g+i)/2-d)/b,((t+c)/2-l)/s),[g,t,z,q]=this.#i.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((z+g)/2-d)/b,((q+t)/2-l)/s),!0):([z,q,g,t,i,c]=this.#i.subarray(0,6),this.#r.push(((z+5*g)/6-d)/b,((q+5*t)/6-l)/s,((5*g+i)/6-d)/b,((5*t+c)/6-l)/s,((g+i)/2-d)/b,((t+c)/2-l)/s),[i,c,g,t,z,q]=this.#i.subarray(12,18),this.#e.push(((z+5*g)/6-d)/b,((q+5*t)/6-l)/s,((5*g+i)/6-d)/b,((5*t+c)/6-l)/s,((g+i)/2-d)/b,((t+c)/2-l)/s),!0))}toSVGPath(){if(this.isEmpty())return"";const v=this.#r,r=this.#e,d=this.#i.subarray(4,6),l=this.#i.subarray(16,18),[b,s,g,t]=this.#t,[i,c,p,y]=this.#A();if(isNaN(this.#i[6])&&!this.isEmpty())return`M${(this.#i[2]-b)/g} ${(this.#i[3]-s)/t} L${(this.#i[4]-b)/g} ${(this.#i[5]-s)/t} L${i} ${c} L${p} ${y} L${(this.#i[16]-b)/g} ${(this.#i[17]-s)/t} L${(this.#i[14]-b)/g} ${(this.#i[15]-s)/t} Z`;const S=[];S.push(`M${v[4]} ${v[5]}`);for(let L=6;L<v.length;L+=6)isNaN(v[L])?S.push(`L${v[L+4]} ${v[L+5]}`):S.push(`C${v[L]} ${v[L+1]} ${v[L+2]} ${v[L+3]} ${v[L+4]} ${v[L+5]}`);S.push(`L${(d[0]-b)/g} ${(d[1]-s)/t} L${i} ${c} L${p} ${y} L${(l[0]-b)/g} ${(l[1]-s)/t}`);for(let L=r.length-6;L>=6;L-=6)isNaN(r[L])?S.push(`L${r[L+4]} ${r[L+5]}`):S.push(`C${r[L]} ${r[L+1]} ${r[L+2]} ${r[L+3]} ${r[L+4]} ${r[L+5]}`);return S.push(`L${r[4]} ${r[5]} Z`),S.join(" ")}getOutlines(){const v=this.#r,r=this.#e,d=this.#i,l=d.subarray(4,6),b=d.subarray(16,18),[s,g,t,i]=this.#t,c=new Float64Array((this.#o?.length??0)+2);for(let _=0,z=c.length-2;_<z;_+=2)c[_]=(this.#o[_]-s)/t,c[_+1]=(this.#o[_+1]-g)/i;c[c.length-2]=(this.#a-s)/t,c[c.length-1]=(this.#l-g)/i;const[p,y,S,L]=this.#A();if(isNaN(d[6])&&!this.isEmpty()){const _=new Float64Array(36);return _.set([NaN,NaN,NaN,NaN,(d[2]-s)/t,(d[3]-g)/i,NaN,NaN,NaN,NaN,(d[4]-s)/t,(d[5]-g)/i,NaN,NaN,NaN,NaN,p,y,NaN,NaN,NaN,NaN,S,L,NaN,NaN,NaN,NaN,(d[16]-s)/t,(d[17]-g)/i,NaN,NaN,NaN,NaN,(d[14]-s)/t,(d[15]-g)/i],0),new T(_,c,this.#t,this.#u,this.#s,this.#n)}const M=new Float64Array(this.#r.length+24+this.#e.length);let O=v.length;for(let _=0;_<O;_+=2){if(isNaN(v[_])){M[_]=M[_+1]=NaN;continue}M[_]=v[_],M[_+1]=v[_+1]}M.set([NaN,NaN,NaN,NaN,(l[0]-s)/t,(l[1]-g)/i,NaN,NaN,NaN,NaN,p,y,NaN,NaN,NaN,NaN,S,L,NaN,NaN,NaN,NaN,(b[0]-s)/t,(b[1]-g)/i],O),O+=24;for(let _=r.length-6;_>=6;_-=6)for(let z=0;z<6;z+=2){if(isNaN(r[_+z])){M[O]=M[O+1]=NaN,O+=2;continue}M[O]=r[_+z],M[O+1]=r[_+z+1],O+=2}return M.set([NaN,NaN,NaN,NaN,r[4],r[5]],O),new T(M,c,this.#t,this.#u,this.#s,this.#n)}}class T extends I{#t;#e=null;#s;#n;#r;#i;#a;constructor(v,r,d,l,b,s){super(),this.#a=v,this.#r=r,this.#t=d,this.#i=l,this.#s=b,this.#n=s,this.#d(s);const{x:g,y:t,width:i,height:c}=this.#e;for(let p=0,y=v.length;p<y;p+=2)v[p]=(v[p]-g)/i,v[p+1]=(v[p+1]-t)/c;for(let p=0,y=r.length;p<y;p+=2)r[p]=(r[p]-g)/i,r[p+1]=(r[p+1]-t)/c}toSVGPath(){const v=[`M${this.#a[4]} ${this.#a[5]}`];for(let r=6,d=this.#a.length;r<d;r+=6){if(isNaN(this.#a[r])){v.push(`L${this.#a[r+4]} ${this.#a[r+5]}`);continue}v.push(`C${this.#a[r]} ${this.#a[r+1]} ${this.#a[r+2]} ${this.#a[r+3]} ${this.#a[r+4]} ${this.#a[r+5]}`)}return v.push("Z"),v.join(" ")}serialize([v,r,d,l],b){const s=d-v,g=l-r;let t,i;switch(b){case 0:t=this.#l(this.#a,v,l,s,-g),i=this.#l(this.#r,v,l,s,-g);break;case 90:t=this.#h(this.#a,v,r,s,g),i=this.#h(this.#r,v,r,s,g);break;case 180:t=this.#l(this.#a,d,r,-s,g),i=this.#l(this.#r,d,r,-s,g);break;case 270:t=this.#h(this.#a,d,l,-s,-g),i=this.#h(this.#r,d,l,-s,-g);break}return{outline:Array.from(t),points:[Array.from(i)]}}#l(v,r,d,l,b){const s=new Float64Array(v.length);for(let g=0,t=v.length;g<t;g+=2)s[g]=r+v[g]*l,s[g+1]=d+v[g+1]*b;return s}#h(v,r,d,l,b){const s=new Float64Array(v.length);for(let g=0,t=v.length;g<t;g+=2)s[g]=r+v[g+1]*l,s[g+1]=d+v[g]*b;return s}#d(v){const r=this.#a;let d=r[4],l=r[5],b=d,s=l,g=d,t=l,i=d,c=l;const p=v?Math.max:Math.min;for(let O=6,_=r.length;O<_;O+=6){if(isNaN(r[O]))b=Math.min(b,r[O+4]),s=Math.min(s,r[O+5]),g=Math.max(g,r[O+4]),t=Math.max(t,r[O+5]),c<r[O+5]?(i=r[O+4],c=r[O+5]):c===r[O+5]&&(i=p(i,r[O+4]));else{const z=w.Util.bezierBoundingBox(d,l,...r.slice(O,O+6));b=Math.min(b,z[0]),s=Math.min(s,z[1]),g=Math.max(g,z[2]),t=Math.max(t,z[3]),c<z[3]?(i=z[2],c=z[3]):c===z[3]&&(i=p(i,z[2]))}d=r[O+4],l=r[O+5]}const y=b-this.#s,S=s-this.#s,L=g-b+2*this.#s,M=t-s+2*this.#s;this.#e={x:y,y:S,width:L,height:M,lastPoint:[i,c]}}get box(){return this.#e}getNewOutline(v,r){const{x:d,y:l,width:b,height:s}=this.#e,[g,t,i,c]=this.#t,p=b*i,y=s*c,S=d*i+g,L=l*c+t,M=new P({x:this.#r[0]*p+S,y:this.#r[1]*y+L},this.#t,this.#i,v,this.#n,r??this.#s);for(let O=2;O<this.#r.length;O+=2)M.add({x:this.#r[O]*p+S,y:this.#r[O+1]*y+L});return M.getOutlines()}}},362:(at,Z,V)=>{V.d(Z,{EditorToolbar:()=>B,HighlightToolbar:()=>I});var w=V(419);class B{#t=null;#e=null;#s;#n=null;constructor(P){this.#s=P}render(){const P=this.#t=document.createElement("div");P.className="editToolbar",P.setAttribute("role","toolbar"),P.addEventListener("contextmenu",w.noContextMenu),P.addEventListener("pointerdown",B.#r);const T=this.#n=document.createElement("div");T.className="buttons",P.append(T);const x=this.#s.toolbarPosition;if(x){const{style:v}=P,r=this.#s._uiManager.direction==="ltr"?1-x[0]:x[0];v.insetInlineEnd=`${100*r}%`,v.top=`calc(${100*x[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),P}static#r(P){P.stopPropagation()}#i(P){this.#s._focusEventsAllowed=!1,P.preventDefault(),P.stopPropagation()}#a(P){this.#s._focusEventsAllowed=!0,P.preventDefault(),P.stopPropagation()}#l(P){P.addEventListener("focusin",this.#i.bind(this),{capture:!0}),P.addEventListener("focusout",this.#a.bind(this),{capture:!0}),P.addEventListener("contextmenu",w.noContextMenu)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden")}#h(){const P=document.createElement("button");P.className="delete",P.tabIndex=0,P.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#s.editorType}-button`),this.#l(P),P.addEventListener("click",T=>{this.#s._uiManager.delete()}),this.#n.append(P)}get#d(){const P=document.createElement("div");return P.className="divider",P}addAltTextButton(P){this.#l(P),this.#n.prepend(P,this.#d)}addColorPicker(P){this.#e=P;const T=P.renderButton();this.#l(T),this.#n.prepend(T,this.#d)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class I{#t=null;#e=null;#s;constructor(P){this.#s=P}#n(){const P=this.#e=document.createElement("div");P.className="editToolbar",P.setAttribute("role","toolbar"),P.addEventListener("contextmenu",w.noContextMenu);const T=this.#t=document.createElement("div");return T.className="buttons",P.append(T),this.#i(),P}#r(P,T){let x=0,v=0;for(const r of P){const d=r.y+r.height;if(d<x)continue;const l=r.x+(T?r.width:0);if(d>x){v=l,x=d;continue}T?l>v&&(v=l):l<v&&(v=l)}return[T?1-v:v,x]}show(P,T,x){const[v,r]=this.#r(T,x),{style:d}=this.#e||=this.#n();P.append(this.#e),d.insetInlineEnd=`${100*v}%`,d.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#i(){const P=document.createElement("button");P.className="highlightButton",P.tabIndex=0,P.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const T=document.createElement("span");P.append(T),T.className="visuallyHidden",T.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label"),P.addEventListener("contextmenu",w.noContextMenu),P.addEventListener("click",()=>{this.#s.highlightSelection("floating_button")}),this.#t.append(P)}}},830:(at,Z,V)=>{V.d(Z,{AnnotationEditorUIManager:()=>l,ColorManager:()=>d,KeyboardManager:()=>r,bindEvents:()=>G,opacityToHex:()=>P});var w=V(292),B=V(419),I=V(362);function G(b,s,g){for(const t of g)s.addEventListener(t,b[t].bind(b))}function P(b){return Math.round(Math.min(255,Math.max(1,255*b))).toString(16).padStart(2,"0")}class T{#t=0;constructor(){}get id(){return`${w.AnnotationEditorPrefix}${this.#t++}`}}class x{#t=(0,w.getUuid)();#e=0;#s=null;static get _isSVGFittingCanvas(){const s='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',t=new OffscreenCanvas(1,3).getContext("2d"),i=new Image;i.src=s;const c=i.decode().then(()=>(t.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,w.shadow)(this,"_isSVGFittingCanvas",c)}async#n(s,g){this.#s||=new Map;let t=this.#s.get(s);if(t===null)return null;if(t?.bitmap)return t.refCounter+=1,t;try{t||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof g=="string"?(t.url=g,i=await(0,B.fetchData)(g,"blob")):i=t.file=g,i.type==="image/svg+xml"){const c=x._isSVGFittingCanvas,p=new FileReader,y=new Image,S=new Promise((L,M)=>{y.onload=()=>{t.bitmap=y,t.isSvg=!0,L()},p.onload=async()=>{const O=t.svgUrl=p.result;y.src=await c?`${O}#svgView(preserveAspectRatio(none))`:O},y.onerror=p.onerror=M});p.readAsDataURL(i),await S}else t.bitmap=await createImageBitmap(i);t.refCounter=1}catch(i){console.error(i),t=null}return this.#s.set(s,t),t&&this.#s.set(t.id,t),t}async getFromFile(s){const{lastModified:g,name:t,size:i,type:c}=s;return this.#n(`${g}_${t}_${i}_${c}`,s)}async getFromUrl(s){return this.#n(s,s)}async getFromId(s){this.#s||=new Map;const g=this.#s.get(s);return g?g.bitmap?(g.refCounter+=1,g):g.file?this.getFromFile(g.file):this.getFromUrl(g.url):null}getSvgUrl(s){const g=this.#s.get(s);return g?.isSvg?g.svgUrl:null}deleteId(s){this.#s||=new Map;const g=this.#s.get(s);g&&(g.refCounter-=1,g.refCounter===0&&(g.bitmap=null))}isValidId(s){return s.startsWith(`image_${this.#t}_`)}}class v{#t=[];#e=!1;#s;#n=-1;constructor(s=128){this.#s=s}add({cmd:s,undo:g,post:t,mustExec:i,type:c=NaN,overwriteIfSameType:p=!1,keepUndo:y=!1}){if(i&&s(),this.#e)return;const S={cmd:s,undo:g,post:t,type:c};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(S);return}if(p&&this.#t[this.#n].type===c){y&&(S.undo=this.#t[this.#n].undo),this.#t[this.#n]=S;return}const L=this.#n+1;L===this.#s?this.#t.splice(0,1):(this.#n=L,L<this.#t.length&&this.#t.splice(L)),this.#t.push(S)}undo(){if(this.#n===-1)return;this.#e=!0;const{undo:s,post:g}=this.#t[this.#n];s(),g?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:s,post:g}=this.#t[this.#n];s(),g?.(),this.#e=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}destroy(){this.#t=null}}class r{constructor(s){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:g}=w.FeatureTest.platform;for(const[t,i,c={}]of s)for(const p of t){const y=p.startsWith("mac+");g&&y?(this.callbacks.set(p.slice(4),{callback:i,options:c}),this.allKeys.add(p.split("+").at(-1))):!g&&!y&&(this.callbacks.set(p,{callback:i,options:c}),this.allKeys.add(p.split("+").at(-1)))}}#t(s){s.altKey&&this.buffer.push("alt"),s.ctrlKey&&this.buffer.push("ctrl"),s.metaKey&&this.buffer.push("meta"),s.shiftKey&&this.buffer.push("shift"),this.buffer.push(s.key);const g=this.buffer.join("+");return this.buffer.length=0,g}exec(s,g){if(!this.allKeys.has(g.key))return;const t=this.callbacks.get(this.#t(g));if(!t)return;const{callback:i,options:{bubbles:c=!1,args:p=[],checker:y=null}}=t;y&&!y(s,g)||(i.bind(s,...p,g)(),c||(g.stopPropagation(),g.preventDefault()))}}class d{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const s=new Map([["CanvasText",null],["Canvas",null]]);return(0,B.getColorValues)(s),(0,w.shadow)(this,"_colors",s)}convert(s){const g=(0,B.getRGB)(s);if(!window.matchMedia("(forced-colors: active)").matches)return g;for(const[t,i]of this._colors)if(i.every((c,p)=>c===g[p]))return d._colorsMapping.get(t);return g}getHexCode(s){const g=this._colors.get(s);return g?w.Util.makeHexColor(...g):s}}class l{#t=null;#e=new Map;#s=new Map;#n=null;#r=null;#i=null;#a=new v;#l=0;#h=new Set;#d=null;#u=null;#c=new Set;#o=!1;#p=null;#g=null;#f=null;#A=!1;#m=null;#v=new T;#w=!1;#C=!1;#R=null;#I=null;#L=null;#y=w.AnnotationEditorType.NONE;#b=new Set;#S=null;#E=null;#k=null;#T=this.blur.bind(this);#M=this.focus.bind(this);#F=this.copy.bind(this);#N=this.cut.bind(this);#P=this.paste.bind(this);#D=this.keydown.bind(this);#U=this.keyup.bind(this);#$=this.onEditingAction.bind(this);#X=this.onPageChanging.bind(this);#G=this.onScaleChanging.bind(this);#B=this.#rt.bind(this);#_=this.onRotationChanging.bind(this);#q={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#V=[0,0];#O=null;#z=null;#K=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const s=l.prototype,g=p=>p.#z.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&p.hasSomethingToControl(),t=(p,{target:y})=>{if(y instanceof HTMLInputElement){const{type:S}=y;return S!=="text"&&S!=="number"}return!0},i=this.TRANSLATE_SMALL,c=this.TRANSLATE_BIG;return(0,w.shadow)(this,"_keyboardManager",new r([[["ctrl+a","mac+meta+a"],s.selectAll,{checker:t}],[["ctrl+z","mac+meta+z"],s.undo,{checker:t}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],s.redo,{checker:t}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],s.delete,{checker:t}],[["Enter","mac+Enter"],s.addNewEditorFromKeyboard,{checker:(p,{target:y})=>!(y instanceof HTMLButtonElement)&&p.#z.contains(y)&&!p.isEnterHandled}],[[" ","mac+ "],s.addNewEditorFromKeyboard,{checker:(p,{target:y})=>!(y instanceof HTMLButtonElement)&&p.#z.contains(document.activeElement)}],[["Escape","mac+Escape"],s.unselectAll],[["ArrowLeft","mac+ArrowLeft"],s.translateSelectedEditors,{args:[-i,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],s.translateSelectedEditors,{args:[-c,0],checker:g}],[["ArrowRight","mac+ArrowRight"],s.translateSelectedEditors,{args:[i,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],s.translateSelectedEditors,{args:[c,0],checker:g}],[["ArrowUp","mac+ArrowUp"],s.translateSelectedEditors,{args:[0,-i],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],s.translateSelectedEditors,{args:[0,-c],checker:g}],[["ArrowDown","mac+ArrowDown"],s.translateSelectedEditors,{args:[0,i],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],s.translateSelectedEditors,{args:[0,c],checker:g}]]))}constructor(s,g,t,i,c,p,y,S,L){this.#z=s,this.#K=g,this.#n=t,this._eventBus=i,this._eventBus._on("editingaction",this.#$),this._eventBus._on("pagechanging",this.#X),this._eventBus._on("scalechanging",this.#G),this._eventBus._on("rotationchanging",this.#_),this.#at(),this.#J(),this.#r=c.annotationStorage,this.#p=c.filterFactory,this.#E=p,this.#f=y||null,this.#o=S,this.#L=L||null,this.viewParameters={realScale:B.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#Z(),this.#Q(),this._eventBus._off("editingaction",this.#$),this._eventBus._off("pagechanging",this.#X),this._eventBus._off("scalechanging",this.#G),this._eventBus._off("rotationchanging",this.#_);for(const s of this.#s.values())s.destroy();this.#s.clear(),this.#e.clear(),this.#c.clear(),this.#t=null,this.#b.clear(),this.#a.destroy(),this.#n?.destroy(),this.#m?.hide(),this.#m=null,this.#g&&(clearTimeout(this.#g),this.#g=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this.#ot()}async mlGuess(s){return this.#L?.guess(s)||null}get hasMLManager(){return!!this.#L}get hcmFilter(){return(0,w.shadow)(this,"hcmFilter",this.#E?this.#p.addHCMFilter(this.#E.foreground,this.#E.background):"none")}get direction(){return(0,w.shadow)(this,"direction",getComputedStyle(this.#z).direction)}get highlightColors(){return(0,w.shadow)(this,"highlightColors",this.#f?new Map(this.#f.split(",").map(s=>s.split("=").map(g=>g.trim()))):null)}get highlightColorNames(){return(0,w.shadow)(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,s=>s.reverse())):null)}setMainHighlightColorPicker(s){this.#I=s}editAltText(s){this.#n?.editAltText(this,s)}onPageChanging({pageNumber:s}){this.#l=s-1}focusMainContainer(){this.#z.focus()}findParent(s,g){for(const t of this.#s.values()){const{x:i,y:c,width:p,height:y}=t.div.getBoundingClientRect();if(s>=i&&s<=i+p&&g>=c&&g<=c+y)return t}return null}disableUserSelect(s=!1){this.#K.classList.toggle("noUserSelect",s)}addShouldRescale(s){this.#c.add(s)}removeShouldRescale(s){this.#c.delete(s)}onScaleChanging({scale:s}){this.commitOrRemove(),this.viewParameters.realScale=s*B.PixelsPerInch.PDF_TO_CSS_UNITS;for(const g of this.#c)g.onScaleChanging()}onRotationChanging({pagesRotation:s}){this.commitOrRemove(),this.viewParameters.rotation=s}#Y({anchorNode:s}){return s.nodeType===Node.TEXT_NODE?s.parentElement:s}highlightSelection(s=""){const g=document.getSelection();if(!g||g.isCollapsed)return;const{anchorNode:t,anchorOffset:i,focusNode:c,focusOffset:p}=g,y=g.toString(),L=this.#Y(g).closest(".textLayer"),M=this.getSelectionBoxes(L);if(M){g.empty(),this.#y===w.AnnotationEditorType.NONE&&(this._eventBus.dispatch("showannotationeditorui",{source:this,mode:w.AnnotationEditorType.HIGHLIGHT}),this.showAllEditors("highlight",!0,!0));for(const O of this.#s.values())if(O.hasTextLayer(L)){O.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:s,boxes:M,anchorNode:t,anchorOffset:i,focusNode:c,focusOffset:p,text:y});break}}}#nt(){const s=document.getSelection();if(!s||s.isCollapsed)return;const t=this.#Y(s).closest(".textLayer"),i=this.getSelectionBoxes(t);i&&(this.#m||=new I.HighlightToolbar(this),this.#m.show(t,i,this.direction==="ltr"))}addToAnnotationStorage(s){!s.isEmpty()&&this.#r&&!this.#r.has(s.id)&&this.#r.setValue(s.id,s)}#rt(){const s=document.getSelection();if(!s||s.isCollapsed){this.#S&&(this.#m?.hide(),this.#S=null,this.#x({hasSelectedText:!1}));return}const{anchorNode:g}=s;if(g===this.#S)return;if(!this.#Y(s).closest(".textLayer")){this.#S&&(this.#m?.hide(),this.#S=null,this.#x({hasSelectedText:!1}));return}if(this.#m?.hide(),this.#S=g,this.#x({hasSelectedText:!0}),!(this.#y!==w.AnnotationEditorType.HIGHLIGHT&&this.#y!==w.AnnotationEditorType.NONE)&&(this.#y===w.AnnotationEditorType.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#A=this.isShiftKeyDown,!this.isShiftKeyDown)){const c=p=>{p.type==="pointerup"&&p.button!==0||(window.removeEventListener("pointerup",c),window.removeEventListener("blur",c),p.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",c),window.addEventListener("blur",c)}}#W(s=""){this.#y===w.AnnotationEditorType.HIGHLIGHT?this.highlightSelection(s):this.#o&&this.#nt()}#at(){document.addEventListener("selectionchange",this.#B)}#ot(){document.removeEventListener("selectionchange",this.#B)}#ht(){window.addEventListener("focus",this.#M),window.addEventListener("blur",this.#T)}#Q(){window.removeEventListener("focus",this.#M),window.removeEventListener("blur",this.#T)}blur(){if(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#W("main_toolbar")),!this.hasSelection)return;const{activeElement:s}=document;for(const g of this.#b)if(g.div.contains(s)){this.#R=[g,s],g._focusEventsAllowed=!1;break}}focus(){if(!this.#R)return;const[s,g]=this.#R;this.#R=null,g.addEventListener("focusin",()=>{s._focusEventsAllowed=!0},{once:!0}),g.focus()}#J(){window.addEventListener("keydown",this.#D),window.addEventListener("keyup",this.#U)}#Z(){window.removeEventListener("keydown",this.#D),window.removeEventListener("keyup",this.#U)}#tt(){document.addEventListener("copy",this.#F),document.addEventListener("cut",this.#N),document.addEventListener("paste",this.#P)}#et(){document.removeEventListener("copy",this.#F),document.removeEventListener("cut",this.#N),document.removeEventListener("paste",this.#P)}addEditListeners(){this.#J(),this.#tt()}removeEditListeners(){this.#Z(),this.#et()}copy(s){if(s.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const g=[];for(const t of this.#b){const i=t.serialize(!0);i&&g.push(i)}g.length!==0&&s.clipboardData.setData("application/pdfjs",JSON.stringify(g))}cut(s){this.copy(s),this.delete()}paste(s){s.preventDefault();const{clipboardData:g}=s;for(const c of g.items)for(const p of this.#u)if(p.isHandlingMimeForPasting(c.type)){p.paste(c,this.currentLayer);return}let t=g.getData("application/pdfjs");if(!t)return;try{t=JSON.parse(t)}catch(c){(0,w.warn)(`paste: "${c.message}".`);return}if(!Array.isArray(t))return;this.unselectAll();const i=this.currentLayer;try{const c=[];for(const S of t){const L=i.deserialize(S);if(!L)return;c.push(L)}const p=()=>{for(const S of c)this.#st(S);this.#it(c)},y=()=>{for(const S of c)S.remove()};this.addCommands({cmd:p,undo:y,mustExec:!0})}catch(c){(0,w.warn)(`paste: "${c.message}".`)}}keydown(s){!this.isShiftKeyDown&&s.key==="Shift"&&(this.isShiftKeyDown=!0),this.#y!==w.AnnotationEditorType.NONE&&!this.isEditorHandlingKeyboard&&l._keyboardManager.exec(this,s)}keyup(s){this.isShiftKeyDown&&s.key==="Shift"&&(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#W("main_toolbar")))}onEditingAction({name:s}){switch(s){case"undo":case"redo":case"delete":case"selectAll":this[s]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#x(s){Object.entries(s).some(([t,i])=>this.#q[t]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#q,s)}),this.#y===w.AnnotationEditorType.HIGHLIGHT&&s.hasSelectedEditor===!1&&this.#H([[w.AnnotationEditorParamsType.HIGHLIGHT_FREE,!0]]))}#H(s){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:s})}setEditingState(s){s?(this.#ht(),this.#tt(),this.#x({isEditing:this.#y!==w.AnnotationEditorType.NONE,isEmpty:this.#j(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#Q(),this.#et(),this.#x({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(s){if(!this.#u){this.#u=s;for(const g of this.#u)this.#H(g.defaultPropertiesToUpdate)}}getId(){return this.#v.id}get currentLayer(){return this.#s.get(this.#l)}getLayer(s){return this.#s.get(s)}get currentPageIndex(){return this.#l}addLayer(s){this.#s.set(s.pageIndex,s),this.#w?s.enable():s.disable()}removeLayer(s){this.#s.delete(s.pageIndex)}updateMode(s,g=null,t=!1){if(this.#y!==s){if(this.#y=s,s===w.AnnotationEditorType.NONE){this.setEditingState(!1),this.#ct();return}this.setEditingState(!0),this.#lt(),this.unselectAll();for(const i of this.#s.values())i.updateMode(s);if(!g&&t){this.addNewEditorFromKeyboard();return}if(g){for(const i of this.#e.values())if(i.annotationElementId===g){this.setSelected(i),i.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(s){s!==this.#y&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:s})}updateParams(s,g){if(this.#u){switch(s){case w.AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case w.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#I?.updateColor(g);break;case w.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#k||=new Map).set(s,g),this.showAllEditors("highlight",g);break}for(const t of this.#b)t.updateParams(s,g);for(const t of this.#u)t.updateDefaultParams(s,g)}}showAllEditors(s,g,t=!1){for(const c of this.#e.values())c.editorType===s&&c.show(g);(this.#k?.get(w.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL)??!0)!==g&&this.#H([[w.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,g]])}enableWaiting(s=!1){if(this.#C!==s){this.#C=s;for(const g of this.#s.values())s?g.disableClick():g.enableClick(),g.div.classList.toggle("waiting",s)}}#lt(){if(!this.#w){this.#w=!0;for(const s of this.#s.values())s.enable();for(const s of this.#e.values())s.enable()}}#ct(){if(this.unselectAll(),this.#w){this.#w=!1;for(const s of this.#s.values())s.disable();for(const s of this.#e.values())s.disable()}}getEditors(s){const g=[];for(const t of this.#e.values())t.pageIndex===s&&g.push(t);return g}getEditor(s){return this.#e.get(s)}addEditor(s){this.#e.set(s.id,s)}removeEditor(s){s.div.contains(document.activeElement)&&(this.#g&&clearTimeout(this.#g),this.#g=setTimeout(()=>{this.focusMainContainer(),this.#g=null},0)),this.#e.delete(s.id),this.unselect(s),(!s.annotationElementId||!this.#h.has(s.annotationElementId))&&this.#r?.remove(s.id)}addDeletedAnnotationElement(s){this.#h.add(s.annotationElementId),this.addChangedExistingAnnotation(s),s.deleted=!0}isDeletedAnnotationElement(s){return this.#h.has(s)}removeDeletedAnnotationElement(s){this.#h.delete(s.annotationElementId),this.removeChangedExistingAnnotation(s),s.deleted=!1}#st(s){const g=this.#s.get(s.pageIndex);g?g.addOrRebuild(s):(this.addEditor(s),this.addToAnnotationStorage(s))}setActiveEditor(s){this.#t!==s&&(this.#t=s,s&&this.#H(s.propertiesToUpdate))}get#dt(){let s=null;for(s of this.#b);return s}updateUI(s){this.#dt===s&&this.#H(s.propertiesToUpdate)}toggleSelected(s){if(this.#b.has(s)){this.#b.delete(s),s.unselect(),this.#x({hasSelectedEditor:this.hasSelection});return}this.#b.add(s),s.select(),this.#H(s.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}setSelected(s){for(const g of this.#b)g!==s&&g.unselect();this.#b.clear(),this.#b.add(s),s.select(),this.#H(s.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}isSelected(s){return this.#b.has(s)}get firstSelectedEditor(){return this.#b.values().next().value}unselect(s){s.unselect(),this.#b.delete(s),this.#x({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#b.size!==0}get isEnterHandled(){return this.#b.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#a.undo(),this.#x({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#j()})}redo(){this.#a.redo(),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#j()})}addCommands(s){this.#a.add(s),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#j()})}#j(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const s of this.#e.values())return s.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const s=[...this.#b],g=()=>{for(const i of s)i.remove()},t=()=>{for(const i of s)this.#st(i)};this.addCommands({cmd:g,undo:t,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#it(s){for(const g of this.#b)g.unselect();this.#b.clear();for(const g of s)g.isEmpty()||(this.#b.add(g),g.select());this.#x({hasSelectedEditor:this.hasSelection})}selectAll(){for(const s of this.#b)s.commit();this.#it(this.#e.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#y!==w.AnnotationEditorType.NONE))&&this.hasSelection){for(const s of this.#b)s.unselect();this.#b.clear(),this.#x({hasSelectedEditor:!1})}}translateSelectedEditors(s,g,t=!1){if(t||this.commitOrRemove(),!this.hasSelection)return;this.#V[0]+=s,this.#V[1]+=g;const[i,c]=this.#V,p=[...this.#b],y=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#V[0]=this.#V[1]=0,this.addCommands({cmd:()=>{for(const S of p)this.#e.has(S.id)&&S.translateInPage(i,c)},undo:()=>{for(const S of p)this.#e.has(S.id)&&S.translateInPage(-i,-c)},mustExec:!1})},y);for(const S of p)S.translateInPage(s,g)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#d=new Map;for(const s of this.#b)this.#d.set(s,{savedX:s.x,savedY:s.y,savedPageIndex:s.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#d)return!1;this.disableUserSelect(!1);const s=this.#d;this.#d=null;let g=!1;for(const[{x:i,y:c,pageIndex:p},y]of s)y.newX=i,y.newY=c,y.newPageIndex=p,g||=i!==y.savedX||c!==y.savedY||p!==y.savedPageIndex;if(!g)return!1;const t=(i,c,p,y)=>{if(this.#e.has(i.id)){const S=this.#s.get(y);S?i._setParentAndPosition(S,c,p):(i.pageIndex=y,i.x=c,i.y=p)}};return this.addCommands({cmd:()=>{for(const[i,{newX:c,newY:p,newPageIndex:y}]of s)t(i,c,p,y)},undo:()=>{for(const[i,{savedX:c,savedY:p,savedPageIndex:y}]of s)t(i,c,p,y)},mustExec:!0}),!0}dragSelectedEditors(s,g){if(this.#d)for(const t of this.#d.keys())t.drag(s,g)}rebuild(s){if(s.parent===null){const g=this.getLayer(s.pageIndex);g?(g.changeParent(s),g.addOrRebuild(s)):(this.addEditor(s),this.addToAnnotationStorage(s),s.rebuild())}else s.parent.addOrRebuild(s)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#b.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(s){return this.#t===s}getActive(){return this.#t}getMode(){return this.#y}get imageManager(){return(0,w.shadow)(this,"imageManager",new x)}getSelectionBoxes(s){if(!s)return null;const g=document.getSelection();for(let L=0,M=g.rangeCount;L<M;L++)if(!s.contains(g.getRangeAt(L).commonAncestorContainer))return null;const{x:t,y:i,width:c,height:p}=s.getBoundingClientRect();let y;switch(s.getAttribute("data-main-rotation")){case"90":y=(L,M,O,_)=>({x:(M-i)/p,y:1-(L+O-t)/c,width:_/p,height:O/c});break;case"180":y=(L,M,O,_)=>({x:1-(L+O-t)/c,y:1-(M+_-i)/p,width:O/c,height:_/p});break;case"270":y=(L,M,O,_)=>({x:1-(M+_-i)/p,y:(L-t)/c,width:_/p,height:O/c});break;default:y=(L,M,O,_)=>({x:(L-t)/c,y:(M-i)/p,width:O/c,height:_/p});break}const S=[];for(let L=0,M=g.rangeCount;L<M;L++){const O=g.getRangeAt(L);if(!O.collapsed)for(const{x:_,y:z,width:q,height:nt}of O.getClientRects())q===0||nt===0||S.push(y(_,z,q,nt))}return S.length===0?null:S}addChangedExistingAnnotation({annotationElementId:s,id:g}){(this.#i||=new Map).set(s,g)}removeChangedExistingAnnotation({annotationElementId:s}){this.#i?.delete(s)}renderAnnotationElement(s){const g=this.#i?.get(s.data.id);if(!g)return;const t=this.#r.getRawValue(g);t&&(this.#y===w.AnnotationEditorType.NONE&&!t.hasBeenModified||t.renderAnnotationElement(s))}}},94:(at,Z,V)=>{V.d(Z,{PDFFetchStream:()=>T});var w=V(292),B=V(490);function I(r,d,l){return{method:"GET",headers:r,signal:l.signal,mode:"cors",credentials:d?"include":"same-origin",redirect:"follow"}}function G(r){const d=new Headers;for(const l in r){const b=r[l];b!==void 0&&d.append(l,b)}return d}function P(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:((0,w.warn)(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class T{constructor(d){this.source=d,this.isHttp=/^https?:/i.test(d.url),this.httpHeaders=this.isHttp&&d.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,w.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new x(this),this._fullRequestReader}getRangeReader(d,l){if(l<=this._progressiveDataLength)return null;const b=new v(this,d,l);return this._rangeRequestReaders.push(b),b}cancelAllRequests(d){this._fullRequestReader?.cancel(d);for(const l of this._rangeRequestReaders.slice(0))l.cancel(d)}}class x{constructor(d){this._stream=d,this._reader=null,this._loaded=0,this._filename=null;const l=d.source;this._withCredentials=l.withCredentials||!1,this._contentLength=l.length,this._headersCapability=Promise.withResolvers(),this._disableRange=l.disableRange||!1,this._rangeChunkSize=l.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!l.disableStream,this._isRangeSupported=!l.disableRange,this._headers=G(this._stream.httpHeaders);const b=l.url;fetch(b,I(this._headers,this._withCredentials,this._abortController)).then(s=>{if(!(0,B.validateResponseStatus)(s.status))throw(0,B.createResponseStatusError)(s.status,b);this._reader=s.body.getReader(),this._headersCapability.resolve();const g=c=>s.headers.get(c),{allowRangeRequests:t,suggestedLength:i}=(0,B.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=t,this._contentLength=i||this._contentLength,this._filename=(0,B.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new w.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:d,done:l}=await this._reader.read();return l?{value:d,done:l}:(this._loaded+=d.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:P(d),done:!1})}cancel(d){this._reader?.cancel(d),this._abortController.abort()}}class v{constructor(d,l,b){this._stream=d,this._reader=null,this._loaded=0;const s=d.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController,this._headers=G(this._stream.httpHeaders),this._headers.append("Range",`bytes=${l}-${b-1}`);const g=s.url;fetch(g,I(this._headers,this._withCredentials,this._abortController)).then(t=>{if(!(0,B.validateResponseStatus)(t.status))throw(0,B.createResponseStatusError)(t.status,g);this._readCapability.resolve(),this._reader=t.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:d,done:l}=await this._reader.read();return l?{value:d,done:l}:(this._loaded+=d.byteLength,this.onProgress?.({loaded:this._loaded}),{value:P(d),done:!1})}cancel(d){this._reader?.cancel(d),this._abortController.abort()}}},10:(at,Z,V)=>{V.d(Z,{FontFaceObject:()=>I,FontLoader:()=>B});var w=V(292);class B{#t=new Set;constructor({ownerDocument:P=globalThis.document,styleElement:T=null}){this._document=P,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(P){this.nativeFontFaces.add(P),this._document.fonts.add(P)}removeNativeFontFace(P){this.nativeFontFaces.delete(P),this._document.fonts.delete(P)}insertRule(P){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const T=this.styleElement.sheet;T.insertRule(P,T.cssRules.length)}clear(){for(const P of this.nativeFontFaces)this._document.fonts.delete(P);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:P,_inspectFont:T}){if(!(!P||this.#t.has(P.loadedName))){if((0,w.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:x,src:v,style:r}=P,d=new FontFace(x,v,r);this.addNativeFontFace(d);try{await d.load(),this.#t.add(x),T?.(P)}catch{(0,w.warn)(`Cannot load system font: ${P.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(d)}return}(0,w.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(P){if(P.attached||P.missingFile&&!P.systemFontInfo)return;if(P.attached=!0,P.systemFontInfo){await this.loadSystemFont(P);return}if(this.isFontLoadingAPISupported){const x=P.createNativeFontFace();if(x){this.addNativeFontFace(x);try{await x.loaded}catch(v){throw(0,w.warn)(`Failed to load font '${x.family}': '${v}'.`),P.disableFontFace=!0,v}}return}const T=P.createFontFaceRule();if(T){if(this.insertRule(T),this.isSyncFontLoadingSupported)return;await new Promise(x=>{const v=this._queueLoadingCallback(x);this._prepareFontLoadEvent(P,v)})}}get isFontLoadingAPISupported(){const P=!!this._document?.fonts;return(0,w.shadow)(this,"isFontLoadingAPISupported",P)}get isSyncFontLoadingSupported(){let P=!1;return(w.isNodeJS||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(P=!0),(0,w.shadow)(this,"isSyncFontLoadingSupported",P)}_queueLoadingCallback(P){function T(){for((0,w.assert)(!v.done,"completeRequest() cannot be called twice."),v.done=!0;x.length>0&&x[0].done;){const r=x.shift();setTimeout(r.callback,0)}}const{loadingRequests:x}=this,v={done:!1,complete:T,callback:P};return x.push(v),v}get _loadTestFont(){const P=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,w.shadow)(this,"_loadTestFont",P)}_prepareFontLoadEvent(P,T){function x(_,z){return _.charCodeAt(z)<<24|_.charCodeAt(z+1)<<16|_.charCodeAt(z+2)<<8|_.charCodeAt(z+3)&255}function v(_,z,q,nt){const j=_.substring(0,z),H=_.substring(z+q);return j+nt+H}let r,d;const l=this._document.createElement("canvas");l.width=1,l.height=1;const b=l.getContext("2d");let s=0;function g(_,z){if(++s>30){(0,w.warn)("Load test font never loaded."),z();return}if(b.font="30px "+_,b.fillText(".",0,20),b.getImageData(0,0,1,1).data[3]>0){z();return}setTimeout(g.bind(null,_,z))}const t=`lt${Date.now()}${this.loadTestFontId++}`;let i=this._loadTestFont;i=v(i,976,t.length,t);const p=16,y=1482184792;let S=x(i,p);for(r=0,d=t.length-3;r<d;r+=4)S=S-y+x(t,r)|0;r<t.length&&(S=S-y+x(t+"XXX",r)|0),i=v(i,p,4,(0,w.string32)(S));const L=`url(data:font/opentype;base64,${btoa(i)});`,M=`@font-face {font-family:"${t}";src:${L}}`;this.insertRule(M);const O=this._document.createElement("div");O.style.visibility="hidden",O.style.width=O.style.height="10px",O.style.position="absolute",O.style.top=O.style.left="0px";for(const _ of[P.loadedName,t]){const z=this._document.createElement("span");z.textContent="Hi",z.style.fontFamily=_,O.append(z)}this._document.body.append(O),g(t,()=>{O.remove(),T.complete()})}}class I{constructor(P,{disableFontFace:T=!1,ignoreErrors:x=!1,inspectFont:v=null}){this.compiledGlyphs=Object.create(null);for(const r in P)this[r]=P[r];this.disableFontFace=T===!0,this.ignoreErrors=x===!0,this._inspectFont=v}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let P;if(!this.cssFontInfo)P=new FontFace(this.loadedName,this.data,{});else{const T={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(T.style=`oblique ${this.cssFontInfo.italicAngle}deg`),P=new FontFace(this.cssFontInfo.fontFamily,this.data,T)}return this._inspectFont?.(this),P}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const P=(0,w.bytesToString)(this.data),T=`url(data:${this.mimetype};base64,${btoa(P)});`;let x;if(!this.cssFontInfo)x=`@font-face {font-family:"${this.loadedName}";src:${T}}`;else{let v=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(v+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),x=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${v}src:${T}}`}return this._inspectFont?.(this,T),x}getPathGenerator(P,T){if(this.compiledGlyphs[T]!==void 0)return this.compiledGlyphs[T];let x;try{x=P.get(this.loadedName+"_path_"+T)}catch(r){if(!this.ignoreErrors)throw r;(0,w.warn)(`getPathGenerator - ignoring character: "${r}".`)}if(!Array.isArray(x)||x.length===0)return this.compiledGlyphs[T]=function(r,d){};const v=[];for(let r=0,d=x.length;r<d;)switch(x[r++]){case w.FontRenderOps.BEZIER_CURVE_TO:{const[l,b,s,g,t,i]=x.slice(r,r+6);v.push(c=>c.bezierCurveTo(l,b,s,g,t,i)),r+=6}break;case w.FontRenderOps.MOVE_TO:{const[l,b]=x.slice(r,r+2);v.push(s=>s.moveTo(l,b)),r+=2}break;case w.FontRenderOps.LINE_TO:{const[l,b]=x.slice(r,r+2);v.push(s=>s.lineTo(l,b)),r+=2}break;case w.FontRenderOps.QUADRATIC_CURVE_TO:{const[l,b,s,g]=x.slice(r,r+4);v.push(t=>t.quadraticCurveTo(l,b,s,g)),r+=4}break;case w.FontRenderOps.RESTORE:v.push(l=>l.restore());break;case w.FontRenderOps.SAVE:v.push(l=>l.save());break;case w.FontRenderOps.SCALE:(0,w.assert)(v.length===2,"Scale command is only valid at the third position.");break;case w.FontRenderOps.TRANSFORM:{const[l,b,s,g,t,i]=x.slice(r,r+6);v.push(c=>c.transform(l,b,s,g,t,i)),r+=6}break;case w.FontRenderOps.TRANSLATE:{const[l,b]=x.slice(r,r+2);v.push(s=>s.translate(l,b)),r+=2}break}return this.compiledGlyphs[T]=function(d,l){v[0](d),v[1](d),d.scale(l,-l);for(let b=2,s=v.length;b<s;b++)v[b](d)}}}},62:(at,Z,V)=>{V.d(Z,{Metadata:()=>B});var w=V(292);class B{#t;#e;constructor({parsedData:G,rawData:P}){this.#t=G,this.#e=P}getRaw(){return this.#e}get(G){return this.#t.get(G)??null}getAll(){return(0,w.objectFromMap)(this.#t)}has(G){return this.#t.has(G)}}},457:(at,Z,V)=>{V.d(Z,{PDFNetworkStream:()=>x});var w=V(292),B=V(490);const I=200,G=206;function P(d){const l=d.response;return typeof l!="string"?l:(0,w.stringToBytes)(l).buffer}class T{constructor(l,b={}){this.url=l,this.isHttp=/^https?:/i.test(l),this.httpHeaders=this.isHttp&&b.httpHeaders||Object.create(null),this.withCredentials=b.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(l,b,s){const g={begin:l,end:b};for(const t in s)g[t]=s[t];return this.request(g)}requestFull(l){return this.request(l)}request(l){const b=new XMLHttpRequest,s=this.currXhrId++,g=this.pendingRequests[s]={xhr:b};b.open("GET",this.url),b.withCredentials=this.withCredentials;for(const t in this.httpHeaders){const i=this.httpHeaders[t];i!==void 0&&b.setRequestHeader(t,i)}return this.isHttp&&"begin"in l&&"end"in l?(b.setRequestHeader("Range",`bytes=${l.begin}-${l.end-1}`),g.expectedStatus=G):g.expectedStatus=I,b.responseType="arraybuffer",l.onError&&(b.onerror=function(t){l.onError(b.status)}),b.onreadystatechange=this.onStateChange.bind(this,s),b.onprogress=this.onProgress.bind(this,s),g.onHeadersReceived=l.onHeadersReceived,g.onDone=l.onDone,g.onError=l.onError,g.onProgress=l.onProgress,b.send(null),s}onProgress(l,b){const s=this.pendingRequests[l];s&&s.onProgress?.(b)}onStateChange(l,b){const s=this.pendingRequests[l];if(!s)return;const g=s.xhr;if(g.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),g.readyState!==4||!(l in this.pendingRequests))return;if(delete this.pendingRequests[l],g.status===0&&this.isHttp){s.onError?.(g.status);return}const t=g.status||I;if(!(t===I&&s.expectedStatus===G)&&t!==s.expectedStatus){s.onError?.(g.status);return}const c=P(g);if(t===G){const p=g.getResponseHeader("Content-Range"),y=/bytes (\d+)-(\d+)\/(\d+)/.exec(p);s.onDone({begin:parseInt(y[1],10),chunk:c})}else c?s.onDone({begin:0,chunk:c}):s.onError?.(g.status)}getRequestXhr(l){return this.pendingRequests[l].xhr}isPendingRequest(l){return l in this.pendingRequests}abortRequest(l){const b=this.pendingRequests[l].xhr;delete this.pendingRequests[l],b.abort()}}class x{constructor(l){this._source=l,this._manager=new T(l.url,{httpHeaders:l.httpHeaders,withCredentials:l.withCredentials}),this._rangeChunkSize=l.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(l){const b=this._rangeRequestReaders.indexOf(l);b>=0&&this._rangeRequestReaders.splice(b,1)}getFullReader(){return(0,w.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new v(this._manager,this._source),this._fullRequestReader}getRangeReader(l,b){const s=new r(this._manager,l,b);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(l){this._fullRequestReader?.cancel(l);for(const b of this._rangeRequestReaders.slice(0))b.cancel(l)}}class v{constructor(l,b){this._manager=l;const s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=b.url,this._fullRequestId=l.requestFull(s),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=b.disableRange||!1,this._contentLength=b.length,this._rangeChunkSize=b.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const l=this._fullRequestId,b=this._manager.getRequestXhr(l),s=i=>b.getResponseHeader(i),{allowRangeRequests:g,suggestedLength:t}=(0,B.validateRangeRequestCapabilities)({getResponseHeader:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=t||this._contentLength,this._filename=(0,B.extractFilenameFromHeader)(s),this._isRangeSupported&&this._manager.abortRequest(l),this._headersReceivedCapability.resolve()}_onDone(l){if(l&&(this._requests.length>0?this._requests.shift().resolve({value:l.chunk,done:!1}):this._cachedChunks.push(l.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(l){this._storedError=(0,B.createResponseStatusError)(l,this._url),this._headersReceivedCapability.reject(this._storedError);for(const b of this._requests)b.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(l){this.onProgress?.({loaded:l.loaded,total:l.lengthComputable?l.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const l=Promise.withResolvers();return this._requests.push(l),l.promise}cancel(l){this._done=!0,this._headersReceivedCapability.reject(l);for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class r{constructor(l,b,s){this._manager=l;const g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=l.url,this._requestId=l.requestRange(b,s,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(l){const b=l.chunk;this._requests.length>0?this._requests.shift().resolve({value:b,done:!1}):this._queuedChunk=b,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(l){this._storedError=(0,B.createResponseStatusError)(l,this._url);for(const b of this._requests)b.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(l){this.isStreamingSupported||this.onProgress?.({loaded:l.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const b=this._queuedChunk;return this._queuedChunk=null,{value:b,done:!1}}if(this._done)return{value:void 0,done:!0};const l=Promise.withResolvers();return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},490:(at,Z,V)=>{V.d(Z,{createResponseStatusError:()=>T,extractFilenameFromHeader:()=>P,validateRangeRequestCapabilities:()=>G,validateResponseStatus:()=>x});var w=V(292);function B(v){let r=!0,d=l("filename\\*","i").exec(v);if(d){d=d[1];let p=t(d);return p=unescape(p),p=i(p),p=c(p),s(p)}if(d=g(v),d){const p=c(d);return s(p)}if(d=l("filename","i").exec(v),d){d=d[1];let p=t(d);return p=c(p),s(p)}function l(p,y){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function b(p,y){if(p){if(!/^[\x00-\xFF]+$/.test(y))return y;try{const S=new TextDecoder(p,{fatal:!0}),L=(0,w.stringToBytes)(y);y=S.decode(L),r=!1}catch{}}return y}function s(p){return r&&/[\x80-\xff]/.test(p)&&(p=b("utf-8",p),r&&(p=b("iso-8859-1",p))),p}function g(p){const y=[];let S;const L=l("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(S=L.exec(p))!==null;){let[,O,_,z]=S;if(O=parseInt(O,10),O in y){if(O===0)break;continue}y[O]=[_,z]}const M=[];for(let O=0;O<y.length&&O in y;++O){let[_,z]=y[O];z=t(z),_&&(z=unescape(z),O===0&&(z=i(z))),M.push(z)}return M.join("")}function t(p){if(p.startsWith('"')){const y=p.slice(1).split('\\"');for(let S=0;S<y.length;++S){const L=y[S].indexOf('"');L!==-1&&(y[S]=y[S].slice(0,L),y.length=S+1),y[S]=y[S].replaceAll(/\\(.)/g,"$1")}p=y.join('"')}return p}function i(p){const y=p.indexOf("'");if(y===-1)return p;const S=p.slice(0,y),M=p.slice(y+1).replace(/^[^']*'/,"");return b(S,M)}function c(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,S,L,M){if(L==="q"||L==="Q")return M=M.replaceAll("_"," "),M=M.replaceAll(/=([0-9a-fA-F]{2})/g,function(O,_){return String.fromCharCode(parseInt(_,16))}),b(S,M);try{M=atob(M)}catch{}return b(S,M)})}return""}var I=V(419);function G({getResponseHeader:v,isHttp:r,rangeChunkSize:d,disableRange:l}){const b={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(v("Content-Length"),10);return!Number.isInteger(s)||(b.suggestedLength=s,s<=2*d)||l||!r||v("Accept-Ranges")!=="bytes"||(v("Content-Encoding")||"identity")!=="identity"||(b.allowRangeRequests=!0),b}function P(v){const r=v("Content-Disposition");if(r){let d=B(r);if(d.includes("%"))try{d=decodeURIComponent(d)}catch{}if((0,I.isPdfFile)(d))return d}return null}function T(v,r){return v===404||v===0&&r.startsWith("file:")?new w.MissingPDFException('Missing PDF "'+r+'".'):new w.UnexpectedResponseException(`Unexpected server response (${v}) while retrieving PDF "${r}".`,v)}function x(v){return v===200||v===206}},786:(at,Z,V)=>{V.a(at,async(w,B)=>{try{let d=function(y){const S=v.parse(y);return S.protocol==="file:"||S.host?S:/^[a-z]:[/\\]/i.test(y)?v.parse(`file:///${y}`):(S.host||(S.protocol="file:"),S)},g=function(y,S){return{protocol:y.protocol,auth:y.auth,host:y.hostname,port:y.port,path:y.path,method:"GET",headers:S}};V.d(Z,{PDFNodeStream:()=>l});var I=V(292),G=V(490);let P,T,x,v;I.isNodeJS&&(P=await Lt(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),T=await Lt(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),x=await Lt(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),v=await Lt(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]));const r=/^file:\/\/\/[a-zA-Z]:\//;class l{constructor(S){this.source=S,this.url=d(S.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&S.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,I.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new c(this):new t(this),this._fullRequestReader}getRangeReader(S,L){if(L<=this._progressiveDataLength)return null;const M=this.isFsUrl?new p(this,S,L):new i(this,S,L);return this._rangeRequestReaders.push(M),M}cancelAllRequests(S){this._fullRequestReader?.cancel(S);for(const L of this._rangeRequestReaders.slice(0))L.cancel(S)}}class b{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null;const L=S.source;this._contentLength=L.length,this._loaded=0,this._filename=null,this._disableRange=L.disableRange||!1,this._rangeChunkSize=L.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!L.disableStream,this._isRangeSupported=!L.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=S.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",L=>{this._error(L)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new I.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class s{constructor(S){this._url=S.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const L=S.source;this._isStreamingSupported=!L.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const S=this._readableStream.read();return S===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=S.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(S).buffer,done:!1})}cancel(S){if(!this._readableStream){this._error(S);return}this._readableStream.destroy(S)}_error(S){this._storedError=S,this._readCapability.resolve()}_setReadableStream(S){this._readableStream=S,S.on("readable",()=>{this._readCapability.resolve()}),S.on("end",()=>{S.destroy(),this._done=!0,this._readCapability.resolve()}),S.on("error",L=>{this._error(L)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class t extends b{constructor(S){super(S);const L=M=>{if(M.statusCode===404){const q=new I.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=q,this._headersCapability.reject(q);return}this._headersCapability.resolve(),this._setReadableStream(M);const O=q=>this._readableStream.headers[q.toLowerCase()],{allowRangeRequests:_,suggestedLength:z}=(0,G.validateRangeRequestCapabilities)({getResponseHeader:O,isHttp:S.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=_,this._contentLength=z||this._contentLength,this._filename=(0,G.extractFilenameFromHeader)(O)};this._request=null,this._url.protocol==="http:"?this._request=T.request(g(this._url,S.httpHeaders),L):this._request=x.request(g(this._url,S.httpHeaders),L),this._request.on("error",M=>{this._storedError=M,this._headersCapability.reject(M)}),this._request.end()}}class i extends s{constructor(S,L,M){super(S),this._httpHeaders={};for(const _ in S.httpHeaders){const z=S.httpHeaders[_];z!==void 0&&(this._httpHeaders[_]=z)}this._httpHeaders.Range=`bytes=${L}-${M-1}`;const O=_=>{if(_.statusCode===404){const z=new I.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=z;return}this._setReadableStream(_)};this._request=null,this._url.protocol==="http:"?this._request=T.request(g(this._url,this._httpHeaders),O):this._request=x.request(g(this._url,this._httpHeaders),O),this._request.on("error",_=>{this._storedError=_}),this._request.end()}}class c extends b{constructor(S){super(S);let L=decodeURIComponent(this._url.path);r.test(this._url.href)&&(L=L.replace(/^\//,"")),P.promises.lstat(L).then(M=>{this._contentLength=M.size,this._setReadableStream(P.createReadStream(L)),this._headersCapability.resolve()},M=>{M.code==="ENOENT"&&(M=new I.MissingPDFException(`Missing PDF "${L}".`)),this._storedError=M,this._headersCapability.reject(M)})}}class p extends s{constructor(S,L,M){super(S);let O=decodeURIComponent(this._url.path);r.test(this._url.href)&&(O=O.replace(/^\//,"")),this._setReadableStream(P.createReadStream(O,{start:L,end:M-1}))}}B()}catch(P){B(P)}},1)},573:(at,Z,V)=>{V.a(at,async(w,B)=>{try{V.d(Z,{NodeCMapReaderFactory:()=>l,NodeCanvasFactory:()=>d,NodeFilterFactory:()=>r,NodeStandardFontDataFactory:()=>b});var I=V(583),G=V(292);let P,T,x;if(G.isNodeJS){P=await Lt(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);try{T=await Lt(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])}catch{}try{x=await Lt(()=>import("./index--EVKqUhF.js"),[])}catch{}}const v=function(s){return P.promises.readFile(s).then(g=>new Uint8Array(g))};class r extends I.BaseFilterFactory{}class d extends I.BaseCanvasFactory{_createCanvas(g,t){return T.createCanvas(g,t)}}class l extends I.BaseCMapReaderFactory{_fetchData(g,t){return v(g).then(i=>({cMapData:i,compressionType:t}))}}class b extends I.BaseStandardFontDataFactory{_fetchData(g){return v(g)}}B()}catch(P){B(P)}},1)},626:(at,Z,V)=>{V.d(Z,{OptionalContentConfig:()=>P});var w=V(292),B=V(651);const I=Symbol("INTERNAL");class G{#t=!1;#e=!1;#s=!1;#n=!0;constructor(x,{name:v,intent:r,usage:d}){this.#t=!!(x&w.RenderingIntentFlag.DISPLAY),this.#e=!!(x&w.RenderingIntentFlag.PRINT),this.name=v,this.intent=r,this.usage=d}get visible(){if(this.#s)return this.#n;if(!this.#n)return!1;const{print:x,view:v}=this.usage;return this.#t?v?.viewState!=="OFF":this.#e?x?.printState!=="OFF":!0}_setVisible(x,v,r=!1){x!==I&&(0,w.unreachable)("Internal method `_setVisible` called."),this.#s=r,this.#n=v}}class P{#t=null;#e=new Map;#s=null;#n=null;constructor(x,v=w.RenderingIntentFlag.DISPLAY){if(this.renderingIntent=v,this.name=null,this.creator=null,x!==null){this.name=x.name,this.creator=x.creator,this.#n=x.order;for(const r of x.groups)this.#e.set(r.id,new G(v,r));if(x.baseState==="OFF")for(const r of this.#e.values())r._setVisible(I,!1);for(const r of x.on)this.#e.get(r)._setVisible(I,!0);for(const r of x.off)this.#e.get(r)._setVisible(I,!1);this.#s=this.getHash()}}#r(x){const v=x.length;if(v<2)return!0;const r=x[0];for(let d=1;d<v;d++){const l=x[d];let b;if(Array.isArray(l))b=this.#r(l);else if(this.#e.has(l))b=this.#e.get(l).visible;else return(0,w.warn)(`Optional content group not found: ${l}`),!0;switch(r){case"And":if(!b)return!1;break;case"Or":if(b)return!0;break;case"Not":return!b;default:return!0}}return r==="And"}isVisible(x){if(this.#e.size===0)return!0;if(!x)return(0,w.info)("Optional content group not defined."),!0;if(x.type==="OCG")return this.#e.has(x.id)?this.#e.get(x.id).visible:((0,w.warn)(`Optional content group not found: ${x.id}`),!0);if(x.type==="OCMD"){if(x.expression)return this.#r(x.expression);if(!x.policy||x.policy==="AnyOn"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(this.#e.get(v).visible)return!0}return!1}else if(x.policy==="AllOn"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(!this.#e.get(v).visible)return!1}return!0}else if(x.policy==="AnyOff"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(!this.#e.get(v).visible)return!0}return!1}else if(x.policy==="AllOff"){for(const v of x.ids){if(!this.#e.has(v))return(0,w.warn)(`Optional content group not found: ${v}`),!0;if(this.#e.get(v).visible)return!1}return!0}return(0,w.warn)(`Unknown optional content policy ${x.policy}.`),!0}return(0,w.warn)(`Unknown group type ${x.type}.`),!0}setVisibility(x,v=!0){const r=this.#e.get(x);if(!r){(0,w.warn)(`Optional content group not found: ${x}`);return}r._setVisible(I,!!v,!0),this.#t=null}setOCGState({state:x,preserveRB:v}){let r;for(const d of x){switch(d){case"ON":case"OFF":case"Toggle":r=d;continue}const l=this.#e.get(d);if(l)switch(r){case"ON":l._setVisible(I,!0);break;case"OFF":l._setVisible(I,!1);break;case"Toggle":l._setVisible(I,!l.visible);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,w.objectFromMap)(this.#e):null}getGroup(x){return this.#e.get(x)||null}getHash(){if(this.#t!==null)return this.#t;const x=new B.MurmurHash3_64;for(const[v,r]of this.#e)x.update(`${v}:${r.visible}`);return this.#t=x.hexdigest()}}},814:(at,Z,V)=>{V.d(Z,{cleanupTextLayer:()=>r,renderTextLayer:()=>t,updateTextLayer:()=>i});var w=V(292),B=V(419);const I=1e5,G=30,P=.8,T=new Map;let x=null;function v(){if(!x){const c=document.createElement("canvas");c.className="hiddenCanvasElement",document.body.append(c),x=c.getContext("2d",{alpha:!1})}return x}function r(){x?.canvas.remove(),x=null}function d(c){const p=T.get(c);if(p)return p;const y=v(),S=y.font;y.canvas.width=y.canvas.height=G,y.font=`${G}px ${c}`;const L=y.measureText("");let M=L.fontBoundingBoxAscent,O=Math.abs(L.fontBoundingBoxDescent);if(M){const z=M/(M+O);return T.set(c,z),y.canvas.width=y.canvas.height=0,y.font=S,z}y.strokeStyle="red",y.clearRect(0,0,G,G),y.strokeText("g",0,0);let _=y.getImageData(0,0,G,G).data;O=0;for(let z=_.length-1-3;z>=0;z-=4)if(_[z]>0){O=Math.ceil(z/4/G);break}y.clearRect(0,0,G,G),y.strokeText("A",0,G),_=y.getImageData(0,0,G,G).data,M=0;for(let z=0,q=_.length;z<q;z+=4)if(_[z]>0){M=G-Math.floor(z/4/G);break}if(y.canvas.width=y.canvas.height=0,y.font=S,M){const z=M/(M+O);return T.set(c,z),z}return T.set(c,P),P}function l(c,p,y){const S=document.createElement("span"),L={angle:0,canvasWidth:0,hasText:p.str!=="",hasEOL:p.hasEOL,fontSize:0};c._textDivs.push(S);const M=w.Util.transform(c._transform,p.transform);let O=Math.atan2(M[1],M[0]);const _=y[p.fontName];_.vertical&&(O+=Math.PI/2);const z=c._fontInspectorEnabled&&_.fontSubstitution||_.fontFamily,q=Math.hypot(M[2],M[3]),nt=q*d(z);let j,H;O===0?(j=M[4],H=M[5]-nt):(j=M[4]+nt*Math.sin(O),H=M[5]-nt*Math.cos(O));const U="calc(var(--scale-factor)*",Y=S.style;c._container===c._rootContainer?(Y.left=`${(100*j/c._pageWidth).toFixed(2)}%`,Y.top=`${(100*H/c._pageHeight).toFixed(2)}%`):(Y.left=`${U}${j.toFixed(2)}px)`,Y.top=`${U}${H.toFixed(2)}px)`),Y.fontSize=`${U}${q.toFixed(2)}px)`,Y.fontFamily=z,L.fontSize=q,S.setAttribute("role","presentation"),S.textContent=p.str,S.dir=p.dir,c._fontInspectorEnabled&&(S.dataset.fontName=_.fontSubstitutionLoadedName||p.fontName),O!==0&&(L.angle=O*(180/Math.PI));let et=!1;if(p.str.length>1)et=!0;else if(p.str!==" "&&p.transform[0]!==p.transform[3]){const tt=Math.abs(p.transform[0]),ot=Math.abs(p.transform[3]);tt!==ot&&Math.max(tt,ot)/Math.min(tt,ot)>1.5&&(et=!0)}et&&(L.canvasWidth=_.vertical?p.height:p.width),c._textDivProperties.set(S,L),c._isReadableStream&&c._layoutText(S)}function b(c){const{div:p,scale:y,properties:S,ctx:L,prevFontSize:M,prevFontFamily:O}=c,{style:_}=p;let z="";if(S.canvasWidth!==0&&S.hasText){const{fontFamily:q}=_,{canvasWidth:nt,fontSize:j}=S;(M!==j||O!==q)&&(L.font=`${j*y}px ${q}`,c.prevFontSize=j,c.prevFontFamily=q);const{width:H}=L.measureText(p.textContent);H>0&&(z=`scaleX(${nt*y/H})`)}S.angle!==0&&(z=`rotate(${S.angle}deg) ${z}`),z.length>0&&(_.transform=z)}function s(c){if(c._canceled)return;const p=c._textDivs,y=c._capability;if(p.length>I){y.resolve();return}if(!c._isReadableStream)for(const L of p)c._layoutText(L);y.resolve()}class g{constructor({textContentSource:p,container:y,viewport:S,textDivs:L,textDivProperties:M,textContentItemsStr:O}){this._textContentSource=p,this._isReadableStream=p instanceof ReadableStream,this._container=this._rootContainer=y,this._textDivs=L||[],this._textContentItemsStr=O||[],this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=M||new WeakMap,this._canceled=!1,this._capability=Promise.withResolvers(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:S.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:v()};const{pageWidth:_,pageHeight:z,pageX:q,pageY:nt}=S.rawDims;this._transform=[1,0,0,-1,-q,nt+z],this._pageWidth=_,this._pageHeight=z,(0,B.setLayerDimensions)(y,S),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new w.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new w.AbortException("TextLayer task cancelled."))}_processItems(p,y){for(const S of p){if(S.str===void 0){if(S.type==="beginMarkedContentProps"||S.type==="beginMarkedContent"){const L=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),S.id!==null&&this._container.setAttribute("id",`${S.id}`),L.append(this._container)}else S.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(S.str),l(this,S,y)}}_layoutText(p){const y=this._layoutTextParams.properties=this._textDivProperties.get(p);if(this._layoutTextParams.div=p,b(this._layoutTextParams),y.hasText&&this._container.append(p),y.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),this._container.append(S)}}_render(){const{promise:p,resolve:y,reject:S}=Promise.withResolvers();let L=Object.create(null);if(this._isReadableStream){const M=()=>{this._reader.read().then(({value:O,done:_})=>{if(_){y();return}Object.assign(L,O.styles),this._processItems(O.items,L),M()},S)};this._reader=this._textContentSource.getReader(),M()}else if(this._textContentSource){const{items:M,styles:O}=this._textContentSource;this._processItems(M,O),y()}else throw new Error('No "textContentSource" parameter specified.');p.then(()=>{L=null,s(this)},this._capability.reject)}}function t(c){const p=new g(c);return p._render(),p}function i({container:c,viewport:p,textDivs:y,textDivProperties:S,mustRotate:L=!0,mustRescale:M=!0}){if(L&&(0,B.setLayerDimensions)(c,{rotation:p.rotation}),M){const O=v(),z={prevFontSize:null,prevFontFamily:null,div:null,scale:p.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:O};for(const q of y)z.properties=S.get(q),z.div=q,b(z)}}},585:(at,Z,V)=>{V.d(Z,{PDFDataTransportStream:()=>I});var w=V(292),B=V(419);class I{constructor(x,{disableRange:v=!1,disableStream:r=!1}){(0,w.assert)(x,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:d,initialData:l,progressiveDone:b,contentDispositionFilename:s}=x;if(this._queuedChunks=[],this._progressiveDone=b,this._contentDispositionFilename=s,l?.length>0){const g=l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer;this._queuedChunks.push(g)}this._pdfDataRangeTransport=x,this._isStreamingSupported=!r,this._isRangeSupported=!v,this._contentLength=d,this._fullRequestReader=null,this._rangeReaders=[],x.addRangeListener((g,t)=>{this._onReceiveData({begin:g,chunk:t})}),x.addProgressListener((g,t)=>{this._onProgress({loaded:g,total:t})}),x.addProgressiveReadListener(g=>{this._onReceiveData({chunk:g})}),x.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),x.transportReady()}_onReceiveData({begin:x,chunk:v}){const r=v instanceof Uint8Array&&v.byteLength===v.buffer.byteLength?v.buffer:new Uint8Array(v).buffer;if(x===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{const d=this._rangeReaders.some(function(l){return l._begin!==x?!1:(l._enqueue(r),!0)});(0,w.assert)(d,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(x){x.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:x.loaded}):this._fullRequestReader?.onProgress?.({loaded:x.loaded,total:x.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(x){const v=this._rangeReaders.indexOf(x);v>=0&&this._rangeReaders.splice(v,1)}getFullReader(){(0,w.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const x=this._queuedChunks;return this._queuedChunks=null,new G(this,x,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(x,v){if(v<=this._progressiveDataLength)return null;const r=new P(this,x,v);return this._pdfDataRangeTransport.requestDataRange(x,v),this._rangeReaders.push(r),r}cancelAllRequests(x){this._fullRequestReader?.cancel(x);for(const v of this._rangeReaders.slice(0))v.cancel(x);this._pdfDataRangeTransport.abort()}}class G{constructor(x,v,r=!1,d=null){this._stream=x,this._done=r||!1,this._filename=(0,B.isPdfFile)(d)?d:null,this._queuedChunks=v||[],this._loaded=0;for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._requests=[],this._headersReady=Promise.resolve(),x._fullRequestReader=this,this.onProgress=null}_enqueue(x){this._done||(this._requests.length>0?this._requests.shift().resolve({value:x,done:!1}):this._queuedChunks.push(x),this._loaded+=x.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const x=Promise.withResolvers();return this._requests.push(x),x.promise}cancel(x){this._done=!0;for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class P{constructor(x,v,r){this._stream=x,this._begin=v,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(x){if(!this._done){if(this._requests.length===0)this._queuedChunk=x;else{this._requests.shift().resolve({value:x,done:!1});for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const v=this._queuedChunk;return this._queuedChunk=null,{value:v,done:!1}}if(this._done)return{value:void 0,done:!0};const x=Promise.withResolvers();return this._requests.push(x),x.promise}cancel(x){this._done=!0;for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},164:(at,Z,V)=>{V.d(Z,{GlobalWorkerOptions:()=>w});class w{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(I){if(!(typeof Worker<"u"&&I instanceof Worker)&&I!==null)throw new Error("Invalid `workerPort` type.");this.#t=I}static get workerSrc(){return this.#e}static set workerSrc(I){if(typeof I!="string")throw new Error("Invalid `workerSrc` type.");this.#e=I}}},284:(at,Z,V)=>{V.d(Z,{XfaLayer:()=>B});var w=V(50);class B{static setupStorage(G,P,T,x,v){const r=x.getValue(P,{value:null});switch(T.name){case"textarea":if(r.value!==null&&(G.textContent=r.value),v==="print")break;G.addEventListener("input",d=>{x.setValue(P,{value:d.target.value})});break;case"input":if(T.attributes.type==="radio"||T.attributes.type==="checkbox"){if(r.value===T.attributes.xfaOn?G.setAttribute("checked",!0):r.value===T.attributes.xfaOff&&G.removeAttribute("checked"),v==="print")break;G.addEventListener("change",d=>{x.setValue(P,{value:d.target.checked?d.target.getAttribute("xfaOn"):d.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&G.setAttribute("value",r.value),v==="print")break;G.addEventListener("input",d=>{x.setValue(P,{value:d.target.value})})}break;case"select":if(r.value!==null){G.setAttribute("value",r.value);for(const d of T.children)d.attributes.value===r.value?d.attributes.selected=!0:d.attributes.hasOwnProperty("selected")&&delete d.attributes.selected}G.addEventListener("input",d=>{const l=d.target.options,b=l.selectedIndex===-1?"":l[l.selectedIndex].value;x.setValue(P,{value:b})});break}}static setAttributes({html:G,element:P,storage:T=null,intent:x,linkService:v}){const{attributes:r}=P,d=G instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${x}`);for(const[l,b]of Object.entries(r))if(b!=null)switch(l){case"class":b.length&&G.setAttribute(l,b.join(" "));break;case"dataId":break;case"id":G.setAttribute("data-element-id",b);break;case"style":Object.assign(G.style,b);break;case"textContent":G.textContent=b;break;default:(!d||l!=="href"&&l!=="newWindow")&&G.setAttribute(l,b)}d&&v.addLinkAttributes(G,r.href,r.newWindow),T&&r.dataId&&this.setupStorage(G,r.dataId,P,T)}static render(G){const P=G.annotationStorage,T=G.linkService,x=G.xfaHtml,v=G.intent||"display",r=document.createElement(x.name);x.attributes&&this.setAttributes({html:r,element:x,intent:v,linkService:T});const d=v!=="richText",l=G.div;if(l.append(r),G.viewport){const g=`matrix(${G.viewport.transform.join(",")})`;l.style.transform=g}d&&l.setAttribute("class","xfaLayer xfaFont");const b=[];if(x.children.length===0){if(x.value){const g=document.createTextNode(x.value);r.append(g),d&&w.XfaText.shouldBuildText(x.name)&&b.push(g)}return{textDivs:b}}const s=[[x,-1,r]];for(;s.length>0;){const[g,t,i]=s.at(-1);if(t+1===g.children.length){s.pop();continue}const c=g.children[++s.at(-1)[1]];if(c===null)continue;const{name:p}=c;if(p==="#text"){const S=document.createTextNode(c.value);b.push(S),i.append(S);continue}const y=c?.attributes?.xmlns?document.createElementNS(c.attributes.xmlns,p):document.createElement(p);if(i.append(y),c.attributes&&this.setAttributes({html:y,element:c,storage:P,intent:v,linkService:T}),c.children?.length>0)s.push([c,-1,y]);else if(c.value){const S=document.createTextNode(c.value);d&&w.XfaText.shouldBuildText(p)&&b.push(S),y.append(S)}}for(const g of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:b}}static update(G){const P=`matrix(${G.viewport.transform.join(",")})`;G.div.style.transform=P,G.div.hidden=!1}}},50:(at,Z,V)=>{V.d(Z,{XfaText:()=>w});class w{static textContent(I){const G=[],P={items:G,styles:Object.create(null)};function T(x){if(!x)return;let v=null;const r=x.name;if(r==="#text")v=x.value;else if(w.shouldBuildText(r))x?.attributes?.textContent?v=x.attributes.textContent:x.value&&(v=x.value);else return;if(v!==null&&G.push({str:v}),!!x.children)for(const d of x.children)T(d)}return T(I),P}static shouldBuildText(I){return!(I==="textarea"||I==="input"||I==="option"||I==="select")}}},228:(at,Z,V)=>{V.a(at,async(w,B)=>{try{V.d(Z,{AbortException:()=>I.AbortException,AnnotationEditorLayer:()=>x.AnnotationEditorLayer,AnnotationEditorParamsType:()=>I.AnnotationEditorParamsType,AnnotationEditorType:()=>I.AnnotationEditorType,AnnotationEditorUIManager:()=>v.AnnotationEditorUIManager,AnnotationLayer:()=>r.AnnotationLayer,AnnotationMode:()=>I.AnnotationMode,CMapCompressionType:()=>I.CMapCompressionType,ColorPicker:()=>d.ColorPicker,DOMSVGFactory:()=>P.DOMSVGFactory,DrawLayer:()=>l.DrawLayer,FeatureTest:()=>I.FeatureTest,GlobalWorkerOptions:()=>b.GlobalWorkerOptions,ImageKind:()=>I.ImageKind,InvalidPDFException:()=>I.InvalidPDFException,MissingPDFException:()=>I.MissingPDFException,OPS:()=>I.OPS,Outliner:()=>s.Outliner,PDFDataRangeTransport:()=>G.PDFDataRangeTransport,PDFDateString:()=>P.PDFDateString,PDFWorker:()=>G.PDFWorker,PasswordResponses:()=>I.PasswordResponses,PermissionFlag:()=>I.PermissionFlag,PixelsPerInch:()=>P.PixelsPerInch,RenderingCancelledException:()=>P.RenderingCancelledException,UnexpectedResponseException:()=>I.UnexpectedResponseException,Util:()=>I.Util,VerbosityLevel:()=>I.VerbosityLevel,XfaLayer:()=>g.XfaLayer,build:()=>G.build,createValidAbsoluteUrl:()=>I.createValidAbsoluteUrl,fetchData:()=>P.fetchData,getDocument:()=>G.getDocument,getFilenameFromUrl:()=>P.getFilenameFromUrl,getPdfFilenameFromUrl:()=>P.getPdfFilenameFromUrl,getXfaPageViewport:()=>P.getXfaPageViewport,isDataScheme:()=>P.isDataScheme,isPdfFile:()=>P.isPdfFile,noContextMenu:()=>P.noContextMenu,normalizeUnicode:()=>I.normalizeUnicode,renderTextLayer:()=>T.renderTextLayer,setLayerDimensions:()=>P.setLayerDimensions,shadow:()=>I.shadow,updateTextLayer:()=>T.updateTextLayer,version:()=>G.version});var I=V(292),G=V(831),P=V(419),T=V(814),x=V(731),v=V(830),r=V(976),d=V(259),l=V(47),b=V(164),s=V(61),g=V(284),t=w([G]);G=(t.then?(await t)():t)[0];const i="4.2.67",c="49b388101";B()}catch(i){B(i)}})},178:(at,Z,V)=>{V.d(Z,{MessageHandler:()=>P});var w=V(292);const B={UNKNOWN:0,DATA:1,ERROR:2},I={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function G(T){switch(T instanceof Error||typeof T=="object"&&T!==null||(0,w.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),T.name){case"AbortException":return new w.AbortException(T.message);case"MissingPDFException":return new w.MissingPDFException(T.message);case"PasswordException":return new w.PasswordException(T.message,T.code);case"UnexpectedResponseException":return new w.UnexpectedResponseException(T.message,T.status);case"UnknownErrorException":return new w.UnknownErrorException(T.message,T.details);default:return new w.UnknownErrorException(T.message,T.toString())}}class P{constructor(x,v,r){this.sourceName=x,this.targetName=v,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=d=>{const l=d.data;if(l.targetName!==this.sourceName)return;if(l.stream){this.#e(l);return}if(l.callback){const s=l.callbackId,g=this.callbackCapabilities[s];if(!g)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],l.callback===B.DATA)g.resolve(l.data);else if(l.callback===B.ERROR)g.reject(G(l.reason));else throw new Error("Unexpected callback case");return}const b=this.actionHandler[l.action];if(!b)throw new Error(`Unknown action from worker: ${l.action}`);if(l.callbackId){const s=this.sourceName,g=l.sourceName;new Promise(function(t){t(b(l.data))}).then(function(t){r.postMessage({sourceName:s,targetName:g,callback:B.DATA,callbackId:l.callbackId,data:t})},function(t){r.postMessage({sourceName:s,targetName:g,callback:B.ERROR,callbackId:l.callbackId,reason:G(t)})});return}if(l.streamId){this.#t(l);return}b(l.data)},r.addEventListener("message",this._onComObjOnMessage)}on(x,v){const r=this.actionHandler;if(r[x])throw new Error(`There is already an actionName called "${x}"`);r[x]=v}send(x,v,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:x,data:v},r)}sendWithPromise(x,v,r){const d=this.callbackId++,l=Promise.withResolvers();this.callbackCapabilities[d]=l;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:x,callbackId:d,data:v},r)}catch(b){l.reject(b)}return l.promise}sendWithStream(x,v,r,d){const l=this.streamId++,b=this.sourceName,s=this.targetName,g=this.comObj;return new ReadableStream({start:t=>{const i=Promise.withResolvers();return this.streamControllers[l]={controller:t,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},g.postMessage({sourceName:b,targetName:s,action:x,streamId:l,data:v,desiredSize:t.desiredSize},d),i.promise},pull:t=>{const i=Promise.withResolvers();return this.streamControllers[l].pullCall=i,g.postMessage({sourceName:b,targetName:s,stream:I.PULL,streamId:l,desiredSize:t.desiredSize}),i.promise},cancel:t=>{(0,w.assert)(t instanceof Error,"cancel must have a valid reason");const i=Promise.withResolvers();return this.streamControllers[l].cancelCall=i,this.streamControllers[l].isClosed=!0,g.postMessage({sourceName:b,targetName:s,stream:I.CANCEL,streamId:l,reason:G(t)}),i.promise}},r)}#t(x){const v=x.streamId,r=this.sourceName,d=x.sourceName,l=this.comObj,b=this,s=this.actionHandler[x.action],g={enqueue(t,i=1,c){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=i,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),l.postMessage({sourceName:r,targetName:d,stream:I.ENQUEUE,streamId:v,chunk:t},c)},close(){this.isCancelled||(this.isCancelled=!0,l.postMessage({sourceName:r,targetName:d,stream:I.CLOSE,streamId:v}),delete b.streamSinks[v])},error(t){(0,w.assert)(t instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,l.postMessage({sourceName:r,targetName:d,stream:I.ERROR,streamId:v,reason:G(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:x.desiredSize,ready:null};g.sinkCapability.resolve(),g.ready=g.sinkCapability.promise,this.streamSinks[v]=g,new Promise(function(t){t(s(x.data,g))}).then(function(){l.postMessage({sourceName:r,targetName:d,stream:I.START_COMPLETE,streamId:v,success:!0})},function(t){l.postMessage({sourceName:r,targetName:d,stream:I.START_COMPLETE,streamId:v,reason:G(t)})})}#e(x){const v=x.streamId,r=this.sourceName,d=x.sourceName,l=this.comObj,b=this.streamControllers[v],s=this.streamSinks[v];switch(x.stream){case I.START_COMPLETE:x.success?b.startCall.resolve():b.startCall.reject(G(x.reason));break;case I.PULL_COMPLETE:x.success?b.pullCall.resolve():b.pullCall.reject(G(x.reason));break;case I.PULL:if(!s){l.postMessage({sourceName:r,targetName:d,stream:I.PULL_COMPLETE,streamId:v,success:!0});break}s.desiredSize<=0&&x.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=x.desiredSize,new Promise(function(g){g(s.onPull?.())}).then(function(){l.postMessage({sourceName:r,targetName:d,stream:I.PULL_COMPLETE,streamId:v,success:!0})},function(g){l.postMessage({sourceName:r,targetName:d,stream:I.PULL_COMPLETE,streamId:v,reason:G(g)})});break;case I.ENQUEUE:if((0,w.assert)(b,"enqueue should have stream controller"),b.isClosed)break;b.controller.enqueue(x.chunk);break;case I.CLOSE:if((0,w.assert)(b,"close should have stream controller"),b.isClosed)break;b.isClosed=!0,b.controller.close(),this.#s(b,v);break;case I.ERROR:(0,w.assert)(b,"error should have stream controller"),b.controller.error(G(x.reason)),this.#s(b,v);break;case I.CANCEL_COMPLETE:x.success?b.cancelCall.resolve():b.cancelCall.reject(G(x.reason)),this.#s(b,v);break;case I.CANCEL:if(!s)break;new Promise(function(g){g(s.onCancel?.(G(x.reason)))}).then(function(){l.postMessage({sourceName:r,targetName:d,stream:I.CANCEL_COMPLETE,streamId:v,success:!0})},function(g){l.postMessage({sourceName:r,targetName:d,stream:I.CANCEL_COMPLETE,streamId:v,reason:G(g)})}),s.sinkCapability.reject(G(x.reason)),s.isCancelled=!0,delete this.streamSinks[v];break;default:throw new Error("Unexpected stream case")}}async#s(x,v){await Promise.allSettled([x.startCall?.promise,x.pullCall?.promise,x.cancelCall?.promise]),delete this.streamControllers[v]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},651:(at,Z,V)=>{V.d(Z,{MurmurHash3_64:()=>G});const w=3285377520,B=4294901760,I=65535;class G{constructor(T){this.h1=T?T&4294967295:w,this.h2=T?T&4294967295:w}update(T){let x,v;if(typeof T=="string"){x=new Uint8Array(T.length*2),v=0;for(let S=0,L=T.length;S<L;S++){const M=T.charCodeAt(S);M<=255?x[v++]=M:(x[v++]=M>>>8,x[v++]=M&255)}}else if(ArrayBuffer.isView(T))x=T.slice(),v=x.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=v>>2,d=v-r*4,l=new Uint32Array(x.buffer,0,r);let b=0,s=0,g=this.h1,t=this.h2;const i=3432918353,c=461845907,p=i&I,y=c&I;for(let S=0;S<r;S++)S&1?(b=l[S],b=b*i&B|b*p&I,b=b<<15|b>>>17,b=b*c&B|b*y&I,g^=b,g=g<<13|g>>>19,g=g*5+3864292196):(s=l[S],s=s*i&B|s*p&I,s=s<<15|s>>>17,s=s*c&B|s*y&I,t^=s,t=t<<13|t>>>19,t=t*5+3864292196);switch(b=0,d){case 3:b^=x[r*4+2]<<16;case 2:b^=x[r*4+1]<<8;case 1:b^=x[r*4],b=b*i&B|b*p&I,b=b<<15|b>>>17,b=b*c&B|b*y&I,r&1?g^=b:t^=b}this.h1=g,this.h2=t}hexdigest(){let T=this.h1,x=this.h2;return T^=x>>>1,T=T*3981806797&B|T*36045&I,x=x*4283543511&B|((x<<16|T>>>16)*2950163797&B)>>>16,T^=x>>>1,T=T*444984403&B|T*60499&I,x=x*3301882366&B|((x<<16|T>>>16)*3120437893&B)>>>16,T^=x>>>1,(T>>>0).toString(16).padStart(8,"0")+(x>>>0).toString(16).padStart(8,"0")}}},292:(at,Z,V)=>{V.d(Z,{AbortException:()=>dt,AnnotationBorderStyleType:()=>t,AnnotationEditorParamsType:()=>d,AnnotationEditorPrefix:()=>v,AnnotationEditorType:()=>r,AnnotationMode:()=>x,AnnotationPrefix:()=>k,AnnotationType:()=>g,BaseException:()=>U,CMapCompressionType:()=>c,FONT_IDENTITY_MATRIX:()=>I,FeatureTest:()=>n,FontRenderOps:()=>D,FormatError:()=>pt,IDENTITY_MATRIX:()=>B,ImageKind:()=>s,InvalidPDFException:()=>tt,LINE_FACTOR:()=>P,MAX_IMAGE_SIZE_TO_CACHE:()=>G,MissingPDFException:()=>ot,OPS:()=>p,PasswordException:()=>Y,PasswordResponses:()=>y,PermissionFlag:()=>l,RenderingIntentFlag:()=>T,TextRenderingMode:()=>b,UnexpectedResponseException:()=>ct,UnknownErrorException:()=>et,Util:()=>o,VerbosityLevel:()=>i,assert:()=>q,bytesToString:()=>ht,createValidAbsoluteUrl:()=>j,getUuid:()=>R,getVerbosityLevel:()=>M,info:()=>O,isNodeJS:()=>w,normalizeUnicode:()=>E,objectFromMap:()=>m,setVerbosityLevel:()=>L,shadow:()=>H,string32:()=>st,stringToBytes:()=>ut,unreachable:()=>z,warn:()=>_});const w=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),B=[1,0,0,1,0,0],I=[.001,0,0,.001,0,0],G=1e7,P=1.35,T={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},x={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},v="pdfjs_internal_editor_",r={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},d={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},l={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},b={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},s={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},g={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},i={ERRORS:0,WARNINGS:1,INFOS:5},c={NONE:0,BINARY:1},p={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},y={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let S=i.WARNINGS;function L(N){Number.isInteger(N)&&(S=N)}function M(){return S}function O(N){S>=i.INFOS&&console.log(`Info: ${N}`)}function _(N){S>=i.WARNINGS&&console.log(`Warning: ${N}`)}function z(N){throw new Error(N)}function q(N,F){N||z(F)}function nt(N){switch(N?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function j(N,F=null,C=null){if(!N)return null;try{if(C&&typeof N=="string"&&(C.addDefaultProtocol&&N.startsWith("www.")&&N.match(/\./g)?.length>=2&&(N=`http://${N}`),C.tryConvertEncoding))try{N=a(N)}catch{}const $=F?new URL(N,F):new URL(N);if(nt($))return $}catch{}return null}function H(N,F,C,$=!1){return Object.defineProperty(N,F,{value:C,enumerable:!$,configurable:!0,writable:!1}),C}const U=function(){function F(C,$){this.constructor===F&&z("Cannot initialize BaseException."),this.message=C,this.name=$}return F.prototype=new Error,F.constructor=F,F}();class Y extends U{constructor(F,C){super(F,"PasswordException"),this.code=C}}class et extends U{constructor(F,C){super(F,"UnknownErrorException"),this.details=C}}class tt extends U{constructor(F){super(F,"InvalidPDFException")}}class ot extends U{constructor(F){super(F,"MissingPDFException")}}class ct extends U{constructor(F,C){super(F,"UnexpectedResponseException"),this.status=C}}class pt extends U{constructor(F){super(F,"FormatError")}}class dt extends U{constructor(F){super(F,"AbortException")}}function ht(N){(typeof N!="object"||N?.length===void 0)&&z("Invalid argument for bytesToString");const F=N.length,C=8192;if(F<C)return String.fromCharCode.apply(null,N);const $=[];for(let K=0;K<F;K+=C){const X=Math.min(K+C,F),W=N.subarray(K,X);$.push(String.fromCharCode.apply(null,W))}return $.join("")}function ut(N){typeof N!="string"&&z("Invalid argument for stringToBytes");const F=N.length,C=new Uint8Array(F);for(let $=0;$<F;++$)C[$]=N.charCodeAt($)&255;return C}function st(N){return String.fromCharCode(N>>24&255,N>>16&255,N>>8&255,N&255)}function m(N){const F=Object.create(null);for(const[C,$]of N)F[C]=$;return F}function h(){const N=new Uint8Array(4);return N[0]=1,new Uint32Array(N.buffer,0,1)[0]===1}function e(){try{return new Function(""),!0}catch{return!1}}class n{static get isLittleEndian(){return H(this,"isLittleEndian",h())}static get isEvalSupported(){return H(this,"isEvalSupported",e())}static get isOffscreenCanvasSupported(){return H(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?H(this,"platform",{isMac:navigator.platform.includes("Mac")}):H(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return H(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const f=Array.from(Array(256).keys(),N=>N.toString(16).padStart(2,"0"));class o{static makeHexColor(F,C,$){return`#${f[F]}${f[C]}${f[$]}`}static scaleMinMax(F,C){let $;F[0]?(F[0]<0&&($=C[0],C[0]=C[2],C[2]=$),C[0]*=F[0],C[2]*=F[0],F[3]<0&&($=C[1],C[1]=C[3],C[3]=$),C[1]*=F[3],C[3]*=F[3]):($=C[0],C[0]=C[1],C[1]=$,$=C[2],C[2]=C[3],C[3]=$,F[1]<0&&($=C[1],C[1]=C[3],C[3]=$),C[1]*=F[1],C[3]*=F[1],F[2]<0&&($=C[0],C[0]=C[2],C[2]=$),C[0]*=F[2],C[2]*=F[2]),C[0]+=F[4],C[1]+=F[5],C[2]+=F[4],C[3]+=F[5]}static transform(F,C){return[F[0]*C[0]+F[2]*C[1],F[1]*C[0]+F[3]*C[1],F[0]*C[2]+F[2]*C[3],F[1]*C[2]+F[3]*C[3],F[0]*C[4]+F[2]*C[5]+F[4],F[1]*C[4]+F[3]*C[5]+F[5]]}static applyTransform(F,C){const $=F[0]*C[0]+F[1]*C[2]+C[4],K=F[0]*C[1]+F[1]*C[3]+C[5];return[$,K]}static applyInverseTransform(F,C){const $=C[0]*C[3]-C[1]*C[2],K=(F[0]*C[3]-F[1]*C[2]+C[2]*C[5]-C[4]*C[3])/$,X=(-F[0]*C[1]+F[1]*C[0]+C[4]*C[1]-C[5]*C[0])/$;return[K,X]}static getAxialAlignedBoundingBox(F,C){const $=this.applyTransform(F,C),K=this.applyTransform(F.slice(2,4),C),X=this.applyTransform([F[0],F[3]],C),W=this.applyTransform([F[2],F[1]],C);return[Math.min($[0],K[0],X[0],W[0]),Math.min($[1],K[1],X[1],W[1]),Math.max($[0],K[0],X[0],W[0]),Math.max($[1],K[1],X[1],W[1])]}static inverseTransform(F){const C=F[0]*F[3]-F[1]*F[2];return[F[3]/C,-F[1]/C,-F[2]/C,F[0]/C,(F[2]*F[5]-F[4]*F[3])/C,(F[4]*F[1]-F[5]*F[0])/C]}static singularValueDecompose2dScale(F){const C=[F[0],F[2],F[1],F[3]],$=F[0]*C[0]+F[1]*C[2],K=F[0]*C[1]+F[1]*C[3],X=F[2]*C[0]+F[3]*C[2],W=F[2]*C[1]+F[3]*C[3],rt=($+W)/2,J=Math.sqrt(($+W)**2-4*($*W-X*K))/2,Q=rt+J||1,it=rt-J||1;return[Math.sqrt(Q),Math.sqrt(it)]}static normalizeRect(F){const C=F.slice(0);return F[0]>F[2]&&(C[0]=F[2],C[2]=F[0]),F[1]>F[3]&&(C[1]=F[3],C[3]=F[1]),C}static intersect(F,C){const $=Math.max(Math.min(F[0],F[2]),Math.min(C[0],C[2])),K=Math.min(Math.max(F[0],F[2]),Math.max(C[0],C[2]));if($>K)return null;const X=Math.max(Math.min(F[1],F[3]),Math.min(C[1],C[3])),W=Math.min(Math.max(F[1],F[3]),Math.max(C[1],C[3]));return X>W?null:[$,X,K,W]}static#t(F,C,$,K,X,W,rt,J,Q,it){if(Q<=0||Q>=1)return;const lt=1-Q,gt=Q*Q,At=gt*Q,yt=lt*(lt*(lt*F+3*Q*C)+3*gt*$)+At*K,mt=lt*(lt*(lt*X+3*Q*W)+3*gt*rt)+At*J;it[0]=Math.min(it[0],yt),it[1]=Math.min(it[1],mt),it[2]=Math.max(it[2],yt),it[3]=Math.max(it[3],mt)}static#e(F,C,$,K,X,W,rt,J,Q,it,lt,gt){if(Math.abs(Q)<1e-12){Math.abs(it)>=1e-12&&this.#t(F,C,$,K,X,W,rt,J,-lt/it,gt);return}const At=it**2-4*lt*Q;if(At<0)return;const yt=Math.sqrt(At),mt=2*Q;this.#t(F,C,$,K,X,W,rt,J,(-it+yt)/mt,gt),this.#t(F,C,$,K,X,W,rt,J,(-it-yt)/mt,gt)}static bezierBoundingBox(F,C,$,K,X,W,rt,J,Q){return Q?(Q[0]=Math.min(Q[0],F,rt),Q[1]=Math.min(Q[1],C,J),Q[2]=Math.max(Q[2],F,rt),Q[3]=Math.max(Q[3],C,J)):Q=[Math.min(F,rt),Math.min(C,J),Math.max(F,rt),Math.max(C,J)],this.#e(F,$,X,rt,C,K,W,J,3*(-F+3*($-X)+rt),6*(F-2*$+X),3*($-F),Q),this.#e(F,$,X,rt,C,K,W,J,3*(-C+3*(K-W)+J),6*(C-2*K+W),3*(K-C),Q),Q}}function a(N){return decodeURIComponent(escape(N))}let u=null,A=null;function E(N){return u||(u=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,A=new Map([["","t"]])),N.replaceAll(u,(F,C,$)=>C?C.normalize("NFKC"):A.get($))}function R(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const N=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(N);else for(let F=0;F<32;F++)N[F]=Math.floor(Math.random()*255);return ht(N)}const k="pdfjs_internal_id_",D={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8}}},qt={};function Mt(at){var Z=qt[at];if(Z!==void 0)return Z.exports;var V=qt[at]={exports:{}};return se[at](V,V.exports,Mt),V.exports}(()=>{var at=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",Z=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",V=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",w=I=>{I&&I.d<1&&(I.d=1,I.forEach(G=>G.r--),I.forEach(G=>G.r--?G.r++:G()))},B=I=>I.map(G=>{if(G!==null&&typeof G=="object"){if(G[at])return G;if(G.then){var P=[];P.d=0,G.then(v=>{T[Z]=v,w(P)},v=>{T[V]=v,w(P)});var T={};return T[at]=v=>v(P),T}}var x={};return x[at]=v=>{},x[Z]=G,x});Mt.a=(I,G,P)=>{var T;P&&((T=[]).d=-1);var x=new Set,v=I.exports,r,d,l,b=new Promise((s,g)=>{l=g,d=s});b[Z]=v,b[at]=s=>(T&&s(T),x.forEach(s),b.catch(g=>{})),I.exports=b,G(s=>{r=B(s);var g,t=()=>r.map(c=>{if(c[V])throw c[V];return c[Z]}),i=new Promise(c=>{g=()=>c(t),g.r=0;var p=y=>y!==T&&!x.has(y)&&(x.add(y),y&&!y.d&&(g.r++,y.push(g)));r.map(y=>y[at](p))});return g.r?i:t()},s=>(s?l(b[V]=s):d(v),w(T))),T&&T.d<0&&(T.d=0)}})();Mt.d=(at,Z)=>{for(var V in Z)Mt.o(Z,V)&&!Mt.o(at,V)&&Object.defineProperty(at,V,{enumerable:!0,get:Z[V]})};Mt.o=(at,Z)=>Object.prototype.hasOwnProperty.call(at,Z);var ft=Mt(228);ft=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=ft);ft.AbortException;ft.AnnotationEditorLayer;ft.AnnotationEditorParamsType;ft.AnnotationEditorType;ft.AnnotationEditorUIManager;ft.AnnotationLayer;ft.AnnotationMode;ft.CMapCompressionType;ft.ColorPicker;ft.DOMSVGFactory;ft.DrawLayer;ft.FeatureTest;var Wt=ft.GlobalWorkerOptions;ft.ImageKind;ft.InvalidPDFException;ft.MissingPDFException;ft.OPS;ft.Outliner;ft.PDFDataRangeTransport;ft.PDFDateString;ft.PDFWorker;ft.PasswordResponses;ft.PermissionFlag;ft.PixelsPerInch;ft.RenderingCancelledException;ft.UnexpectedResponseException;ft.Util;ft.VerbosityLevel;ft.XfaLayer;ft.build;ft.createValidAbsoluteUrl;ft.fetchData;var ie=ft.getDocument;ft.getFilenameFromUrl;ft.getPdfFilenameFromUrl;ft.getXfaPageViewport;ft.isDataScheme;ft.isPdfFile;ft.noContextMenu;ft.normalizeUnicode;ft.renderTextLayer;ft.setLayerDimensions;ft.shadow;ft.updateTextLayer;ft.version;const ne="_LeftMenuContainer_bad80_1",re={LeftMenuContainer:ne},ae=()=>vt.jsx(vt.Fragment,{children:vt.jsx("div",{className:re.LeftMenuContainer})}),oe="_MainContainer_c3g6c_1",he={MainContainer:oe},le=()=>{const at=jt(Yt.currentPage);return at?vt.jsx("div",{className:he.MainContainer,children:vt.jsx("img",{src:at.dataUrl,alt:"Editor"})}):null},ce="_NavigationContainer_jep2w_1",de="_hidden_jep2w_12",ue="_pageButton_jep2w_16",fe="_page_jep2w_16",Vt={NavigationContainer:ce,hidden:de,pageButton:ue,page:fe};Wt.workerSrc="../../vendor/pdf.worker.min.mjs";const pe=()=>{const at=bt.useRef(null),Z=jt(Yt.pages);return vt.jsx(vt.Fragment,{children:vt.jsxs("span",{className:Vt.NavigationContainer,children:[vt.jsx("canvas",{ref:at,className:Vt.hidden}),Z.map((V,w)=>vt.jsx(Qt,{className:Vt.pageButton,onClick:()=>Jt.setCurrentIndex(w),children:vt.jsx("img",{className:Vt.page,alt:`Page ${w+1}`,src:V.dataUrl})},V.dataUrl))]})})},ge="_PdfImageEditor_10vmo_1",me="_hidden_10vmo_5",Kt={PdfImageEditor:ge,hidden:me},be=at=>bt.createElement("svg",{id:"Capa_1",enableBackground:"new 0 0 512 512",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",...at},bt.createElement("g",null,bt.createElement("path",{d:"m189.532 90.664c4.143 0 7.5-3.357 7.5-7.5v-12.048c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v12.048c0 4.143 3.358 7.5 7.5 7.5z"}),bt.createElement("path",{d:"m314.938 90.664c4.143 0 7.5-3.357 7.5-7.5v-12.048c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v12.048c0 4.143 3.357 7.5 7.5 7.5z"}),bt.createElement("path",{d:"m252.214 97.833h.018c8.495 0 16.582-3.679 22.188-10.096 2.725-3.119 2.405-7.857-.714-10.583-3.117-2.724-7.855-2.405-10.583.714-2.797 3.202-6.665 4.965-10.891 4.965-.003 0-.007 0-.01 0-4.22-.003-8.076-1.764-10.86-4.958-2.723-3.122-7.46-3.447-10.582-.727-3.122 2.722-3.448 7.459-.727 10.582 5.592 6.416 13.669 10.098 22.161 10.103z"}),bt.createElement("path",{d:"m227.134 497h-120.686c-35.892 0-65.092-29.2-65.092-65.092v-218.58c0-4.143-3.357-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v218.58c0 44.163 35.929 80.092 80.092 80.092h120.686c4.143 0 7.5-3.357 7.5-7.5s-3.358-7.5-7.5-7.5z"}),bt.createElement("path",{d:"m432.932 303.586v-220.783c0-2.06-.85-3.961-2.196-5.304l-75.303-75.303c-1.37-1.365-3.264-2.196-5.304-2.196h-198.499c-33.038 0-62.539 20.248-74.533 50.742-30.495 11.997-50.741 41.497-50.741 74.532v52.912c0 4.143 3.357 7.5 7.5 7.5s7.5-3.357 7.5-7.5v-52.912c0-22.884 11.955-43.675 30.826-55.357-.426 3.358-.645 6.754-.645 10.175v306.634c0 44.163 35.929 80.093 80.092 80.093h130.799c8.99 11.953 20.298 22.066 33.246 29.677-2.642.323-5.313.504-8.016.504h-45.383c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h45.383c10.274 0 20.23-1.927 29.651-5.693 11.143 3.689 23.046 5.693 35.41 5.693 62.267 0 112.924-50.657 112.924-112.924.001-40.146-21.061-75.461-52.711-95.49zm-75.303-277.98 49.696 49.696h-21.151c-15.739 0-28.545-12.806-28.545-28.545zm-205.999 426.212c-35.892 0-65.092-29.2-65.092-65.093v-306.633c0-7.234 1.174-14.328 3.491-21.087 9.006-26.32 33.761-44.005 61.601-44.005h190.999v31.758c0 24.011 19.534 43.545 43.545 43.545h31.758v205.306c-13.852-6.076-29.143-9.457-45.212-9.457-62.267 0-112.924 50.658-112.924 112.925 0 19.04 4.743 36.99 13.1 52.742h-121.266zm221.09 45.182c-53.995 0-97.924-43.929-97.924-97.924 0-53.996 43.929-97.925 97.924-97.925s97.924 43.929 97.924 97.925c0 53.995-43.929 97.924-97.924 97.924z"}),bt.createElement("path",{d:"m158.498 255.97h187.474c23.037 0 41.778-18.741 41.778-41.778v-36.868c0-23.036-18.741-41.777-41.778-41.777h-187.474c-23.037 0-41.778 18.741-41.778 41.777v36.868c0 23.037 18.741 41.778 41.778 41.778zm-26.778-78.647c0-14.765 12.013-26.777 26.778-26.777h187.474c14.766 0 26.778 12.013 26.778 26.777v36.868c0 14.766-12.013 26.778-26.778 26.778h-187.474c-14.766 0-26.778-12.013-26.778-26.778z"}),bt.createElement("path",{d:"m390.444 339.166c-9.5-10.435-25.946-10.439-35.446-.003l-30.475 33.437c-14.03 15.405-3.096 40.121 17.724 40.121h.382v31.396c0 12.518 10.184 22.701 22.701 22.701h14.779c12.518 0 22.701-10.184 22.701-22.701v-31.396h.382c20.838 0 31.743-24.728 17.722-40.123zm12.748 58.555h-7.882c-4.143 0-7.5 3.357-7.5 7.5v38.896c0 4.246-3.455 7.701-7.701 7.701h-14.779c-4.246 0-7.701-3.455-7.701-7.701v-38.896c0-4.143-3.357-7.5-7.5-7.5h-7.882c-7.793 0-11.885-9.255-6.636-15.02l30.476-33.438c3.564-3.915 9.7-3.918 13.269.003l30.471 33.433c5.247 5.762 1.165 15.022-6.635 15.022z"}),bt.createElement("path",{d:"m169.401 203.258h165.667c4.143 0 7.5-3.357 7.5-7.5s-3.357-7.5-7.5-7.5h-165.667c-4.143 0-7.5 3.357-7.5 7.5s3.358 7.5 7.5 7.5z"}),bt.createElement("path",{d:"m222.113 286.151h-97.893c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h97.894c4.143 0 7.5-3.357 7.5-7.5s-3.358-7.5-7.501-7.5z"}),bt.createElement("path",{d:"m222.113 331.333h-97.893c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h97.894c4.143 0 7.5-3.357 7.5-7.5s-3.358-7.5-7.501-7.5z"}),bt.createElement("path",{d:"m222.113 376.516h-97.893c-4.143 0-7.5 3.357-7.5 7.5s3.357 7.5 7.5 7.5h97.894c4.143 0 7.5-3.357 7.5-7.5s-3.358-7.5-7.501-7.5z"})),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null),bt.createElement("g",null)),Ae="_UploadContainer_xj41p_1",ve="_uploadButton_xj41p_10",ye="_svg_xj41p_18",we="_desc_xj41p_25",Se="_hidden_xj41p_30",zt={UploadContainer:Ae,uploadButton:ve,svg:ye,desc:we,hidden:Se};Wt.workerSrc="../../vendor/pdf.worker.min.mjs";const Ee=({importPdf:at})=>{const Z=bt.useRef(null),V=bt.useRef(new FileReader),w=P=>P.substring(P.indexOf(":")+1,P.indexOf(";"));V.current.onload=()=>{const P=V.current.result,T=w(P);["image/jpeg","image/jpg","image/png","application/pdf"].includes(T)&&T==="application/pdf"&&at(P)};const B=()=>{if(!Z.current)return;const P=Z.current.files?.[0],T=Z.current.value;!P||!T||V.current.readAsDataURL(P)},I=()=>{Z.current?.click()},G=()=>{B()};return vt.jsxs("div",{className:zt.UploadContainer,children:[vt.jsx("input",{type:"file",accept:".pdf,.png,.jpg,.jpeg",ref:Z,className:zt.hidden,onChange:G}),vt.jsxs(Qt,{className:zt.uploadButton,onClick:I,children:[vt.jsx(be,{className:zt.svg}),vt.jsx("p",{className:zt.desc,children:"Import a PDF(s) or image(s)"})]})]})};Wt.workerSrc="../../vendor/pdf.worker.min.mjs";const Ce=()=>{const at=bt.useRef(null),Z=jt(Yt.pages),V=te();bt.useEffect(()=>{V(ee.setMenuKey("tools"))},[V]);const w=B=>{let I=1;const G=async()=>{if(at.current)try{const T=await ie(B).promise;if(I>T.numPages)return;const x=await T.getPage(I),{width:v,height:r}=x.getViewport({scale:1});at.current.width=v,at.current.height=r,await x.render({canvasContext:at.current.getContext("2d"),viewport:x.getViewport({scale:1})}).promise.then(()=>{const l=at.current.toDataURL("page/jpeg");Jt.addPage({page:{dataUrl:l}}),I++,G()})}catch(P){console.error("Error loading the PDF document:",P)}};G()};return vt.jsxs("div",{className:Kt.PdfImageEditor,children:[vt.jsx("canvas",{ref:at,className:Kt.hidden}),Z.length===0?vt.jsx(Ee,{importPdf:w}):vt.jsxs(vt.Fragment,{children:[vt.jsx(pe,{}),vt.jsx(le,{}),vt.jsx(ae,{})]})]})};export{Ce as default};
